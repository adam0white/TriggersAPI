<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title id="page-title">TriggersAPI - Event Ingestion Dashboard</title>
		<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>⚡</text></svg>" />
		<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
		<style>
			/* ============================================
       DESIGN SYSTEM - Story 5.4: UI Polish
       ============================================ */

			/* CSS Custom Properties (Design Tokens) */
			:root {
				/* Primary Color Palette - WCAG AA Compliant */
				--color-primary: #2563eb;
				--color-primary-dark: #1d4ed8;
				--color-primary-light: #dbeafe;
				--color-primary-hover: #1e40af;

				/* Success Colors - WCAG AA Compliant */
				--color-success: #059669;
				--color-success-dark: #047857;
				--color-success-light: #d1fae5;

				/* Warning Colors - WCAG AA Compliant */
				--color-warning: #d97706;
				--color-warning-dark: #b45309;
				--color-warning-light: #fef3c7;

				/* Error Colors - WCAG AA Compliant */
				--color-error: #dc2626;
				--color-error-dark: #b91c1c;
				--color-error-light: #fee2e2;

				/* Neutral Colors */
				--color-neutral: #6b7280;
				--color-neutral-dark: #4b5563;
				--color-neutral-light: #9ca3af;

				/* Text Colors - WCAG AA Compliant */
				--color-text-primary: #1f2937;
				--color-text-secondary: #4b5563; /* Improved from #6b7280 for better contrast */
				--color-text-tertiary: #6b7280; /* Improved from #9ca3af for better contrast */
				--color-text-inverse: #ffffff;
				--color-text-disabled: #9ca3af;
				--color-text-placeholder: #6b7280; /* Explicit placeholder color */

				/* Background Colors */
				--color-bg-primary: #ffffff;
				--color-bg-secondary: #f9fafb;
				--color-bg-tertiary: #f3f4f6;
				--color-bg-canvas: #f9fafb;
				--color-bg-overlay: rgba(0, 0, 0, 0.5);

				/* Border Colors */
				--color-border-primary: #e5e7eb;
				--color-border-secondary: #d1d5db;
				--color-border-focus: #2563eb;

				/* Typography */
				--font-family-primary:
					-apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans',
					'Helvetica Neue', sans-serif;
				--font-family-mono: 'Monaco', 'Menlo', 'Courier New', monospace;

				/* Font Sizes */
				--font-size-xs: 12px;
				--font-size-sm: 13px;
				--font-size-base: 14px;
				--font-size-md: 16px;
				--font-size-lg: 18px;
				--font-size-xl: 20px;
				--font-size-2xl: 24px;
				--font-size-3xl: 28px;

				/* Font Weights */
				--font-weight-normal: 400;
				--font-weight-medium: 500;
				--font-weight-semibold: 600;
				--font-weight-bold: 700;

				/* Line Heights */
				--line-height-tight: 1.2;
				--line-height-normal: 1.5;
				--line-height-relaxed: 1.6;

				/* Spacing Scale (16px base) */
				--spacing-xs: 4px;
				--spacing-sm: 8px;
				--spacing-md: 12px;
				--spacing-base: 16px;
				--spacing-lg: 20px;
				--spacing-xl: 24px;
				--spacing-2xl: 32px;
				--spacing-3xl: 40px;
				--spacing-4xl: 48px;

				/* Border Radius */
				--radius-sm: 4px;
				--radius-base: 6px;
				--radius-md: 8px;
				--radius-lg: 12px;
				--radius-xl: 20px;
				--radius-full: 9999px;

				/* Shadows */
				--shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
				--shadow-base: 0 4px 6px rgba(0, 0, 0, 0.1);
				--shadow-md: 0 6px 12px rgba(0, 0, 0, 0.1);
				--shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
				--shadow-xl: 0 20px 60px rgba(0, 0, 0, 0.3);

				/* Transitions */
				--transition-fast: 0.15s ease;
				--transition-base: 0.2s ease;
				--transition-slow: 0.3s ease;

				/* Z-Index Scale */
				--z-base: 1;
				--z-dropdown: 100;
				--z-sticky: 200;
				--z-modal: 1000;
				--z-toast: 9999;
				--z-tooltip: 10000;

				/* Layout */
				--container-max-width: 1400px;
				--grid-gap: var(--spacing-base);

				/* Button Sizing - Standardized Touch Targets */
				--btn-height-sm: 36px;
				--btn-height-md: 44px; /* WCAG minimum touch target */
				--btn-height-lg: 52px;
				--btn-padding-sm: var(--spacing-sm) var(--spacing-md);
				--btn-padding-md: var(--spacing-md) var(--spacing-xl);
				--btn-padding-lg: var(--spacing-base) var(--spacing-2xl);
				--btn-icon-size: 44px; /* Square touch target for icon buttons */
			}

			/* ============================================
       GLOBAL RESET & BASE STYLES
       ============================================ */

			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}

			html {
				scroll-behavior: smooth;
				-webkit-font-smoothing: antialiased;
				-moz-osx-font-smoothing: grayscale;
			}

			body {
				font-family: var(--font-family-primary);
				font-size: var(--font-size-base);
				line-height: var(--line-height-relaxed);
				color: var(--color-text-primary);
				background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-dark) 100%);
				min-height: 100vh;
				display: flex;
				align-items: center;
				justify-content: center;
				padding: var(--spacing-lg);
			}

			/* ============================================
       TYPOGRAPHY SYSTEM
       ============================================ */

			h1,
			h2,
			h3,
			h4,
			h5,
			h6 {
				margin: var(--spacing-base) 0 var(--spacing-md) 0;
				line-height: var(--line-height-tight);
				font-weight: var(--font-weight-bold);
				color: var(--color-text-primary);
			}

			h1 {
				font-size: var(--font-size-3xl);
				font-weight: var(--font-weight-bold);
			}
			h2 {
				font-size: var(--font-size-2xl);
				font-weight: var(--font-weight-bold);
			}
			h3 {
				font-size: var(--font-size-xl);
				font-weight: var(--font-weight-semibold);
			}
			h4 {
				font-size: var(--font-size-md);
				font-weight: var(--font-weight-semibold);
			}
			h5 {
				font-size: var(--font-size-base);
				font-weight: var(--font-weight-semibold);
			}
			h6 {
				font-size: var(--font-size-xs);
				font-weight: var(--font-weight-semibold);
			}

			p {
				margin: var(--spacing-md) 0;
				line-height: var(--line-height-relaxed);
			}

			code {
				font-family: var(--font-family-mono);
				background: var(--color-bg-tertiary);
				padding: 2px 6px;
				border-radius: var(--radius-sm);
				font-size: var(--font-size-xs);
			}

			pre {
				background: var(--color-bg-tertiary);
				padding: var(--spacing-base);
				border-radius: var(--radius-md);
				overflow-x: auto;
				font-size: var(--font-size-xs);
				line-height: var(--line-height-normal);
				border: 1px solid var(--color-border-primary); /* Improved contrast */
			}

			/* ============================================
       LAYOUT - CONTAINER & SECTIONS
       ============================================ */

			/* PHASE 1: Layout Transformation - New Dashboard Container System */
			.dashboard-container {
				background: transparent;
				max-width: min(100%, 1600px); /* Fluid for ultra-wide screens */
				width: 100%;
				padding: var(--spacing-xl);
				margin: 0 auto;
				display: grid;
				grid-template-columns: 1fr;
				gap: var(--spacing-xl);
			}

			.dashboard-card {
				background: var(--color-bg-primary);
				border-radius: var(--radius-lg);
				box-shadow: var(--shadow-md);
				padding: var(--spacing-xl);
				transition: all var(--transition-base);
			}

			.dashboard-card:hover {
				box-shadow: var(--shadow-lg);
			}

			.card-full {
				grid-column: 1 / -1;
			}

			/* Legacy container for backward compatibility */
			.container {
				background: var(--color-bg-primary);
				border-radius: var(--radius-lg);
				box-shadow: var(--shadow-xl);
				max-width: 800px;
				width: 100%;
				padding: var(--spacing-3xl);
			}

			header {
				margin-bottom: var(--spacing-3xl);
				text-align: center;
				border-bottom: 2px solid var(--color-border-primary);
				padding-bottom: var(--spacing-lg);
			}

			header h1 {
				margin: 0 0 var(--spacing-sm) 0;
			}

			/* ============================================
       COMPONENT LIBRARY - STATUS BADGES
       ============================================ */

			.status {
				display: inline-block;
				padding: var(--spacing-sm) var(--spacing-base);
				background: var(--color-success);
				color: var(--color-text-inverse);
				border-radius: var(--radius-xl);
				font-size: var(--font-size-base);
				font-weight: var(--font-weight-semibold);
				transition: all var(--transition-base);
			}

			.status.loading {
				background: var(--color-warning);
			}

			.status.error {
				background: var(--color-error);
			}

			/* ============================================
       FORM COMPONENTS
       ============================================ */

			.form-group {
				margin-bottom: var(--spacing-xl);
				position: relative;
			}

			label {
				display: block;
				margin-bottom: var(--spacing-sm);
				color: var(--color-text-primary);
				font-weight: var(--font-weight-semibold);
				font-size: var(--font-size-base);
			}

			input[type='text'],
			textarea,
			select {
				width: 100%;
				padding: var(--spacing-md);
				border: 1px solid var(--color-border-secondary);
				border-radius: var(--radius-base);
				font-family: var(--font-family-mono);
				font-size: var(--font-size-base);
				transition: all var(--transition-base);
				background: var(--color-bg-primary);
				color: var(--color-text-primary);
			}

			input[type='text']:focus,
			textarea:focus,
			select:focus {
				outline: none;
				border-color: var(--color-border-focus);
				box-shadow: 0 0 0 3px var(--color-primary-light);
			}

			input[type='text']:hover,
			textarea:hover,
			select:hover {
				border-color: var(--color-neutral);
			}

			/* Improved Placeholder Styling - WCAG AA */
			input::placeholder,
			textarea::placeholder {
				color: var(--color-text-placeholder);
				opacity: 0.8;
			}

			/* Disabled Input States - Better Visual Feedback */
			input:disabled,
			textarea:disabled,
			select:disabled {
				background-color: var(--color-bg-tertiary);
				color: var(--color-text-disabled);
				cursor: not-allowed;
				opacity: 0.7;
				border-color: var(--color-border-primary);
			}

			textarea {
				resize: vertical;
				min-height: 150px;
				font-family: var(--font-family-mono);
				line-height: var(--line-height-normal);
			}

			/* Form Validation States */
			.form-group.error input,
			.form-group.error textarea,
			.form-group.error select {
				border-color: var(--color-error);
				background-color: var(--color-error-light);
				box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
			}

			.form-group.success input,
			.form-group.success textarea,
			.form-group.success select {
				border-color: var(--color-success);
				box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
			}

			.form-error-message {
				display: flex;
				align-items: center;
				gap: 6px;
				color: var(--color-error);
				font-size: var(--font-size-xs);
				margin-top: 4px;
				font-weight: var(--font-weight-medium);
			}

			.form-error-message::before {
				content: '⚠';
				font-weight: bold;
			}

			/* ============================================
       BUTTON COMPONENTS
       ============================================ */

			.button-group {
				display: flex;
				gap: var(--spacing-md);
				margin-top: var(--spacing-xl);
				flex-wrap: wrap;
			}

			button {
				padding: var(--btn-padding-md);
				border: none;
				border-radius: var(--radius-base);
				font-size: var(--font-size-base);
				font-weight: var(--font-weight-semibold);
				font-family: var(--font-family-primary);
				cursor: pointer;
				transition: all var(--transition-base);
				display: inline-flex;
				align-items: center;
				justify-content: center;
				gap: var(--spacing-sm);
				min-height: var(--btn-height-md); /* Touch-friendly minimum */
			}

			/* Button Size Variants */
			.btn-sm {
				padding: var(--btn-padding-sm);
				min-height: var(--btn-height-sm);
				font-size: var(--font-size-sm);
			}

			.btn-lg {
				padding: var(--btn-padding-lg);
				min-height: var(--btn-height-lg);
				font-size: var(--font-size-lg);
			}

			/* Icon-only buttons */
			.btn-icon {
				padding: 0;
				min-width: var(--btn-icon-size);
				min-height: var(--btn-icon-size);
				width: var(--btn-icon-size);
				height: var(--btn-icon-size);
				border-radius: var(--radius-base);
			}

			.btn-submit,
			button[type='submit'] {
				background: var(--color-primary);
				color: var(--color-text-inverse);
				flex: 1;
			}

			.btn-submit:hover:not(:disabled),
			button[type='submit']:hover:not(:disabled) {
				background: var(--color-primary-dark);
				transform: translateY(-1px);
				box-shadow: var(--shadow-md);
			}

			.btn-submit:active:not(:disabled),
			button[type='submit']:active:not(:disabled) {
				background: var(--color-primary-hover);
				transform: translateY(0);
			}

			.btn-submit:disabled:not(.loading),
			button[type='submit']:disabled:not(.loading) {
				background: var(--color-bg-tertiary);
				color: var(--color-text-tertiary);
				cursor: not-allowed;
				opacity: 0.6;
				transform: none;
				border: 1px solid var(--color-border-primary);
			}

			.btn-clear,
			.btn-secondary {
				background: var(--color-bg-tertiary);
				color: var(--color-text-primary);
				border: 1px solid var(--color-border-secondary);
				flex: 1;
			}

			.btn-clear:hover:not(:disabled),
			.btn-secondary:hover:not(:disabled) {
				background: var(--color-bg-secondary);
				border-color: var(--color-neutral);
			}

			/* Focus states for accessibility */
			button:focus-visible {
				outline: 2px solid var(--color-border-focus);
				outline-offset: 2px;
			}

			/* Additional focus states for interactive elements */
			a:focus-visible,
			.card:focus-visible,
			.metric-card:focus-visible {
				outline: 2px solid var(--color-border-focus);
				outline-offset: 2px;
			}

			/* ============================================
       CARD COMPONENTS
       ============================================ */

			.card {
				background: var(--color-bg-primary);
				border: 1px solid var(--color-border-primary);
				border-radius: var(--radius-md);
				padding: var(--spacing-base);
				box-shadow: var(--shadow-sm);
				transition: all var(--transition-base);
			}

			.card:hover {
				box-shadow: var(--shadow-md);
				transform: translateY(-1px);
			}

			.card-header {
				margin: 0 0 var(--spacing-base) 0;
				padding-bottom: var(--spacing-base);
				border-bottom: 1px solid var(--color-border-primary);
			}

			.card-title {
				font-size: var(--font-size-md);
				font-weight: var(--font-weight-semibold);
				margin: 0;
				color: var(--color-text-primary);
			}

			.card-content {
				padding: var(--spacing-base) 0;
			}

			/* ============================================
       GRID SYSTEM
       ============================================ */

			.grid {
				display: grid;
				gap: var(--grid-gap);
			}

			.grid-1 {
				grid-template-columns: 1fr;
			}
			.grid-2 {
				grid-template-columns: repeat(2, 1fr);
			}
			.grid-3 {
				grid-template-columns: repeat(3, 1fr);
			}
			.grid-4 {
				grid-template-columns: repeat(4, 1fr);
			}
			.grid-6 {
				grid-template-columns: repeat(6, 1fr);
			}
			.grid-12 {
				grid-template-columns: repeat(12, 1fr);
			}

			/* ============================================
       BADGE COMPONENTS
       ============================================ */

			.badge {
				display: inline-flex;
				align-items: center;
				gap: var(--spacing-xs);
				padding: var(--spacing-xs) var(--spacing-sm);
				border-radius: var(--radius-sm);
				font-size: var(--font-size-xs);
				font-weight: var(--font-weight-semibold);
				text-transform: uppercase;
				letter-spacing: 0.3px;
			}

			.badge-success {
				background: var(--color-success-light);
				color: var(--color-success-dark);
			}

			.badge-error {
				background: var(--color-error-light);
				color: var(--color-error-dark);
			}

			.badge-warning {
				background: var(--color-warning-light);
				color: var(--color-warning-dark);
			}

			.badge-info {
				background: var(--color-primary-light);
				color: var(--color-primary-dark);
			}

			.badge-neutral {
				background: var(--color-bg-tertiary);
				color: var(--color-neutral);
			}

			/* ============================================
       UTILITY CLASSES
       ============================================ */

			.hidden {
				display: none !important;
			}

			.visible {
				display: block !important;
			}

			.text-center {
				text-align: center;
			}

			.text-left {
				text-align: left;
			}

			.text-right {
				text-align: right;
			}

			.mt-0 {
				margin-top: 0;
			}
			.mt-1 {
				margin-top: var(--spacing-xs);
			}
			.mt-2 {
				margin-top: var(--spacing-sm);
			}
			.mt-3 {
				margin-top: var(--spacing-md);
			}
			.mt-4 {
				margin-top: var(--spacing-base);
			}
			.mt-6 {
				margin-top: var(--spacing-xl);
			}

			.mb-0 {
				margin-bottom: 0;
			}
			.mb-1 {
				margin-bottom: var(--spacing-xs);
			}
			.mb-2 {
				margin-bottom: var(--spacing-sm);
			}
			.mb-3 {
				margin-bottom: var(--spacing-md);
			}
			.mb-4 {
				margin-bottom: var(--spacing-base);
			}
			.mb-6 {
				margin-bottom: var(--spacing-xl);
			}

			/* ============================================
       RESPONSE SECTIONS
       ============================================ */

			.response-section {
				margin-top: 40px;
				padding: 20px;
				background: var(--color-bg-secondary);
				border-radius: var(--radius-base); /* 6px */
				border: 1px solid var(--color-border-primary);
				display: none;
			}

			.response-section.visible {
				display: block;
			}

			.response-section.success {
				background: var(--color-success-light);
				border-color: var(--color-success-light);
			}

			.response-section.error {
				background: var(--color-error-light);
				border-color: var(--color-error-light);
			}

			.response-title {
				font-weight: 600;
				margin-bottom: 12px;
				font-size: 14px;
			}

			.response-section.success .response-title {
				color: var(--color-success-dark);
			}

			.response-section.error .response-title {
				color: var(--color-error-dark);
			}

			.response-content {
				font-family: 'Monaco', 'Menlo', monospace;
				font-size: 12px;
				overflow-x: auto;
				background: white;
				padding: 12px;
				border-radius: var(--radius-sm); /* 4px */
				color: var(--color-text-primary);
				line-height: 1.5;
			}

			.response-section.error .response-content {
				color: var(--color-error-dark);
			}

			.hint {
				font-size: 12px;
				color: var(--color-text-secondary);
				margin-top: 6px;
			}

			/* Metrics Dashboard Styles */
			.metrics-section {
				margin-top: 48px;
				padding-top: 48px;
				border-top: 2px solid var(--color-bg-tertiary);
			}

			.metrics-header {
				display: flex;
				justify-content: space-between;
				align-items: center;
				margin-bottom: 24px;
			}

			.metrics-title {
				font-size: 20px;
				font-weight: 700;
				color: var(--color-text-primary);
			}

			.refresh-indicator {
				font-size: 12px;
				color: var(--color-text-secondary);
				display: flex;
				align-items: center;
				gap: 8px;
			}

			.spinner {
				display: inline-block;
				width: 14px;
				height: 14px;
				border: 2px solid var(--color-border-primary);
				border-top-color: var(--color-primary);
				border-radius: 50%;
				animation: spin 1s linear infinite;
			}

			@keyframes spin {
				to {
					transform: rotate(360deg);
				}
			}

			.metrics-grid {
				display: grid;
				grid-template-columns: 1fr;
				gap: 16px;
				margin-bottom: 24px;
			}

			@media (min-width: 768px) {
				.metrics-grid {
					grid-template-columns: repeat(2, 1fr);
				}
			}

			@media (min-width: 1024px) {
				.metrics-grid {
					grid-template-columns: repeat(4, 1fr);
				}
			}

			.metric-card {
				background: var(--color-bg-secondary);
				border: 1px solid var(--color-border-primary);
				border-radius: var(--radius-md); /* 8px */
				padding: 20px;
				text-align: center;
				transition: all 0.3s;
			}

			.metric-card:hover {
				transform: translateY(-2px);
				box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
			}

			.metric-card.pending {
				background: var(--color-warning-light);
				border-color: var(--color-warning);
			}

			.metric-card.delivered {
				background: var(--color-success-light);
				border-color: var(--color-success);
			}

			.metric-card.failed {
				background: var(--color-error-light);
				border-color: var(--color-error);
			}

			.metric-card.total {
				background: var(--color-primary-light);
				border-color: var(--color-primary);
			}

			.metric-value {
				font-size: 36px;
				font-weight: 700;
				margin-bottom: 8px;
			}

			.metric-card.pending .metric-value {
				color: var(--color-warning-dark);
			}

			.metric-card.delivered .metric-value {
				color: var(--color-success-dark);
			}

			.metric-card.failed .metric-value {
				color: var(--color-error-dark);
			}

			.metric-card.total .metric-value {
				color: var(--color-primary-dark);
			}

			.metric-label {
				font-size: 14px;
				font-weight: 600;
				color: var(--color-text-secondary);
				text-transform: uppercase;
				letter-spacing: 0.5px;
			}

			.metrics-details {
				display: grid;
				grid-template-columns: 1fr;
				gap: 16px;
			}

			@media (min-width: 768px) {
				.metrics-details {
					grid-template-columns: repeat(2, 1fr);
				}
			}

			.detail-card {
				background: var(--color-bg-secondary);
				border: 1px solid var(--color-border-primary);
				border-radius: var(--radius-md); /* 8px */
				padding: 20px;
			}

			.detail-card-title {
				font-size: 16px;
				font-weight: 700;
				color: var(--color-text-primary);
				margin-bottom: 16px;
				padding-bottom: 12px;
				border-bottom: 1px solid var(--color-border-primary);
			}

			.detail-row {
				display: flex;
				justify-content: space-between;
				align-items: center;
				padding: 10px 0;
				border-bottom: 1px solid var(--color-bg-tertiary);
			}

			.detail-row:last-child {
				border-bottom: none;
			}

			.detail-label {
				font-size: 14px;
				font-weight: 500;
				color: var(--color-text-secondary);
			}

			.detail-value {
				font-size: 18px;
				font-weight: 700;
			}

			.detail-value.blue {
				color: var(--color-primary-dark);
			}

			.detail-value.purple {
				color: var(--color-primary);
			}

			.detail-value.green {
				color: var(--color-success-dark);
			}

			.detail-value.red {
				color: var(--color-error-dark);
			}

			.detail-timestamp {
				font-size: 12px;
				color: var(--color-text-secondary);
				margin-top: 12px;
				padding-top: 12px;
				border-top: 1px solid var(--color-bg-tertiary);
			}

			.progress-bar-container {
				width: 100%;
				height: 8px;
				background: var(--color-border-primary);
				border-radius: var(--radius-sm); /* 4px */
				overflow: hidden;
				margin: 12px 0;
			}

			.progress-bar {
				height: 100%;
				background: var(--color-success-dark);
				border-radius: var(--radius-sm); /* 4px */
				transition: width 0.3s ease;
			}

			.metrics-loading {
				text-align: center;
				padding: 40px;
				color: var(--color-text-secondary);
			}

			.metrics-error {
				background: var(--color-error-light);
				border: 1px solid var(--color-error);
				border-radius: var(--radius-md); /* 8px */
				padding: 20px;
				text-align: center;
			}

			.error-title {
				font-size: 16px;
				font-weight: 700;
				color: var(--color-error-dark);
				margin-bottom: 8px;
				display: flex;
				align-items: center;
				justify-content: center;
				gap: 8px;
			}

			.error-message {
				font-size: 14px;
				color: var(--color-error-dark);
				margin-bottom: 16px;
			}

			.btn-retry {
				padding: 10px 20px;
				background: var(--color-error-dark);
				color: white;
				border: none;
				border-radius: var(--radius-base); /* 6px */
				font-size: 14px;
				font-weight: 600;
				cursor: pointer;
				transition: all 0.3s;
			}

			.btn-retry:hover {
				background: var(--color-error-dark);
				transform: translateY(-2px);
				box-shadow: 0 4px 12px rgba(220, 38, 38, 0.4);
			}

			@media (max-width: 640px) {
				.container {
					padding: 20px;
				}

				h1 {
					font-size: 22px;
				}

				.button-group {
					flex-direction: column;
				}

				.metric-value {
					font-size: 28px;
				}

				.metrics-header {
					flex-direction: column;
					align-items: flex-start;
					gap: 12px;
				}
			}

			/* Event Inbox Styles */
			.inbox-section {
				margin-top: 48px;
				padding-top: 48px;
				border-top: 2px solid var(--color-bg-tertiary);
			}

			.inbox-title {
				font-size: 20px;
				font-weight: 700;
				color: var(--color-text-primary);
				margin-bottom: 24px;
			}

			.filters-grid {
				display: grid;
				grid-template-columns: 1fr;
				gap: 16px;
				margin-bottom: 24px;
			}

			@media (min-width: 768px) {
				.filters-grid {
					grid-template-columns: repeat(4, 1fr);
				}
			}

			.filter-group {
				display: flex;
				flex-direction: column;
			}

			.filter-label {
				font-size: 14px;
				font-weight: 600;
				color: var(--color-text-primary);
				margin-bottom: 8px;
			}

			.filter-input,
			.filter-select {
				width: 100%;
				padding: 10px 12px;
				border: 1px solid var(--color-border-secondary);
				border-radius: var(--radius-base); /* 6px */
				font-size: 14px;
				transition: border-color 0.3s;
			}

			.filter-input:focus,
			.filter-select:focus {
				outline: none;
				border-color: var(--color-primary);
				box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
			}

			.inbox-info {
				font-size: 14px;
				color: var(--color-text-secondary);
				margin-bottom: 16px;
			}

			/* Table Styles */
			.events-table-container {
				overflow-x: auto;
				border: 1px solid var(--color-border-primary);
				border-radius: var(--radius-md); /* 8px */
				margin-bottom: 24px;
			}

			.events-table {
				width: 100%;
				border-collapse: collapse;
				font-size: 14px;
			}

			.events-table thead {
				background: var(--color-bg-secondary);
				border-bottom: 2px solid var(--color-border-primary);
			}

			.events-table th {
				padding: 12px 16px;
				text-align: left;
				font-weight: 600;
				color: var(--color-text-primary);
			}

			.events-table th:last-child {
				text-align: right;
			}

			.events-table tbody tr {
				border-bottom: 1px solid var(--color-bg-tertiary);
				transition: background-color 0.2s, box-shadow 0.2s;
			}

			/* Zebra striping for better readability */
			.events-table tbody tr:nth-child(even) {
				background: var(--color-bg-secondary);
			}

			.events-table tbody tr:hover {
				background: var(--color-primary-light);
				box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
			}

			.events-table td {
				padding: 14px 16px; /* Increased padding for better spacing */
			}

			.event-id {
				font-family: 'Monaco', 'Menlo', monospace;
				font-size: 12px;
				color: var(--color-text-secondary);
			}

			.status-badge {
				display: inline-block;
				padding: 4px 12px;
				border-radius: var(--radius-lg); /* 12px */
				font-size: 12px;
				font-weight: 600;
				text-transform: uppercase;
			}

			.status-badge.pending {
				background: var(--color-warning-light);
				color: var(--color-warning-dark);
			}

			.status-badge.delivered {
				background: var(--color-success-light);
				color: var(--color-success-dark);
			}

			.status-badge.failed {
				background: var(--color-error-light);
				color: var(--color-error-dark);
			}

			.payload-preview {
				color: var(--color-text-secondary);
				max-width: 300px;
				white-space: nowrap;
				overflow: hidden;
				text-overflow: ellipsis;
				font-family: 'Monaco', 'Menlo', monospace;
				font-size: 12px;
			}

			.action-buttons {
				display: flex;
				gap: 8px;
				justify-content: flex-end;
			}

			.btn-action {
				padding: 6px 12px;
				border: none;
				border-radius: var(--radius-sm); /* 4px */
				font-size: 12px;
				font-weight: 600;
				cursor: pointer;
				transition: all 0.2s;
			}

			.btn-action:disabled {
				opacity: 0.5;
				cursor: not-allowed;
			}

			.btn-view {
				background: var(--color-primary-light);
				color: var(--color-primary-dark);
			}

			.btn-view:hover:not(:disabled) {
				background: var(--color-primary-light);
			}

			.btn-retry {
				background: var(--color-warning-light);
				color: var(--color-warning-dark);
			}

			.btn-retry:hover:not(:disabled) {
				background: var(--color-warning-light);
			}

			.btn-ack {
				background: var(--color-success-light);
				color: var(--color-success-dark);
			}

			.btn-ack:hover:not(:disabled) {
				background: var(--color-success-light);
			}

			/* Card Layout (Mobile) */
			.events-cards {
				display: none;
			}

			@media (max-width: 768px) {
				.events-table-container {
					display: none;
				}

				.events-cards {
					display: block;
				}
			}

			.event-card {
				background: var(--color-bg-secondary);
				border: 1px solid var(--color-border-primary);
				border-radius: var(--radius-md); /* 8px */
				padding: 16px;
				margin-bottom: 12px;
			}

			.event-card-header {
				display: flex;
				justify-content: space-between;
				align-items: flex-start;
				margin-bottom: 12px;
			}

			.event-card-body {
				margin-bottom: 12px;
			}

			.event-card-footer {
				display: flex;
				justify-content: space-between;
				align-items: center;
				font-size: 12px;
				color: var(--color-text-secondary);
				margin-bottom: 12px;
			}

			.event-card-actions {
				display: flex;
				gap: 8px;
			}

			.event-card-actions .btn-action {
				flex: 1;
				padding: 8px 12px;
			}

			/* Pagination */
			.pagination {
				display: flex;
				justify-content: space-between;
				align-items: center;
				margin-top: 24px;
			}

			.pagination-info {
				font-size: 14px;
				color: var(--color-text-secondary);
			}

			.pagination-buttons {
				display: flex;
				gap: 8px;
				align-items: center;
			}

			.btn-page {
				padding: 8px 16px;
				border: 1px solid var(--color-border-secondary);
				border-radius: var(--radius-base); /* 6px */
				background: white;
				font-size: 14px;
				font-weight: 600;
				cursor: pointer;
				transition: all 0.2s;
			}

			.btn-page:hover:not(:disabled) {
				background: var(--color-bg-secondary);
			}

			.btn-page:disabled {
				opacity: 0.5;
				cursor: not-allowed;
			}

			/* Modal */
			.modal-overlay {
				display: none;
				position: fixed;
				top: 0;
				left: 0;
				right: 0;
				bottom: 0;
				background: rgba(0, 0, 0, 0.5);
				z-index: 1000;
				align-items: center;
				justify-content: center;
				padding: 20px;
			}

			.modal-overlay.visible {
				display: flex;
			}

			.modal-content {
				background: white;
				border-radius: var(--radius-lg); /* 12px */
				max-width: 700px;
				width: 100%;
				max-height: calc(100vh - 120px); /* Better mobile handling */
				overflow-y: auto;
				padding: 24px;
				position: relative;
			}

			.modal-header {
				display: flex;
				justify-content: space-between;
				align-items: center;
				margin-bottom: 24px;
				padding-bottom: 16px;
				border-bottom: 2px solid var(--color-bg-tertiary);
			}

			.modal-title {
				font-size: 20px;
				font-weight: 700;
				color: var(--color-text-primary);
			}

			.btn-close {
				font-size: var(--font-size-2xl); /* 24px variable */
				color: var(--color-text-secondary);
				background: none;
				border: none;
				cursor: pointer;
				padding: 0;
				min-width: var(--btn-icon-size); /* 44px minimum touch target */
				min-height: var(--btn-icon-size); /* 44px minimum touch target */
				width: var(--btn-icon-size);
				height: var(--btn-icon-size);
				display: flex;
				align-items: center;
				justify-content: center;
				border-radius: var(--radius-base); /* 6px */
				transition: all var(--transition-base);
			}

			.btn-close:hover {
				background: var(--color-bg-tertiary);
				color: var(--color-text-primary);
			}

			.btn-close:focus-visible {
				outline: 2px solid var(--color-border-focus);
				outline-offset: 2px;
			}

			.modal-body {
				margin-bottom: 24px;
			}

			.detail-field {
				margin-bottom: 20px;
			}

			.detail-field-label {
				font-weight: 600;
				color: var(--color-text-primary);
				margin-bottom: 8px;
				font-size: 14px;
			}

			.detail-field-value {
				background: var(--color-bg-secondary);
				border: 1px solid var(--color-border-primary);
				border-radius: var(--radius-base); /* 6px */
				padding: 12px;
				font-family: 'Monaco', 'Menlo', monospace;
				font-size: 12px;
				overflow-x: auto;
				color: var(--color-text-primary);
				line-height: 1.5;
				white-space: pre-wrap;
				word-break: break-all;
			}

			.detail-grid {
				display: grid;
				grid-template-columns: 1fr 1fr;
				gap: 20px;
			}

			@media (max-width: 640px) {
				.detail-grid {
					grid-template-columns: 1fr;
				}
			}

			.modal-actions {
				display: flex;
				gap: 12px;
				padding-top: 16px;
				border-top: 2px solid var(--color-bg-tertiary);
			}

			.modal-actions .btn-action {
				flex: 1;
				padding: 12px 24px;
				font-size: 14px;
			}

			/* Toast Container and Notification System */
			.toast-container {
				position: fixed;
				top: 20px;
				right: 20px;
				z-index: 9999;
				max-width: 400px;
				display: flex;
				flex-direction: column;
				gap: 12px;
			}

			@media (max-width: 768px) {
				.toast-container {
					left: 12px;
					right: 12px;
					top: 12px;
					max-width: none;
				}
			}

			.toast {
				padding: 16px;
				border-radius: var(--radius-md); /* 8px */
				display: flex;
				align-items: flex-start;
				gap: 12px;
				box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
				animation: slideInRight 0.3s ease-out;
				min-width: clamp(280px, 90vw, 400px); /* Responsive width */
				position: relative;
			}

			@media (max-width: 768px) {
				.toast {
					min-width: auto;
				}
			}

			.toast.removing {
				animation: slideOutRight 0.3s ease-in forwards;
			}

			.toast-success {
				background: var(--color-success);
				color: white;
				border: 2px solid var(--color-success-dark);
				box-shadow: 0 8px 24px rgba(5, 150, 105, 0.35); /* More prominent shadow */
			}

			.toast-success .toast-icon {
				animation: successPulse 0.6s ease-out;
			}

			@keyframes successPulse {
				0% { transform: scale(0.5); opacity: 0; }
				50% { transform: scale(1.2); }
				100% { transform: scale(1); opacity: 1; }
			}

			.toast-error {
				background: var(--color-error);
				color: white;
			}

			.toast-warning {
				background: var(--color-warning);
				color: var(--color-text-primary);
			}

			.toast-info {
				background: var(--color-primary);
				color: white;
			}

			.toast-loading {
				background: var(--color-primary);
				color: white;
			}

			.toast-icon {
				font-size: 20px;
				flex-shrink: 0;
				line-height: 1;
			}

			.toast-content {
				flex: 1;
				min-width: 0;
			}

			.toast-message {
				font-size: 14px;
				font-weight: 600;
				margin: 0 0 4px 0;
				line-height: 1.4;
			}

			.toast-details {
				font-size: 12px;
				opacity: 0.9;
				margin: 4px 0 0 0;
				line-height: 1.4;
			}

			.toast-actions {
				display: flex;
				gap: 8px;
				margin-top: 8px;
			}

			.toast-action {
				background: rgba(255, 255, 255, 0.2);
				border: none;
				color: inherit;
				padding: 4px 12px;
				border-radius: var(--radius-sm); /* 4px */
				cursor: pointer;
				font-size: 12px;
				font-weight: 500;
				transition: background 0.2s;
				flex-shrink: 0;
			}

			.toast-action:hover {
				background: rgba(255, 255, 255, 0.3);
			}

			.toast-close {
				background: none;
				border: none;
				color: inherit;
				cursor: pointer;
				font-size: 20px;
				opacity: 0.7;
				transition: opacity 0.2s;
				padding: 0;
				flex-shrink: 0;
				line-height: 1;
				width: 20px;
				height: 20px;
				display: flex;
				align-items: center;
				justify-content: center;
			}

			.toast-close:hover {
				opacity: 1;
			}

			@keyframes slideInRight {
				from {
					transform: translateX(400px);
					opacity: 0;
				}
				to {
					transform: translateX(0);
					opacity: 1;
				}
			}

			@keyframes slideOutRight {
				from {
					transform: translateX(0);
					opacity: 1;
				}
				to {
					transform: translateX(400px);
					opacity: 0;
				}
			}

			/* Loading Spinners */
			.spinner {
				display: inline-block;
				width: 40px;
				height: 40px;
				border: 4px solid rgba(255, 255, 255, 0.3);
				border-top-color: white;
				border-radius: 50%;
				animation: spin 1s linear infinite;
			}

			.spinner.small {
				width: 20px;
				height: 20px;
				border-width: 2px;
			}

			.spinner.medium {
				width: 40px;
				height: 40px;
				border-width: 4px;
			}

			.spinner.large {
				width: 60px;
				height: 60px;
				border-width: 6px;
			}

			.spinner.blue {
				border-color: rgba(59, 130, 246, 0.3);
				border-top-color: var(--color-primary);
			}

			.spinner.green {
				border-color: rgba(16, 185, 129, 0.3);
				border-top-color: var(--color-success);
			}

			@keyframes spin {
				to {
					transform: rotate(360deg);
				}
			}

			/* Button Loading States */
			button.loading {
				position: relative;
				pointer-events: none;
				opacity: 0.7;
			}

			button.loading .button-text {
				opacity: 0;
			}

			button.loading::after {
				content: '';
				position: absolute;
				width: 16px;
				height: 16px;
				top: 50%;
				left: 50%;
				margin-left: -8px;
				margin-top: -8px;
				border: 2px solid rgba(255, 255, 255, 0.3);
				border-top-color: white;
				border-radius: 50%;
				animation: spin 0.8s linear infinite;
			}

			/* Status Badges */
			.status-badge {
				display: inline-flex;
				align-items: center;
				gap: 6px;
				padding: 4px 12px;
				border-radius: var(--radius-lg); /* 12px */
				font-size: 12px;
				font-weight: 600;
				text-transform: uppercase;
				letter-spacing: 0.3px;
			}

			.status-badge.pending {
				background: var(--color-border-primary);
				color: var(--color-neutral);
			}

			.status-badge.processing {
				background: var(--color-primary-light);
				color: var(--color-primary-dark);
			}

			.status-badge.success {
				background: var(--color-success-light);
				color: var(--color-success-dark);
			}

			.status-badge.delivered {
				background: var(--color-success-light);
				color: var(--color-success-dark);
			}

			.status-badge.error {
				background: var(--color-error-light);
				color: var(--color-error-dark);
			}

			.status-badge.failed {
				background: var(--color-error-light);
				color: var(--color-error-dark);
			}

			.status-badge.retry {
				background: var(--color-warning-light);
				color: var(--color-warning-dark);
			}

			.status-badge.retrying {
				background: var(--color-warning-light);
				color: var(--color-warning-dark);
			}

			.status-badge .spinner {
				width: 12px;
				height: 12px;
				border-width: 2px;
				border-color: currentColor;
				border-top-color: transparent;
				opacity: 0.5;
			}

			/* Progress Indicators */
			.progress-container {
				width: 100%;
				margin: 12px 0;
			}

			.progress-bar {
				width: 100%;
				height: 8px;
				background: var(--color-border-primary);
				border-radius: var(--radius-sm); /* 4px */
				overflow: hidden;
				position: relative;
			}

			.progress-fill {
				height: 100%;
				background: var(--color-primary);
				transition:
					width 0.3s ease,
					background 0.3s ease;
				border-radius: var(--radius-sm); /* 4px */
			}

			.progress-fill.low {
				background: var(--color-neutral-light);
			}

			.progress-fill.medium {
				background: var(--color-primary);
			}

			.progress-fill.high {
				background: var(--color-success);
			}

			.progress-fill.pulse {
				animation: progressPulse 1s ease-in-out;
			}

			@keyframes progressPulse {
				0%,
				100% {
					opacity: 1;
				}
				50% {
					opacity: 0.7;
				}
			}

			.progress-text {
				font-size: 12px;
				color: var(--color-neutral);
				margin-top: 4px;
				display: block;
				text-align: center;
			}

			/* Skeleton Loading - Enhanced for metrics, charts, and content */
			.skeleton-row {
				display: flex;
				gap: 16px;
				padding: 12px 0;
				animation: skeletonPulse 2s ease-in-out infinite;
			}

			.skeleton-box {
				background: var(--color-border-primary);
				border-radius: var(--radius-sm); /* 4px */
				height: 20px;
			}

			/* Skeleton Metric Card */
			.skeleton-metric-card {
				background: var(--color-bg-secondary);
				border: 1px solid var(--color-border-primary);
				border-radius: var(--radius-md);
				padding: 20px;
				text-align: center;
				animation: skeletonPulse 2s ease-in-out infinite;
			}

			.skeleton-metric-value {
				background: var(--color-border-primary);
				height: 36px;
				border-radius: var(--radius-sm);
				margin-bottom: 8px;
			}

			.skeleton-metric-label {
				background: var(--color-border-primary);
				height: 14px;
				border-radius: var(--radius-sm);
				width: 70%;
				margin: 0 auto;
			}

			/* Skeleton Chart Container */
			.skeleton-chart {
				background: var(--color-bg-secondary);
				border-radius: var(--radius-md);
				height: 300px;
				position: relative;
				overflow: hidden;
				animation: skeletonPulse 2s ease-in-out infinite;
			}

			.skeleton-chart::after {
				content: '';
				position: absolute;
				top: 50%;
				left: 50%;
				transform: translate(-50%, -50%);
				width: 40px;
				height: 40px;
				border: 4px solid var(--color-border-primary);
				border-top-color: var(--color-primary);
				border-radius: 50%;
				animation: spin 1s linear infinite;
			}

			/* Skeleton for Event Inbox / Log Viewer */
			.skeleton-log-entry {
				background: var(--color-bg-secondary);
				border: 1px solid var(--color-border-primary);
				border-radius: var(--radius-sm);
				padding: 12px;
				margin-bottom: 8px;
				animation: skeletonPulse 2s ease-in-out infinite;
			}

			.skeleton-log-header {
				background: var(--color-border-primary);
				height: 16px;
				border-radius: var(--radius-sm);
				width: 60%;
				margin-bottom: 8px;
			}

			.skeleton-log-content {
				background: var(--color-border-primary);
				height: 14px;
				border-radius: var(--radius-sm);
				width: 90%;
			}

			@keyframes skeletonPulse {
				0%,
				100% {
					opacity: 1;
				}
				50% {
					opacity: 0.5;
				}
			}

			/* Form Validation Feedback */
			.form-group.error input,
			.form-group.error textarea,
			.form-group.error select {
				border-color: var(--color-error);
				background: var(--color-error-light);
			}

			.form-group.success input,
			.form-group.success textarea,
			.form-group.success select {
				border-color: var(--color-success);
			}

			.form-group.success::after {
				content: '✓';
				position: absolute;
				right: 12px;
				top: 38px;
				color: var(--color-success);
				font-weight: bold;
			}

			.form-error-message {
				color: var(--color-error);
				font-size: 12px;
				margin-top: 4px;
				display: none;
			}

			.form-group.error .form-error-message {
				display: block;
			}

			.form-error-summary {
				background: var(--color-error-light);
				border: 1px solid var(--color-error-light);
				border-radius: var(--radius-base); /* 6px */
				padding: 12px;
				margin-bottom: 20px;
				color: var(--color-error-dark);
				font-size: 14px;
				display: none;
			}

			.form-error-summary.visible {
				display: block;
			}

			/* Success Animation */
			.success-checkmark {
				width: 80px;
				height: 80px;
				border-radius: 50%;
				background: var(--color-success);
				position: fixed;
				top: 50%;
				left: 50%;
				transform: translate(-50%, -50%) scale(0);
				z-index: 10000;
				display: flex;
				align-items: center;
				justify-content: center;
				animation: successPop 0.5s ease-out forwards;
			}

			.success-checkmark::after {
				content: '✓';
				color: white;
				font-size: 48px;
				font-weight: bold;
			}

			@keyframes successPop {
				0% {
					transform: translate(-50%, -50%) scale(0);
					opacity: 0;
				}
				50% {
					transform: translate(-50%, -50%) scale(1.2);
					opacity: 1;
				}
				100% {
					transform: translate(-50%, -50%) scale(1);
					opacity: 0;
				}
			}

			/* Pulse Animation for Real-time Updates */
			.pulse-update {
				animation: pulseGlow 2s ease-in-out;
			}

			@keyframes pulseGlow {
				0%,
				100% {
					background-color: inherit;
				}
				50% {
					background-color: var(--color-primary-light);
				}
			}

			/* Empty States - Enhanced (Medium Priority Issue #5) */
			.empty-state {
				text-align: center;
				padding: 60px 20px;
				color: var(--color-text-secondary);
				background: var(--color-bg-secondary);
				border-radius: var(--radius-lg);
				border: 2px dashed var(--color-border-primary);
				margin: var(--spacing-xl) 0;
			}

			.empty-state-icon {
				font-size: 64px;
				margin-bottom: 16px;
				opacity: 0.7;
				line-height: 1;
				animation: emptyStatePulse 2s ease-in-out infinite;
			}

			@keyframes emptyStatePulse {
				0%, 100% { opacity: 0.7; }
				50% { opacity: 0.4; }
			}

			.empty-state-title {
				font-size: 18px;
				font-weight: 600;
				color: var(--color-text-primary);
				margin-bottom: 8px;
			}

			.empty-state-description {
				font-size: 14px;
				color: var(--color-text-secondary);
				margin-bottom: 20px;
				line-height: var(--line-height-relaxed);
			}

			.empty-state-action {
				display: inline-flex;
				align-items: center;
				gap: var(--spacing-sm);
				padding: var(--spacing-md) var(--spacing-xl);
				background: var(--color-primary);
				color: var(--color-text-inverse);
				border-radius: var(--radius-base);
				text-decoration: none;
				font-weight: 600;
				transition: all var(--transition-base);
				border: none;
				cursor: pointer;
				min-height: var(--btn-height-md);
			}

			.empty-state-action:hover {
				background: var(--color-primary-dark);
				transform: translateY(-1px);
				box-shadow: var(--shadow-md);
			}

			/* Disabled State Tooltips */
			button:disabled {
				opacity: 0.5;
				cursor: not-allowed;
				position: relative;
			}

			button:disabled:hover::before {
				content: attr(data-tooltip);
				position: absolute;
				bottom: 100%;
				left: 50%;
				transform: translateX(-50%);
				background: var(--color-text-primary);
				color: white;
				padding: 8px 12px;
				border-radius: var(--radius-base); /* 6px */
				font-size: 12px;
				white-space: nowrap;
				margin-bottom: 8px;
				z-index: 1000;
			}

			button:disabled:hover::after {
				content: '';
				position: absolute;
				bottom: 100%;
				left: 50%;
				transform: translateX(-50%);
				border: 6px solid transparent;
				border-top-color: var(--color-text-primary);
				margin-bottom: 2px;
			}

			.inbox-empty {
				text-align: center;
				padding: 60px 20px;
				color: var(--color-text-secondary);
			}

			.inbox-empty-icon {
				font-size: 48px;
				margin-bottom: 16px;
			}

			.inbox-loading {
				text-align: center;
				padding: 60px 20px;
				color: var(--color-text-secondary);
			}

			/* Live Logs Styles */
			.log-level-badge {
				display: inline-block;
				padding: 4px 10px;
				border-radius: var(--radius-lg); /* 12px */
				font-size: 11px;
				font-weight: 600;
				text-transform: uppercase;
				letter-spacing: 0.3px;
			}

			.log-level-badge.debug {
				background: var(--color-border-primary);
				color: var(--color-neutral);
			}

			.log-level-badge.info {
				background: var(--color-primary-light);
				color: var(--color-primary-dark);
			}

			.log-level-badge.warn {
				background: var(--color-warning-light);
				color: var(--color-warning-dark);
			}

			.log-level-badge.error {
				background: var(--color-error-light);
				color: var(--color-error-dark);
			}

			.log-row-error {
				background: var(--color-error-light) !important;
				border-left: 3px solid var(--color-error-dark);
			}

			.log-row-warn {
				background: var(--color-warning-light) !important;
				border-left: 3px solid var(--color-warning);
			}

			.log-correlation {
				font-family: 'Monaco', 'Menlo', monospace;
				font-size: 11px;
				color: var(--color-primary-dark);
				cursor: pointer;
				text-decoration: underline;
			}

			.log-correlation:hover {
				color: var(--color-primary-hover);
			}

			.log-message {
				font-size: 13px;
				color: var(--color-text-primary);
				word-break: break-word;
			}

			.log-message mark {
				background: var(--color-warning-light);
				padding: 2px 4px;
				border-radius: 3px;
			}

			.log-status-badge {
				font-family: 'Monaco', 'Menlo', monospace;
				font-size: 12px;
				font-weight: 600;
			}

			.log-status-badge.success {
				color: var(--color-success-dark);
			}

			.log-status-badge.client-error {
				color: var(--color-warning-dark);
			}

			.log-status-badge.server-error {
				color: var(--color-error-dark);
			}

			.log-duration {
				font-family: 'Monaco', 'Menlo', monospace;
				font-size: 12px;
				color: var(--color-text-secondary);
			}

			.log-duration.slow {
				color: var(--color-warning-dark);
				font-weight: 600;
			}

			.log-time {
				font-family: 'Monaco', 'Menlo', monospace;
				font-size: 11px;
				color: var(--color-text-secondary);
				white-space: nowrap;
			}

			/* Enhanced Metrics Charts Styles */
			.metrics-controls {
				display: flex;
				justify-content: space-between;
				align-items: center;
				margin-bottom: 24px;
				flex-wrap: wrap;
				gap: 16px;
			}

			.time-range-selector {
				display: flex;
				gap: 8px;
				background: var(--color-bg-secondary);
				padding: 4px;
				border-radius: var(--radius-md); /* 8px */
				border: 1px solid var(--color-border-primary);
			}

			.time-range-btn {
				padding: 8px 16px;
				border: none;
				background: transparent;
				color: var(--color-text-secondary);
				font-size: 14px;
				font-weight: 600;
				border-radius: var(--radius-base); /* 6px */
				cursor: pointer;
				transition: all 0.2s;
			}

			.time-range-btn:hover {
				background: var(--color-border-primary);
			}

			.time-range-btn.active {
				background: var(--color-primary);
				color: white;
			}

			.metrics-actions {
				display: flex;
				gap: 8px;
				align-items: center;
			}

			.btn-pause {
				padding: 8px 16px;
				border: 1px solid var(--color-border-secondary);
				background: white;
				color: var(--color-text-primary);
				font-size: 14px;
				font-weight: 600;
				border-radius: var(--radius-base); /* 6px */
				cursor: pointer;
				transition: all 0.2s;
			}

			.btn-pause:hover {
				background: var(--color-bg-secondary);
			}

			.btn-pause.paused {
				background: var(--color-warning-light);
				color: var(--color-warning-dark);
				border-color: var(--color-warning);
			}

			.charts-grid {
				display: grid;
				grid-template-columns: 1fr;
				gap: 24px;
				margin-bottom: 24px;
			}

			@media (min-width: 1024px) {
				.charts-grid {
					grid-template-columns: repeat(2, 1fr);
				}

				.chart-full-width {
					grid-column: 1 / -1;
				}
			}

			.chart-card {
				background: var(--color-bg-secondary);
				border: 1px solid var(--color-border-primary);
				border-radius: var(--radius-md); /* 8px */
				padding: 20px;
			}

			.chart-header {
				display: flex;
				justify-content: space-between;
				align-items: center;
				margin-bottom: 16px;
			}

			.chart-title {
				font-size: 16px;
				font-weight: 700;
				color: var(--color-text-primary);
			}

			.chart-subtitle {
				font-size: 12px;
				color: var(--color-text-secondary);
				margin-top: 4px;
			}

			.chart-container {
				position: relative;
				height: 300px;
			}

			.chart-container.small {
				height: 250px;
			}

			.chart-empty {
				display: flex;
				align-items: center;
				justify-content: center;
				height: 300px;
				color: var(--color-text-secondary);
				font-size: 14px;
			}

			.metric-trend {
				display: flex;
				align-items: center;
				gap: 8px;
				margin-top: 8px;
				font-size: 14px;
			}

			.trend-arrow {
				font-size: 16px;
				font-weight: 700;
			}

			.trend-arrow.up {
				color: var(--color-error);
			}

			.trend-arrow.down {
				color: var(--color-success);
			}

			.trend-arrow.stable {
				color: var(--color-neutral);
			}

			.trend-percentage {
				font-weight: 600;
			}

			.enhanced-metric-card {
				position: relative;
			}

			.metric-icon {
				position: absolute;
				top: 20px;
				right: 20px;
				font-size: 32px;
				opacity: 0.1;
			}

			@media (max-width: 768px) {
				.charts-grid {
					grid-template-columns: 1fr;
				}

				.chart-container {
					height: 250px;
				}

				.metrics-controls {
					flex-direction: column;
					align-items: stretch;
				}

				.time-range-selector {
					justify-content: space-between;
				}

				.metrics-actions {
					justify-content: space-between;
				}
			}

			/* Event Flow Visualization Styles */
			.event-flow-section {
				background: white;
				border: 2px solid var(--color-border-primary);
				border-radius: var(--radius-lg); /* 12px */
				padding: 24px;
				margin-bottom: 32px;
			}

			.flow-section-title {
				margin: 0 0 20px 0;
				font-size: 18px;
				font-weight: 600;
				color: var(--color-text-primary);
			}

			.flow-diagram {
				width: 100%;
				max-width: 1200px;
				height: auto;
				margin: 0 auto 20px;
				display: block;
			}

			.stage-box {
				cursor: pointer;
				transition: all 0.3s ease;
			}

			.stage-box:hover {
				filter: drop-shadow(0 6px 12px rgba(0, 0, 0, 0.15));
			}

			.stage-rect {
				stroke-width: 2;
				transition: all 0.3s ease;
			}

			.stage-box[data-status='normal'] .stage-rect {
				stroke: var(--color-success);
				fill: url(#normalGradient);
			}

			.stage-box[data-status='degraded'] .stage-rect {
				stroke: var(--color-warning);
				fill: url(#degradedGradient);
				animation: pulse-box 2s ease-in-out infinite;
			}

			.stage-box[data-status='critical'] .stage-rect {
				stroke: var(--color-error);
				fill: url(#criticalGradient);
				animation: pulse-box 1s ease-in-out infinite;
			}

			@keyframes pulse-box {
				0%,
				100% {
					opacity: 1;
				}
				50% {
					opacity: 0.7;
				}
			}

			.stage-title {
				text-anchor: middle;
				font-size: 16px;
				font-weight: 600;
				fill: var(--color-text-primary);
			}

			.stage-icon {
				text-anchor: middle;
				font-size: 36px;
			}

			.stage-metric {
				text-anchor: middle;
				font-size: 20px;
				font-weight: 700;
				fill: var(--color-text-primary);
				transition: fill 0.3s ease;
			}

			.stage-metric.updating {
				fill: var(--color-primary);
				animation: metric-update 0.3s ease;
			}

			@keyframes metric-update {
				0%,
				100% {
					transform: scale(1);
				}
				50% {
					transform: scale(1.1);
				}
			}

			.stage-label {
				text-anchor: middle;
				font-size: 13px;
				fill: var(--color-neutral);
			}

			.trend-indicator {
				transition: all 0.3s ease;
			}

			.flow-line {
				stroke-dashoffset: 0;
				animation: flow-animation 2s linear infinite;
				transition: all 0.3s ease;
			}

			@keyframes flow-animation {
				to {
					stroke-dashoffset: -10;
				}
			}

			.flow-line.active {
				stroke-width: 4;
				animation:
					flow-animation 1s linear infinite,
					glow 1.5s ease-in-out infinite;
			}

			@keyframes glow {
				0%,
				100% {
					filter: drop-shadow(0 0 2px var(--color-primary));
				}
				50% {
					filter: drop-shadow(0 0 6px var(--color-primary));
				}
			}

			.dlq-arrow {
				transition: all 0.3s ease;
			}

			.dlq-arrow.active {
				opacity: 1;
				stroke-width: 4;
				animation:
					flow-animation 1s linear infinite,
					pulse-error 1.5s ease-in-out infinite;
			}

			@keyframes pulse-error {
				0%,
				100% {
					opacity: 1;
				}
				50% {
					opacity: 0.5;
				}
			}

			.flow-label {
				font-size: 13px;
				fill: var(--color-primary);
				font-weight: 600;
				text-anchor: middle;
			}

			.flow-label-error {
				fill: var(--color-error);
			}

			.flow-legend {
				display: flex;
				gap: 20px;
				align-items: center;
				padding-top: 16px;
				border-top: 1px solid var(--color-border-primary);
				flex-wrap: wrap;
			}

			.legend-item {
				display: flex;
				align-items: center;
				gap: 8px;
				font-size: 13px;
				color: var(--color-neutral-dark);
			}

			.legend-color {
				width: 14px;
				height: 14px;
				border-radius: 3px;
				border: 1px solid var(--color-border-secondary);
			}

			.btn-export {
				margin-left: auto;
				padding: 8px 16px;
				background: var(--color-primary);
				color: white;
				border: none;
				border-radius: var(--radius-base); /* 6px */
				font-size: 13px;
				font-weight: 600;
				cursor: pointer;
				transition: all 0.3s ease;
			}

			.btn-export:hover {
				background: var(--color-primary-dark);
				transform: translateY(-1px);
				box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
			}

			.flow-detail-popover {
				position: fixed;
				background: white;
				border: 2px solid var(--color-border-primary);
				border-radius: 10px;
				padding: 20px;
				box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
				max-width: 300px;
				z-index: 1000;
				animation: popover-appear 0.2s ease-out;
			}

			@keyframes popover-appear {
				from {
					opacity: 0;
					transform: translateY(-10px);
				}
				to {
					opacity: 1;
					transform: translateY(0);
				}
			}

			.flow-detail-popover.hidden {
				display: none;
			}

			.popover-close {
				position: absolute;
				top: 10px;
				right: 10px;
				background: none;
				border: none;
				font-size: var(--font-size-2xl); /* 24px variable */
				color: var(--color-neutral-light);
				cursor: pointer;
				padding: 0;
				width: 24px;
				height: 24px;
				line-height: 1;
				transition: color 0.2s;
			}

			.popover-close:hover {
				color: var(--color-text-primary);
			}

			.popover-title {
				margin: 0 0 16px 0;
				font-size: 16px;
				font-weight: 600;
				color: var(--color-text-primary);
			}

			.popover-content {
				display: flex;
				flex-direction: column;
				gap: 10px;
			}

			.popover-metric {
				display: flex;
				justify-content: space-between;
				font-size: 13px;
			}

			.popover-label {
				color: var(--color-neutral);
				font-weight: 500;
			}

			.popover-value {
				color: var(--color-text-primary);
				font-weight: 600;
			}

			#popover-sparkline {
				margin-top: 8px;
				border-top: 1px solid var(--color-border-primary);
				padding-top: 8px;
			}

			.flow-controls {
				margin-top: 16px;
				padding-top: 16px;
				border-top: 1px solid var(--color-border-primary);
			}

			.toggle-label {
				display: flex;
				align-items: center;
				gap: 8px;
				font-size: 13px;
				color: var(--color-neutral-dark);
				cursor: pointer;
			}

			.toggle-label input[type='checkbox'] {
				width: 18px;
				height: 18px;
				cursor: pointer;
			}

			/* Particle Animation */
			.event-particle {
				animation: particle-move 3s linear;
			}

			@keyframes particle-move {
				0% {
					opacity: 0;
				}
				10% {
					opacity: 1;
				}
				90% {
					opacity: 1;
				}
				100% {
					opacity: 0;
				}
			}

			/* Responsive Design */
			@media (max-width: 768px) {
				.event-flow-section {
					padding: 16px;
				}

				.flow-diagram {
					height: auto;
				}

				.flow-legend {
					flex-direction: column;
					align-items: flex-start;
				}

				.btn-export {
					margin-left: 0;
					width: 100%;
				}

				.flow-detail-popover {
					left: 50% !important;
					top: 50% !important;
					transform: translate(-50%, -50%) !important;
					max-width: 90%;
				}
			}

			/* Debug Control Panel Styles - Enhanced (Medium Priority Issue #12) */
			.debug-panel {
				border: 1px solid var(--color-border-primary); /* Reduced from 2px for subtlety */
				border-radius: var(--radius-md); /* 8px */
				background: var(--color-bg-secondary);
				padding: 16px;
				margin-top: 40px;
				margin-bottom: 40px;
				opacity: 0.95; /* Slightly transparent to de-emphasize */
				transition: all var(--transition-base);
			}

			.debug-panel:hover {
				opacity: 1;
				border-color: var(--color-border-secondary);
			}

			.debug-header {
				display: flex;
				justify-content: space-between;
				align-items: center;
				margin-bottom: 16px;
				flex-wrap: wrap;
				gap: 12px;
			}

			.debug-header-left {
				flex: 1;
			}

			.debug-header h2 {
				margin: 0;
				font-size: 18px;
				font-weight: 600;
				color: var(--color-text-primary);
			}

			.debug-header .subtitle {
				margin: 4px 0 0 0;
				font-size: 14px;
				color: var(--color-neutral);
			}

			.debug-header-actions {
				display: flex;
				gap: 8px;
				align-items: center;
			}

			.help-icon-btn,
			.collapse-btn {
				padding: var(--spacing-sm) var(--spacing-md);
				min-height: var(--btn-height-sm); /* Touch-friendly */
				border: 1px solid var(--color-border-secondary);
				border-radius: var(--radius-base); /* 6px */
				background: white;
				color: var(--color-primary);
				font-size: 14px;
				font-weight: 600;
				cursor: pointer;
				transition: all var(--transition-base);
				display: inline-flex;
				align-items: center;
				gap: var(--spacing-xs);
			}

			.help-icon-btn:hover,
			.collapse-btn:hover {
				background: var(--color-bg-tertiary);
				transform: translateY(-1px);
			}

			.collapse-btn::after {
				content: '▼';
				font-size: 10px;
				transition: transform var(--transition-base);
			}

			.debug-panel.collapsed .collapse-btn::after {
				transform: rotate(-90deg);
			}

			.debug-content.collapsed {
				display: none;
			}

			.debug-cards-grid {
				display: grid;
				grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
				gap: 16px;
				margin-bottom: 20px;
			}

			.debug-card {
				border: 1px solid var(--color-border-secondary);
				border-radius: var(--radius-base); /* 6px */
				padding: 12px;
				background: white;
				transition: box-shadow 0.2s;
			}

			.debug-card:hover {
				box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
			}

			.card-header {
				display: flex;
				align-items: center;
				gap: 8px;
				margin-bottom: 8px;
			}

			.card-icon {
				font-size: 20px;
			}

			.card-header h3 {
				margin: 0;
				font-size: 14px;
				font-weight: 600;
				color: var(--color-text-primary);
			}

			.card-description {
				font-size: 13px;
				color: var(--color-neutral-dark);
				margin: 8px 0;
				line-height: 1.4;
			}

			.debug-btn {
				width: 100%;
				padding: 8px 12px;
				border: none;
				border-radius: var(--radius-sm); /* 4px */
				font-size: 13px;
				font-weight: 500;
				cursor: pointer;
				transition: all 0.2s;
				margin-top: 8px;
			}

			.debug-btn.primary {
				background: var(--color-primary);
				color: white;
			}

			.debug-btn.primary:hover:not(:disabled) {
				background: var(--color-primary-dark);
			}

			.debug-btn:disabled {
				opacity: 0.6;
				cursor: not-allowed;
			}

			.expected-result {
				font-size: 12px;
				color: var(--color-neutral-light);
				margin: 8px 0 0 0;
				font-style: italic;
			}

			.debug-section {
				margin-top: 16px;
				padding-top: 16px;
				border-top: 1px solid var(--color-border-primary);
			}

			.debug-section h4 {
				margin: 0 0 12px 0;
				font-size: 14px;
				font-weight: 600;
				color: var(--color-text-primary);
			}

			.section-header {
				display: flex;
				justify-content: space-between;
				align-items: center;
				margin-bottom: 12px;
			}

			.section-header h4 {
				margin: 0;
			}

			.btn-text {
				background: none;
				border: none;
				color: var(--color-primary);
				cursor: pointer;
				font-size: 13px;
				font-weight: 600;
				text-decoration: underline;
				padding: 0;
			}

			.btn-text:hover {
				color: var(--color-primary-dark);
			}

			.checkbox-label {
				display: flex;
				align-items: center;
				gap: 8px;
				font-size: 14px;
				cursor: pointer;
				margin-bottom: 12px;
			}

			.checkbox-label input[type='checkbox'] {
				width: auto;
				cursor: pointer;
			}

			.payload-select,
			.input-group input {
				width: 100%;
				padding: 8px;
				border: 1px solid var(--color-border-secondary);
				border-radius: var(--radius-sm); /* 4px */
				font-size: 14px;
				margin-bottom: 8px;
			}

			.input-group {
				margin-bottom: 8px;
			}

			.input-group label {
				display: block;
				font-size: 13px;
				font-weight: 500;
				color: var(--color-text-primary);
				margin-bottom: 4px;
			}

			.custom-payload {
				width: 100%;
				min-height: 100px;
				padding: 8px;
				border: 1px solid var(--color-border-secondary);
				border-radius: var(--radius-sm); /* 4px */
				font-family: 'Monaco', 'Menlo', monospace;
				font-size: 12px;
			}

			.custom-payload.hidden {
				display: none;
			}

			.quick-templates {
				display: grid;
				grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
				gap: 8px;
			}

			.template-btn {
				padding: 8px;
				background: var(--color-bg-tertiary);
				border: 1px solid var(--color-border-secondary);
				border-radius: var(--radius-sm); /* 4px */
				cursor: pointer;
				font-size: 13px;
				transition: all 0.2s;
			}

			.template-btn:hover {
				background: var(--color-border-primary);
				border-color: var(--color-neutral-light);
			}

			.progress-bar-debug {
				width: 100%;
				height: 24px;
				background: var(--color-border-primary);
				border-radius: var(--radius-sm); /* 4px */
				overflow: hidden;
				position: relative;
				margin: 12px 0;
			}

			.progress-fill {
				height: 100%;
				background: linear-gradient(90deg, var(--color-primary), var(--color-primary-dark));
				width: 0%;
				transition: width 0.3s;
			}

			.progress-text {
				position: absolute;
				top: 50%;
				left: 50%;
				transform: translate(-50%, -50%);
				font-size: 12px;
				font-weight: 600;
				color: var(--color-text-primary);
			}

			.progress-bar-debug.hidden {
				display: none;
			}

			.debug-history {
				max-height: 300px;
				overflow-y: auto;
			}

			.history-entry {
				padding: 8px;
				border-left: 3px solid var(--color-primary);
				background: white;
				margin-bottom: 8px;
				border-radius: var(--radius-sm); /* 4px */
				font-size: 12px;
			}

			.history-entry[data-status='200'],
			.history-entry[data-status='201'],
			.history-entry[data-status='202'] {
				border-left-color: var(--color-success);
			}

			.history-entry[data-status='400'],
			.history-entry[data-status='401'],
			.history-entry[data-status='404'],
			.history-entry[data-status='409'] {
				border-left-color: var(--color-warning);
			}

			.history-entry[data-status='500'],
			.history-entry[data-status='503'] {
				border-left-color: var(--color-error);
			}

			.entry-header {
				display: flex;
				gap: 8px;
				margin-bottom: 8px;
				flex-wrap: wrap;
			}

			.timestamp {
				color: var(--color-neutral);
				font-size: 11px;
			}

			.flag-badge {
				padding: 2px 6px;
				border-radius: 3px;
				background: var(--color-bg-tertiary);
				font-weight: 500;
				font-size: 11px;
			}

			.status-badge-debug {
				padding: 2px 6px;
				border-radius: 3px;
				background: var(--color-bg-tertiary);
				font-weight: 500;
				font-size: 11px;
			}

			.expand-btn {
				background: none;
				border: none;
				color: var(--color-primary);
				cursor: pointer;
				font-size: 11px;
				text-decoration: underline;
				margin-left: 8px;
				padding: 0;
			}

			.expand-btn:hover {
				color: var(--color-primary-dark);
			}

			.details {
				margin-top: 8px;
				padding: 8px;
				background: var(--color-bg-secondary);
				border-radius: var(--radius-sm); /* 4px */
				font-family: 'Monaco', 'Menlo', monospace;
				overflow-x: auto;
			}

			.details.hidden {
				display: none;
			}

			.details pre {
				margin: 0;
				font-size: 11px;
			}

			.empty-state {
				color: var(--color-neutral-light);
				font-style: italic;
				text-align: center;
				padding: 20px;
				font-size: 13px;
			}

			.debug-metrics {
				margin-top: 16px;
				padding-top: 16px;
				border-top: 1px solid var(--color-border-primary);
				display: grid;
				grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
				gap: 12px;
			}

			.metric-item {
				display: flex;
				flex-direction: column;
				font-size: 13px;
			}

			.metric-label {
				color: var(--color-neutral);
				font-weight: 500;
				font-size: 12px;
			}

			.metric-value {
				color: var(--color-text-primary);
				font-weight: 600;
				margin-top: 4px;
			}

			.scenario-dropdown {
				width: 100%;
				padding: 8px;
				border: 1px solid var(--color-border-secondary);
				border-radius: var(--radius-sm); /* 4px */
				font-size: 14px;
				margin-bottom: 8px;
				background: white;
				cursor: pointer;
			}

			.scenario-btn {
				width: 100%;
				padding: 10px;
				background: var(--color-primary);
				color: white;
				border: none;
				border-radius: var(--radius-sm); /* 4px */
				font-size: 14px;
				font-weight: 600;
				cursor: pointer;
				transition: all 0.2s;
			}

			.scenario-btn:hover:not(:disabled) {
				background: var(--color-primary-dark);
			}

			.scenario-btn:disabled {
				opacity: 0.6;
				cursor: not-allowed;
			}

			.keyboard-shortcuts {
				font-size: 11px;
				color: var(--color-neutral);
				margin-top: 8px;
				padding: 8px;
				background: var(--color-bg-secondary);
				border-radius: var(--radius-sm); /* 4px */
			}

			.keyboard-shortcuts kbd {
				background: var(--color-border-primary);
				padding: 2px 6px;
				border-radius: 3px;
				font-family: 'Monaco', 'Menlo', monospace;
				font-size: 10px;
				border: 1px solid var(--color-border-secondary);
			}

			@media (max-width: 768px) {
				.debug-cards-grid {
					grid-template-columns: 1fr;
				}

				.quick-templates {
					grid-template-columns: repeat(2, 1fr);
				}

				.debug-header {
					flex-direction: column;
					align-items: flex-start;
				}
			}

			/* ============================================
       COMPREHENSIVE RESPONSIVE DESIGN
       Breakpoints: 320px (mobile), 768px (tablet), 1024px (laptop), 1400px (desktop)
       ============================================ */

			/* Mobile-first: 320px - 767px */
			@media (max-width: 767px) {
				body {
					padding: var(--spacing-md);
				}

				.container {
					padding: var(--spacing-lg);
					max-width: 100%;
				}

				h1 {
					font-size: var(--font-size-2xl);
				}

				h2 {
					font-size: var(--font-size-lg);
				}

				.button-group {
					flex-direction: column;
				}

				.button-group button {
					width: 100%;
				}

				/* Grid becomes single column on mobile */
				.grid-2,
				.grid-3,
				.grid-4,
				.grid-6,
				.grid-12 {
					grid-template-columns: 1fr;
				}

				/* Stack metrics vertically */
				.metrics-header {
					flex-direction: column;
					align-items: flex-start;
					gap: var(--spacing-md);
				}

				/* Ensure touch targets are minimum 44px */
				button,
				.btn-action,
				input[type='checkbox'],
				select {
					min-height: 44px;
					min-width: 44px;
				}

				/* Font size minimum 12px for readability */
				.hint,
				code,
				pre,
				.timestamp {
					font-size: max(12px, var(--font-size-xs));
				}
			}

			/* Tablet: 768px - 1023px */
			@media (min-width: 768px) and (max-width: 1023px) {
				.container {
					max-width: 720px;
				}

				/* 6-column grid on tablet */
				.grid-12 {
					grid-template-columns: repeat(6, 1fr);
				}

				.grid-4 {
					grid-template-columns: repeat(2, 1fr);
				}

				.grid-6 {
					grid-template-columns: repeat(3, 1fr);
				}
			}

			/* Laptop: 1024px - 1399px */
			@media (min-width: 1024px) and (max-width: 1399px) {
				.container {
					max-width: 960px;
				}
			}

			/* Desktop: 1400px+ */
			@media (min-width: 1400px) {
				.container {
					max-width: var(--container-max-width);
				}
			}

			/* ============================================
       PHASE 1: RESPONSIVE DASHBOARD GRID SYSTEM
       ============================================ */

			/* Tablet: 768px+ - Two column layout */
			@media (min-width: 768px) {
				.dashboard-container {
					grid-template-columns: repeat(2, 1fr);
				}
			}

			/* Desktop: 1200px+ - 12 column grid system */
			@media (min-width: 1200px) {
				.dashboard-container {
					grid-template-columns: repeat(12, 1fr);
				}
				.card-full {
					grid-column: span 12;
				}
				.card-half {
					grid-column: span 6;
				}
				.card-quarter {
					grid-column: span 3;
				}
			}

			/* Large Desktop: 1600px+ - Increased spacing */
			@media (min-width: 1600px) {
				.dashboard-container {
					padding: var(--spacing-2xl);
					gap: var(--spacing-2xl);
				}
			}

			/* Mobile: max 767px - Optimized for small screens */
			@media (max-width: 767px) {
				.dashboard-container {
					padding: var(--spacing-sm);
					gap: var(--spacing-md);
				}

				.dashboard-card {
					padding: var(--spacing-base);
				}

				/* Hide flow viz on mobile (too complex) */
				.event-flow-section {
					display: none !important;
				}
			}

			/* ============================================
       ACCESSIBILITY ENHANCEMENTS
       ============================================ */

			/* Focus indicators for keyboard navigation */
			*:focus-visible {
				outline: 2px solid var(--color-border-focus);
				outline-offset: 2px;
				border-radius: var(--radius-sm);
			}

			a:focus-visible,
			button:focus-visible {
				box-shadow: 0 0 0 3px var(--color-primary-light);
			}

			/* Skip to main content link (for screen readers) */
			.skip-link {
				position: absolute;
				top: -40px;
				left: 0;
				background: var(--color-primary);
				color: var(--color-text-inverse);
				padding: var(--spacing-sm) var(--spacing-base);
				text-decoration: none;
				border-radius: var(--radius-sm);
				z-index: var(--z-tooltip);
			}

			.skip-link:focus {
				top: 0;
			}

			/* High contrast mode support */
			@media (prefers-contrast: high) {
				:root {
					--color-border-primary: #000000;
					--color-border-secondary: #000000;
				}

				.card,
				.metric-card,
				input,
				textarea,
				select,
				button {
					border-width: 2px;
				}
			}

			/* Reduced motion for accessibility */
			@media (prefers-reduced-motion: reduce) {
				*,
				*::before,
				*::after {
					animation-duration: 0.01ms !important;
					animation-iteration-count: 1 !important;
					transition-duration: 0.01ms !important;
					scroll-behavior: auto !important;
				}
			}

			/* ============================================
       BACK TO TOP BUTTON - Medium Priority Issue #11
       ============================================ */
			.back-to-top {
				position: fixed;
				bottom: 30px;
				right: 30px;
				width: 50px;
				height: 50px;
				background: var(--color-primary);
				color: var(--color-text-inverse);
				border: none;
				border-radius: var(--radius-full);
				cursor: pointer;
				display: none; /* Hidden by default */
				align-items: center;
				justify-content: center;
				box-shadow: var(--shadow-lg);
				z-index: var(--z-sticky);
				transition: all var(--transition-base);
				font-size: 24px;
			}

			.back-to-top.visible {
				display: flex;
				animation: fadeInUp 0.3s ease-out;
			}

			.back-to-top:hover {
				background: var(--color-primary-dark);
				transform: translateY(-3px);
				box-shadow: var(--shadow-xl);
			}

			.back-to-top:active {
				transform: translateY(-1px);
			}

			@keyframes fadeInUp {
				from {
					opacity: 0;
					transform: translateY(20px);
				}
				to {
					opacity: 1;
					transform: translateY(0);
				}
			}

			@media (max-width: 768px) {
				.back-to-top {
					bottom: 20px;
					right: 20px;
					width: 44px;
					height: 44px;
					font-size: 20px;
				}
			}

			/* ============================================
       BREADCRUMB NAVIGATION - Medium Priority Issue #10
       ============================================ */
			.breadcrumb {
				display: flex;
				align-items: center;
				gap: var(--spacing-sm);
				padding: var(--spacing-md) 0;
				margin-bottom: var(--spacing-lg);
				font-size: var(--font-size-sm);
				color: var(--color-text-secondary);
			}

			.breadcrumb-item {
				display: flex;
				align-items: center;
				gap: var(--spacing-sm);
			}

			.breadcrumb-separator {
				color: var(--color-text-tertiary);
			}

			.breadcrumb-link {
				color: var(--color-primary);
				text-decoration: none;
				transition: color var(--transition-fast);
			}

			.breadcrumb-link:hover {
				color: var(--color-primary-dark);
				text-decoration: underline;
			}

			.breadcrumb-current {
				color: var(--color-text-primary);
				font-weight: var(--font-weight-semibold);
			}

			/* Dark mode support (optional enhancement from story) */
			@media (prefers-color-scheme: dark) {
				:root {
					--color-text-primary: #f9fafb;
					--color-text-secondary: #d1d5db;
					--color-text-tertiary: #9ca3af;
					--color-bg-primary: #111827;
					--color-bg-secondary: #1f2937;
					--color-bg-tertiary: #374151;
					--color-bg-canvas: #0f172a;
					--color-border-primary: #374151;
					--color-border-secondary: #4b5563;
				}

				body {
					background: linear-gradient(135deg, #1e3a8a 0%, #6b21a8 100%);
				}

				.response-content {
					background: var(--color-bg-tertiary);
				}
			}

			/* Print styles */
			@media print {
				body {
					background: white;
					color: black;
				}

				.container {
					box-shadow: none;
					max-width: 100%;
				}

				button,
				.btn-submit,
				.btn-clear,
				.debug-panel {
					display: none;
				}

				.metrics-section,
				.inbox-section {
					page-break-inside: avoid;
				}
			}

			/* ============================================
       SMOOTH ANIMATIONS & TRANSITIONS
       ============================================ */

			@keyframes fadeIn {
				from {
					opacity: 0;
				}
				to {
					opacity: 1;
				}
			}

			@keyframes slideUp {
				from {
					opacity: 0;
					transform: translateY(20px);
				}
				to {
					opacity: 1;
					transform: translateY(0);
				}
			}

			@keyframes pulse {
				0%,
				100% {
					opacity: 1;
				}
				50% {
					opacity: 0.5;
				}
			}

			/* Apply smooth entrance animations to key components */
			.container {
				animation: fadeIn 0.5s ease-out;
			}

			.metric-card,
			.card,
			.response-section.visible {
				animation: slideUp 0.3s ease-out;
			}

			/* Loading state animation */
			.loading-indicator {
				animation: pulse 1.5s ease-in-out infinite;
			}

			/* ============================================
       Performance Testing Module Styles - Story 6.1
       ============================================ */

			/* Performance Tabs */
			.perf-tabs {
				display: flex;
				gap: 8px;
				margin-bottom: 16px;
				border-bottom: 1px solid var(--color-border-primary);
			}

			.perf-tab-btn {
				padding: 8px 16px;
				background: none;
				border: none;
				border-bottom: 2px solid transparent;
				font-size: 13px;
				font-weight: 500;
				color: var(--color-text-secondary);
				cursor: pointer;
				transition: all 0.2s;
			}

			.perf-tab-btn:hover {
				color: var(--color-text-primary);
				background: var(--color-bg-tertiary);
			}

			.perf-tab-btn.active {
				color: var(--color-primary);
				border-bottom-color: var(--color-primary);
			}

			.perf-tab-content {
				display: none;
			}

			.perf-tab-content.active {
				display: block;
			}

			/* Load Configuration */
			.load-config {
				margin-bottom: 16px;
			}

			.config-group {
				margin-bottom: 12px;
			}

			.config-group label {
				display: block;
				margin-bottom: 4px;
				font-size: 13px;
				font-weight: 500;
				color: var(--color-text-primary);
			}

			.preset-btn,
			.profile-btn {
				padding: 6px 12px;
				background: var(--color-bg-tertiary);
				border: 1px solid var(--color-border-primary);
				border-radius: var(--radius-sm);
				font-size: 12px;
				cursor: pointer;
				transition: all 0.2s;
			}

			.preset-btn:hover,
			.profile-btn:hover {
				background: var(--color-primary-light);
				border-color: var(--color-primary);
				color: var(--color-primary);
			}

			.form-input,
			.form-select {
				width: 100%;
				padding: 8px 12px;
				border: 1px solid var(--color-border-primary);
				border-radius: var(--radius-sm);
				font-size: 13px;
				background: var(--color-bg-primary);
				color: var(--color-text-primary);
			}

			.form-input:focus,
			.form-select:focus {
				outline: none;
				border-color: var(--color-border-focus);
				box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.1);
			}

			/* Progress Section */
			.progress-section {
				padding: 12px;
				background: var(--color-bg-tertiary);
				border-radius: var(--radius-base);
				margin-top: 16px;
			}

			.progress-bar {
				width: 100%;
				height: 8px;
				background: var(--color-bg-secondary);
				border-radius: var(--radius-sm);
				overflow: hidden;
				margin: 8px 0;
			}

			.progress-fill {
				height: 100%;
				background: linear-gradient(90deg, var(--color-primary), var(--color-primary-dark));
				transition: width 0.3s ease;
				border-radius: var(--radius-sm);
			}

			/* Network Simulation */
			.network-config {
				margin-bottom: 16px;
			}

			.slider {
				width: 100%;
				height: 6px;
				background: var(--color-bg-tertiary);
				border-radius: var(--radius-sm);
				outline: none;
				-webkit-appearance: none;
				appearance: none;
			}

			.slider::-webkit-slider-thumb {
				-webkit-appearance: none;
				appearance: none;
				width: 16px;
				height: 16px;
				background: var(--color-primary);
				border-radius: 50%;
				cursor: pointer;
			}

			.slider::-moz-range-thumb {
				width: 16px;
				height: 16px;
				background: var(--color-primary);
				border-radius: 50%;
				cursor: pointer;
				border: none;
			}

			/* Metrics Dashboard */
			.metrics-dashboard {
				display: grid;
				grid-template-columns: 1fr 1fr;
				gap: 12px;
				margin-bottom: 16px;
			}

			.performance-testing-section .metric-card {
				padding: 12px;
				background: var(--color-bg-tertiary);
				border-radius: var(--radius-base);
			}

			.performance-testing-section .metric-card h5 {
				font-size: 12px;
				color: var(--color-text-secondary);
				margin: 0 0 4px 0;
			}

			.performance-testing-section .metric-value {
				font-size: 20px;
				font-weight: 600;
				color: var(--color-text-primary);
				margin: 4px 0;
			}

			.performance-testing-section .metric-status {
				font-size: 11px;
				margin-top: 4px;
			}

			/* Results Section */
			.results-section {
				margin-bottom: 16px;
			}

			.result-card {
				padding: 12px;
				background: var(--color-bg-tertiary);
				border-radius: var(--radius-base);
				margin-bottom: 12px;
			}

			.result-card h5 {
				font-size: 13px;
				font-weight: 600;
				margin: 0 0 8px 0;
				color: var(--color-text-primary);
			}

			.assessment {
				font-size: 12px;
				line-height: 1.5;
			}

			.status-section {
				padding: 12px;
				background: var(--color-bg-tertiary);
				border-radius: var(--radius-sm);
				font-size: 13px;
			}
		</style>
	</head>
	<body>
		<div class="dashboard-container">
			<header>
				<h1>TriggersAPI</h1>
				<p style="color: var(--color-text-secondary); margin-bottom: 16px; font-size: 14px">Real-time Event Ingestion at the Edge</p>
				<!-- PHASE 2: Real health check replaces fake "System Live" badge -->
				<div id="healthStatus" style="font-size: 12px; color: var(--color-text-secondary)">
					<span id="healthCheckText">Checking status...</span>
				</div>
			</header>

			<form id="eventForm">
				<!-- Bearer Token Input -->
				<div class="form-group">
					<label for="bearerToken">Authorization Token</label>
					<input type="text" id="bearerToken" name="bearerToken" placeholder="sk_test_abc123xyz789" value="sk_test_abc123xyz789" />
					<div class="hint">Your Bearer token (required for API calls)</div>
				</div>

				<!-- Payload Input -->
				<div class="form-group">
					<label for="payload">Event Payload (JSON)*</label>
					<textarea
						id="payload"
						name="payload"
						placeholder='{"user_id": "12345", "action": "created", "timestamp": "2025-11-10T12:00:00Z"}'
						required
					>
{
  "user_id": "12345",
  "action": "account_created",
  "email": "user@example.com"
}</textarea
					>
					<div class="hint">The actual event data (must be valid JSON)</div>
				</div>

				<!-- Metadata Input -->
				<div class="form-group">
					<label for="metadata">Event Metadata (JSON)</label>
					<textarea id="metadata" name="metadata" placeholder='{"event_type": "user.created", "source": "auth-service"}'>
{
  "event_type": "user.created",
  "source": "auth-service"
}</textarea
					>
					<div class="hint">Additional metadata about the event (optional)</div>
				</div>

				<!-- PHASE 2: Debug Flag dropdown removed - use Debug Control Panel instead -->

				<!-- Buttons -->
				<div class="button-group">
					<button type="submit" class="btn-submit" id="submitBtn">Submit Event</button>
					<button type="reset" class="btn-clear">Clear Form</button>
				</div>
			</form>

			<!-- Response Display -->
			<div class="response-section" id="response">
				<div class="response-title" id="responseTitle">Response</div>
				<div class="response-content" id="responseContent"></div>
			</div>

			<!-- Debug Control Panel -->
			<div id="debug-panel" class="debug-panel">
				<div class="debug-header">
					<div class="debug-header-left">
						<h2>Debug Control Panel</h2>
						<p class="subtitle">Test error pathways and system behavior</p>
					</div>
					<div class="debug-header-actions">
						<button id="debug-help-btn" class="help-icon-btn" title="Help & Documentation">?</button>
						<button id="debug-toggle-btn" class="collapse-btn" title="Toggle Panel">−</button>
					</div>
				</div>

				<div class="debug-content" id="debug-content">
					<!-- Debug Flag Cards -->
					<div class="debug-cards-grid">
						<div class="debug-card" id="validation-error-card">
							<div class="card-header">
								<span class="card-icon">⚠️</span>
								<h3>Validation Error</h3>
							</div>
							<p class="card-description">Force a validation error to test error handling</p>
							<button class="debug-btn primary" data-debug-flag="validation_error">Trigger Validation Error</button>
							<p class="expected-result">Expected: 400 Bad Request</p>
						</div>

						<div class="debug-card" id="processing-error-card">
							<div class="card-header">
								<span class="card-icon">⚡</span>
								<h3>Processing Error</h3>
							</div>
							<p class="card-description">Simulate processing failure after event queued</p>
							<button class="debug-btn primary" data-debug-flag="processing_error">Trigger Processing Error</button>
							<p class="expected-result">Expected: Event queued, then processor fails</p>
						</div>

						<div class="debug-card" id="queue-delay-card">
							<div class="card-header">
								<span class="card-icon">🕐</span>
								<h3>Queue Delay</h3>
							</div>
							<p class="card-description">Inject artificial latency</p>
							<div class="input-group">
								<label>Latency (ms):</label>
								<input type="number" id="delay-input" value="2000" min="100" max="30000" />
							</div>
							<button class="debug-btn primary" data-debug-flag="queue_delay">Inject Latency</button>
							<p class="expected-result">Expected: Response delayed by specified ms</p>
						</div>

						<div class="debug-card" id="dlq-routing-card">
							<div class="card-header">
								<span class="card-icon">❌</span>
								<h3>DLQ Routing</h3>
							</div>
							<p class="card-description">Force event to Dead Letter Queue</p>
							<button class="debug-btn primary" data-debug-flag="dlq_routing">Trigger DLQ Routing</button>
							<p class="expected-result">Expected: Event routes to DLQ after retries</p>
						</div>
					</div>

					<!-- Mock Payload Options -->
					<div class="debug-section">
						<h4>Mock Payload Configuration</h4>
						<label class="checkbox-label">
							<input type="checkbox" id="mock-payload-toggle" checked />
							Include mock event payload
						</label>
						<select id="payload-template" class="payload-select">
							<option value="minimal">Minimal Test (empty payload)</option>
							<option value="user-created">User Created Event</option>
							<option value="order-placed">Order Placed Event</option>
							<option value="custom">Custom JSON</option>
						</select>
						<textarea id="custom-payload" class="custom-payload hidden" placeholder='{"payload": {"custom": "data"}}'></textarea>
					</div>

					<!-- Mock Data Generator - Story 5.5 -->
					<div class="debug-section">
						<div class="section-header">
							<h4>Mock Data Generator</h4>
							<button class="btn-text" onclick="showTemplatesBrowser()">View All Templates</button>
						</div>
						<p style="font-size: 12px; color: var(--color-text-secondary); margin-bottom: 16px">
							Generate realistic Zapier event templates with one click
						</p>

						<!-- Quick Action Buttons -->
						<div class="quick-actions" style="margin-bottom: 20px">
							<button class="btn-submit" onclick="loadDemoData()" style="flex: 1">Load Demo (5 events)</button>
							<button class="btn-secondary" onclick="showBatchGeneratorModal()" style="flex: 1">Batch Generate</button>
							<button class="btn-secondary" onclick="generateRealisticScenario()" style="flex: 1">Generate Scenario</button>
						</div>

						<!-- Template Categories -->
						<div id="template-categories"></div>
					</div>

					<!-- Batch Testing Mode -->
					<div class="debug-section">
						<label class="checkbox-label">
							<input type="checkbox" id="batch-mode-toggle" />
							Batch Testing Mode (submit all flags sequentially)
						</label>
						<button class="scenario-btn" id="batch-submit-btn" style="display: none">Run Batch Test</button>
						<div id="batch-progress" class="progress-bar-debug hidden">
							<div id="batch-progress-fill" class="progress-fill"></div>
							<span id="batch-progress-text" class="progress-text">0/4</span>
						</div>
					</div>

					<!-- Pre-configured Scenarios -->
					<div class="debug-section">
						<h4>Pre-configured Scenarios</h4>
						<select id="scenario-dropdown" class="scenario-dropdown">
							<option value="">Select a scenario...</option>
							<option value="happy-path">Test Happy Path (valid event)</option>
							<option value="all-errors">Test All Errors (batch all 4 flags)</option>
							<option value="retry-logic">Test Retry Logic (multiple processing errors)</option>
							<option value="dlq-flow">Test DLQ Flow (sequence leading to DLQ)</option>
						</select>
						<button class="scenario-btn" id="scenario-btn" disabled>Execute Scenario</button>
					</div>

					<!-- Debug History -->
					<div class="debug-section">
						<div class="section-header">
							<h4>Debug History (Last 10)</h4>
							<button id="clear-history-btn" class="btn-text">Clear</button>
						</div>
						<div id="debug-history" class="debug-history">
							<p class="empty-state">No debug submissions yet</p>
						</div>
					</div>

					<!-- Sidebar Metrics -->
					<div class="debug-metrics">
						<div class="metric-item">
							<span class="metric-label">Total Submissions:</span>
							<span id="total-submissions" class="metric-value">0</span>
						</div>
						<div class="metric-item">
							<span class="metric-label">Last Submission:</span>
							<span id="last-submission-time" class="metric-value">--:--</span>
						</div>
						<div class="metric-item">
							<span class="metric-label">Most Used Flag:</span>
							<span id="most-used-flag" class="metric-value">None</span>
						</div>
					</div>

					<!-- Performance Testing Module - Story 6.1 -->
					<div class="debug-section performance-testing-section">
						<div class="section-header">
							<h4>Performance Testing</h4>
							<button class="help-icon-btn" onclick="showPerformanceHelp()" title="Performance Testing Help">?</button>
						</div>
						<p style="font-size: 12px; color: var(--color-text-secondary); margin-bottom: 16px">
							Load simulation, network testing, and performance metrics
						</p>

						<!-- Performance Tabs -->
						<div class="perf-tabs">
							<button class="perf-tab-btn active" data-tab="load-sim">Load Simulation</button>
							<button class="perf-tab-btn" data-tab="network-sim">Network</button>
							<button class="perf-tab-btn" data-tab="metrics">Metrics</button>
							<button class="perf-tab-btn" data-tab="results">Results</button>
						</div>

						<!-- Load Simulation Tab -->
						<div id="load-sim-tab" class="perf-tab-content active">
							<div class="load-config">
								<div class="config-group">
									<label>Event Rate (events/sec)</label>
									<div class="rate-presets" style="display: flex; gap: 8px; margin-bottom: 8px">
										<button class="preset-btn" data-rate="1">1</button>
										<button class="preset-btn" data-rate="10">10</button>
										<button class="preset-btn" data-rate="100">100</button>
										<button class="preset-btn" data-rate="500">500</button>
										<button class="preset-btn" data-rate="1000">1000</button>
									</div>
									<input type="number" id="event-rate" class="form-input" min="1" max="10000" value="100" placeholder="Custom rate" />
								</div>

								<div class="config-group">
									<label>Duration (seconds)</label>
									<div class="duration-presets" style="display: flex; gap: 8px; margin-bottom: 8px">
										<button class="preset-btn" data-duration="10">10s</button>
										<button class="preset-btn" data-duration="30">30s</button>
										<button class="preset-btn" data-duration="60">60s</button>
										<button class="preset-btn" data-duration="300">5m</button>
										<button class="preset-btn" data-duration="600">10m</button>
									</div>
									<input type="number" id="test-duration" class="form-input" min="1" max="3600" value="60" placeholder="Custom duration" />
								</div>

								<div class="config-group">
									<label>Event Template</label>
									<select id="event-template" class="form-select">
										<option value="user.created">User Created</option>
										<option value="order.created">Order Created</option>
										<option value="payment.completed">Payment Completed</option>
										<option value="user.updated">User Updated</option>
										<option value="subscription.created">Subscription Created</option>
									</select>
								</div>

								<div class="config-group">
									<label class="checkbox-label">
										<input type="checkbox" id="randomize-payloads" checked />
										Randomize payloads
									</label>
								</div>
							</div>

							<div class="load-profiles" style="margin: 16px 0">
								<h5 style="margin-bottom: 8px; font-size: 13px">Quick Profiles</h5>
								<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px">
									<button class="profile-btn" data-profile="quick">Quick Test (10 evt/s, 10s)</button>
									<button class="profile-btn" data-profile="sustained">Sustained (100 evt/s, 60s)</button>
									<button class="profile-btn" data-profile="stress">Stress (500 evt/s, 30s)</button>
									<button class="profile-btn" data-profile="endurance">Endurance (50 evt/s, 600s)</button>
								</div>
							</div>

							<div class="load-controls" style="display: flex; gap: 8px; margin-bottom: 16px">
								<button id="start-load-btn" class="btn-submit" style="flex: 2">Start Load Test</button>
								<button id="pause-load-btn" class="btn-secondary" style="flex: 1" disabled>Pause</button>
								<button id="stop-load-btn" class="btn-clear" style="flex: 1" disabled>Stop</button>
							</div>

							<div id="load-progress" class="progress-section hidden">
								<div class="progress-info" style="display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 12px">
									<span id="progress-events">0 / 6000 events</span>
									<span id="progress-time">0:00 / 1:00</span>
									<span id="progress-rate">0 evt/s</span>
								</div>
								<div class="progress-bar">
									<div id="progress-fill" class="progress-fill" style="width: 0%"></div>
								</div>
								<div class="status-indicator" id="load-status" style="margin-top: 8px; text-align: center; font-weight: 500">Ready</div>
							</div>
						</div>

						<!-- Network Simulation Tab -->
						<div id="network-sim-tab" class="perf-tab-content hidden">
							<div class="network-config">
								<div class="config-group">
									<label>Baseline Latency: <span id="latency-value">0ms</span></label>
									<input type="range" id="latency-slider" class="slider" min="0" max="500" value="0" step="10" />
								</div>

								<div class="config-group">
									<label>Jitter: <span id="jitter-value">0ms</span></label>
									<input type="range" id="jitter-slider" class="slider" min="0" max="200" value="0" step="10" />
								</div>

								<div class="config-group">
									<label>Packet Loss: <span id="packet-loss-value">0%</span></label>
									<input type="range" id="packet-loss-slider" class="slider" min="0" max="10" value="0" step="1" />
								</div>

								<div class="config-group">
									<label>Throttle</label>
									<select id="throttle-select" class="form-select">
										<option value="full">Full Speed</option>
										<option value="lte">LTE</option>
										<option value="4g">4G</option>
										<option value="3g">3G</option>
									</select>
								</div>
							</div>

							<div class="network-presets" style="margin: 16px 0">
								<h5 style="margin-bottom: 8px; font-size: 13px">Preset Profiles</h5>
								<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px">
									<button class="profile-btn" data-network="none">None</button>
									<button class="profile-btn" data-network="poor">Poor Network</button>
									<button class="profile-btn" data-network="mobile3g">Mobile 3G</button>
									<button class="profile-btn" data-network="mobile4g">Mobile 4G</button>
								</div>
							</div>

							<div class="network-controls" style="display: flex; gap: 8px; margin-bottom: 16px">
								<button id="apply-latency-btn" class="btn-submit" style="flex: 1">Apply Latency</button>
								<button id="clear-latency-btn" class="btn-secondary" style="flex: 1">Clear</button>
							</div>

							<div
								id="latency-status"
								class="status-section"
								style="padding: 12px; background: var(--color-bg-tertiary); border-radius: 4px; font-size: 13px"
							>
								<strong>Status:</strong> <span id="latency-status-text">No latency injection</span>
							</div>
						</div>

						<!-- Metrics Tab -->
						<div id="metrics-tab" class="perf-tab-content hidden">
							<div class="metrics-dashboard" style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px">
								<div class="metric-card" style="padding: 12px; background: var(--color-bg-tertiary); border-radius: 6px">
									<h5 style="font-size: 12px; color: var(--color-text-secondary); margin-bottom: 4px">Throughput</h5>
									<div class="metric-value" id="throughput-metric" style="font-size: 20px; font-weight: 600">0 evt/s</div>
									<div class="metric-status" id="throughput-status" style="font-size: 11px; color: var(--color-success)"></div>
								</div>

								<div class="metric-card" style="padding: 12px; background: var(--color-bg-tertiary); border-radius: 6px">
									<h5 style="font-size: 12px; color: var(--color-text-secondary); margin-bottom: 4px">Latency p95</h5>
									<div class="metric-value" id="latency-p95-metric" style="font-size: 20px; font-weight: 600">0 ms</div>
									<div class="metric-status" id="latency-p95-status" style="font-size: 11px; color: var(--color-success)">Good</div>
								</div>

								<div class="metric-card" style="padding: 12px; background: var(--color-bg-tertiary); border-radius: 6px">
									<h5 style="font-size: 12px; color: var(--color-text-secondary); margin-bottom: 4px">Error Rate</h5>
									<div class="metric-value" id="error-rate-metric" style="font-size: 20px; font-weight: 600">0%</div>
									<div class="metric-status" id="error-rate-status" style="font-size: 11px; color: var(--color-success)">Good</div>
								</div>

								<div class="metric-card" style="padding: 12px; background: var(--color-bg-tertiary); border-radius: 6px">
									<h5 style="font-size: 12px; color: var(--color-text-secondary); margin-bottom: 4px">Success Rate</h5>
									<div class="metric-value" id="success-rate-metric" style="font-size: 20px; font-weight: 600">0%</div>
									<div class="metric-status" id="success-rate-status" style="font-size: 11px"></div>
								</div>
							</div>

							<div class="metrics-details" style="padding: 12px; background: var(--color-bg-tertiary); border-radius: 6px; font-size: 12px">
								<h5 style="margin-bottom: 8px; font-size: 13px">Latency Percentiles</h5>
								<div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px">
									<div>p50: <strong id="latency-p50">0ms</strong></div>
									<div>p75: <strong id="latency-p75">0ms</strong></div>
									<div>p90: <strong id="latency-p90">0ms</strong></div>
									<div>p95: <strong id="latency-p95">0ms</strong></div>
									<div>p99: <strong id="latency-p99">0ms</strong></div>
									<div>p99.9: <strong id="latency-p999">0ms</strong></div>
								</div>
							</div>

							<button id="reset-metrics-btn" class="btn-secondary" style="margin-top: 12px; width: 100%">Reset Metrics</button>
						</div>

						<!-- Results Tab -->
						<div id="results-tab" class="perf-tab-content hidden">
							<div id="results-summary" class="results-section">
								<div
									class="result-card"
									style="padding: 12px; background: var(--color-bg-tertiary); border-radius: 6px; margin-bottom: 12px"
								>
									<h5 style="margin-bottom: 8px; font-size: 13px">Test Summary</h5>
									<div class="result-info" style="font-size: 12px">
										<div style="display: flex; justify-content: space-between; margin-bottom: 4px">
											<span>Total Events:</span>
											<strong id="result-total">0</strong>
										</div>
										<div style="display: flex; justify-content: space-between; margin-bottom: 4px">
											<span>Success:</span>
											<strong id="result-success" style="color: var(--color-success)">0</strong>
										</div>
										<div style="display: flex; justify-content: space-between; margin-bottom: 4px">
											<span>Failed:</span>
											<strong id="result-failed" style="color: var(--color-error)">0</strong>
										</div>
										<div style="display: flex; justify-content: space-between">
											<span>Duration:</span>
											<strong id="result-duration">0s</strong>
										</div>
									</div>
								</div>

								<div
									class="result-card"
									style="padding: 12px; background: var(--color-bg-tertiary); border-radius: 6px; margin-bottom: 12px"
								>
									<h5 style="margin-bottom: 8px; font-size: 13px">Performance Metrics</h5>
									<div class="result-metrics" style="font-size: 12px">
										<div style="display: flex; justify-content: space-between; margin-bottom: 4px">
											<span>Throughput:</span>
											<strong id="result-throughput">0 evt/s</strong>
										</div>
										<div style="display: flex; justify-content: space-between; margin-bottom: 4px">
											<span>Latency (avg):</span>
											<strong id="result-latency-avg">0 ms</strong>
										</div>
										<div style="display: flex; justify-content: space-between; margin-bottom: 4px">
											<span>Latency (p95):</span>
											<strong id="result-latency-p95">0 ms</strong>
										</div>
										<div style="display: flex; justify-content: space-between; margin-bottom: 4px">
											<span>Latency (p99):</span>
											<strong id="result-latency-p99">0 ms</strong>
										</div>
										<div style="display: flex; justify-content: space-between">
											<span>Error Rate:</span>
											<strong id="result-error-rate">0%</strong>
										</div>
									</div>
								</div>

								<div
									class="result-card"
									style="padding: 12px; background: var(--color-bg-tertiary); border-radius: 6px; margin-bottom: 12px"
								>
									<h5 style="margin-bottom: 8px; font-size: 13px">Assessment</h5>
									<div id="result-assessment" class="assessment" style="font-size: 12px">
										<p style="margin: 0">No test results yet</p>
									</div>
								</div>
							</div>

							<div class="results-actions" style="display: flex; gap: 8px">
								<button id="download-results-btn" class="btn-submit" style="flex: 1" disabled>Download Results</button>
								<button id="compare-results-btn" class="btn-secondary" style="flex: 1" disabled>Compare Runs</button>
							</div>

							<div id="results-history" class="results-list" style="margin-top: 16px">
								<h5 style="font-size: 13px; margin-bottom: 8px">Test History</h5>
								<p class="empty-state" style="font-size: 12px; color: var(--color-text-secondary)">No previous test runs</p>
							</div>
						</div>
					</div>

					<!-- Keyboard Shortcuts Help -->
					<div class="keyboard-shortcuts">
						<strong>Keyboard Shortcuts:</strong>
						<kbd>Alt+D</kbd> Toggle panel | <kbd>Alt+1</kbd> Validation Error | <kbd>Alt+2</kbd> Processing Error | <kbd>Alt+3</kbd> Queue
						Delay | <kbd>Alt+4</kbd> DLQ Routing
					</div>
				</div>
			</div>

			<!-- Metrics Dashboard -->
			<section class="metrics-section" id="metricsSection">
				<div class="metrics-header">
					<h2 class="metrics-title">Real-Time Metrics</h2>
					<div class="refresh-indicator" id="refreshIndicator">
						<span id="lastUpdatedText">Loading...</span>
						<span class="spinner" id="metricsSpinner" style="display: none"></span>
					</div>
				</div>

				<!-- Loading State -->
				<div class="metrics-loading" id="metricsLoading">
					<div class="spinner" style="width: 32px; height: 32px; margin: 0 auto 16px"></div>
					<p>Loading metrics...</p>
				</div>

				<!-- Error State -->
				<div class="metrics-error" id="metricsError" style="display: none">
					<div class="error-title">
						<span>⚠️</span>
						<span>Metrics Unavailable</span>
					</div>
					<p class="error-message" id="errorMessage">Failed to load metrics</p>
					<button class="btn-retry" onclick="fetchMetrics()">Retry</button>
				</div>

				<!-- PHASE 2: Event Flow Visualization - Now always visible -->
				<div id="eventFlowSection" class="event-flow-section" style="display: block; margin-bottom: 32px">
					<h3 class="flow-section-title">Event Flow Visualization</h3>
					<svg id="flowDiagram" viewBox="0 0 1200 400" class="flow-diagram" preserveAspectRatio="xMidYMid meet">
						<defs>
							<!-- Arrow marker for flow lines -->
							<marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
								<polygon points="0 0, 10 3, 0 6" fill="#3b82f6" />
							</marker>
							<marker id="arrowhead-error" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
								<polygon points="0 0, 10 3, 0 6" fill="#ef4444" />
							</marker>

							<!-- Gradient for stage boxes -->
							<linearGradient id="normalGradient" x1="0%" y1="0%" x2="0%" y2="100%">
								<stop offset="0%" style="stop-color: var(--color-success-light); stop-opacity: 1" />
								<stop offset="100%" style="stop-color: #dcfce7; stop-opacity: 1" />
							</linearGradient>
							<linearGradient id="degradedGradient" x1="0%" y1="0%" x2="0%" y2="100%">
								<stop offset="0%" style="stop-color: #fefce8; stop-opacity: 1" />
								<stop offset="100%" style="stop-color: #fef9c3; stop-opacity: 1" />
							</linearGradient>
							<linearGradient id="criticalGradient" x1="0%" y1="0%" x2="0%" y2="100%">
								<stop offset="0%" style="stop-color: var(--color-error-light); stop-opacity: 1" />
								<stop offset="100%" style="stop-color: var(--color-error-light); stop-opacity: 1" />
							</linearGradient>
						</defs>

						<!-- Ingestion Stage -->
						<g id="stage-ingestion" class="stage-box" transform="translate(50, 80)" data-status="normal" role="button" tabindex="0" aria-label="Ingestion stage - view details">
							<rect class="stage-rect" width="180" height="140" rx="8" fill="url(#normalGradient)" />
							<text x="90" y="30" class="stage-title">Ingestion</text>
							<text x="90" y="60" class="stage-icon">📥</text>
							<text x="90" y="95" class="stage-metric" id="flow-metric-ingestion">0</text>
							<text x="90" y="115" class="stage-label">events/sec</text>
							<path d="M 85 125 L 95 125" stroke="#10b981" stroke-width="2" class="trend-indicator" id="trend-ingestion" />
						</g>

						<!-- Queue Stage -->
						<g id="stage-queue" class="stage-box" transform="translate(320, 80)" data-status="normal" role="button" tabindex="0" aria-label="Queue stage - view details">
							<rect class="stage-rect" width="180" height="140" rx="8" fill="url(#normalGradient)" />
							<text x="90" y="30" class="stage-title">Queue</text>
							<text x="90" y="60" class="stage-icon">⏳</text>
							<text x="90" y="95" class="stage-metric" id="flow-metric-queue">0</text>
							<text x="90" y="115" class="stage-label">pending</text>
							<path d="M 85 125 L 95 125" stroke="#10b981" stroke-width="2" class="trend-indicator" id="trend-queue" />
						</g>

						<!-- Processing Stage -->
						<g id="stage-processing" class="stage-box" transform="translate(590, 80)" data-status="normal" role="button" tabindex="0" aria-label="Processing stage - view details">
							<rect class="stage-rect" width="180" height="140" rx="8" fill="url(#normalGradient)" />
							<text x="90" y="30" class="stage-title">Processing</text>
							<text x="90" y="60" class="stage-icon">⚙️</text>
							<text x="90" y="95" class="stage-metric" id="flow-metric-processing">0%</text>
							<text x="90" y="115" class="stage-label">success rate</text>
							<path d="M 85 125 L 95 125" stroke="#10b981" stroke-width="2" class="trend-indicator" id="trend-processing" />
						</g>

						<!-- Storage Stage -->
						<g id="stage-storage" class="stage-box" transform="translate(860, 80)" data-status="normal" role="button" tabindex="0" aria-label="Storage stage - view details">
							<rect class="stage-rect" width="180" height="140" rx="8" fill="url(#normalGradient)" />
							<text x="90" y="30" class="stage-title">Storage</text>
							<text x="90" y="60" class="stage-icon">💾</text>
							<text x="90" y="95" class="stage-metric" id="flow-metric-storage">0</text>
							<text x="90" y="115" class="stage-label">persisted</text>
							<path d="M 85 125 L 95 125" stroke="#10b981" stroke-width="2" class="trend-indicator" id="trend-storage" />
						</g>

						<!-- Dead Letter Queue Stage -->
						<g id="stage-dlq" class="stage-box dlq-stage" transform="translate(590, 280)" data-status="normal" role="button" tabindex="0" aria-label="Dead Letter Queue - view details">
							<rect class="stage-rect" width="180" height="100" rx="8" fill="url(#normalGradient)" />
							<text x="90" y="30" class="stage-title">Dead Letter Queue</text>
							<text x="90" y="55" class="stage-icon">❌</text>
							<text x="90" y="85" class="stage-metric" id="flow-metric-dlq">0</text>
						</g>

						<!-- Flow Arrows -->
						<!-- Ingestion → Queue -->
						<line
							x1="230"
							y1="150"
							x2="320"
							y2="150"
							class="flow-line"
							id="arrow-1"
							stroke="#3b82f6"
							stroke-width="3"
							marker-end="url(#arrowhead)"
							stroke-dasharray="5,5"
						/>
						<text x="270" y="140" class="flow-label" id="throughput-1">0/s</text>

						<!-- Queue → Processing -->
						<line
							x1="500"
							y1="150"
							x2="590"
							y2="150"
							class="flow-line"
							id="arrow-2"
							stroke="#3b82f6"
							stroke-width="3"
							marker-end="url(#arrowhead)"
							stroke-dasharray="5,5"
						/>
						<text x="540" y="140" class="flow-label" id="throughput-2">0/s</text>

						<!-- Processing → Storage -->
						<line
							x1="770"
							y1="150"
							x2="860"
							y2="150"
							class="flow-line"
							id="arrow-3"
							stroke="#3b82f6"
							stroke-width="3"
							marker-end="url(#arrowhead)"
							stroke-dasharray="5,5"
						/>
						<text x="810" y="140" class="flow-label" id="throughput-3">0/s</text>

						<!-- Processing → DLQ (vertical branch) -->
						<line
							x1="680"
							y1="220"
							x2="680"
							y2="280"
							class="flow-line dlq-arrow"
							id="arrow-dlq"
							stroke="#ef4444"
							stroke-width="3"
							marker-end="url(#arrowhead-error)"
							stroke-dasharray="5,5"
							opacity="0.3"
						/>
						<text x="695" y="255" class="flow-label flow-label-error" id="dlq-rate">0/s</text>

						<!-- Particle container for animations -->
						<g id="particles-container"></g>
					</svg>

					<!-- Flow Legend -->
					<div class="flow-legend">
						<div class="legend-item">
							<span class="legend-color" style="background: var(--color-success)"></span>
							<span>Normal Operation</span>
						</div>
						<div class="legend-item">
							<span class="legend-color" style="background: var(--color-warning)"></span>
							<span>Degraded (Backlog)</span>
						</div>
						<div class="legend-item">
							<span class="legend-color" style="background: var(--color-error)"></span>
							<span>Critical (Failing)</span>
						</div>
						<button class="btn-export" id="exportFlowBtn" title="Export as PNG">📸 Export</button>
					</div>

					<!-- Detail Popover -->
					<div id="flowDetailPopover" class="flow-detail-popover hidden">
						<button class="popover-close" id="popoverClose" aria-label="Close help popover">×</button>
						<h4 id="popover-title" class="popover-title">Stage Details</h4>
						<div class="popover-content">
							<div class="popover-metric">
								<span class="popover-label">Current Value:</span>
								<span id="popover-value" class="popover-value">0</span>
							</div>
							<div class="popover-metric">
								<span class="popover-label">Rate:</span>
								<span id="popover-rate" class="popover-value">0/sec</span>
							</div>
							<div class="popover-metric">
								<span class="popover-label">Trend:</span>
								<span id="popover-trend" class="popover-value">→</span>
							</div>
							<div class="popover-metric">
								<span class="popover-label">Last Update:</span>
								<span id="popover-timestamp" class="popover-value">--</span>
							</div>
							<canvas id="popover-sparkline" width="200" height="50"></canvas>
						</div>
					</div>

					<!-- Comparison Toggle -->
					<div class="flow-controls">
						<label class="toggle-label">
							<input type="checkbox" id="comparisonModeToggle" />
							<span>Comparison Mode (vs 24h avg)</span>
						</label>
					</div>
				</div>

				<!-- Metrics Content -->
				<div id="metricsContent" style="display: none">
					<!-- Main Metrics Cards -->
					<div class="metrics-grid">
						<div class="metric-card total" role="region" aria-label="Total events metric">
							<div class="metric-value" id="metricTotalEvents">0</div>
							<div class="metric-label">Total Events</div>
						</div>
						<div class="metric-card pending" role="region" aria-label="Pending events metric">
							<div class="metric-value" id="metricPending">0</div>
							<div class="metric-label">Pending</div>
						</div>
						<div class="metric-card delivered" role="region" aria-label="Delivered events metric">
							<div class="metric-value" id="metricDelivered">0</div>
							<div class="metric-label">Delivered</div>
						</div>
						<div class="metric-card failed" role="region" aria-label="Failed events metric">
							<div class="metric-value" id="metricFailed">0</div>
							<div class="metric-label">Failed</div>
						</div>
					</div>

					<!-- Detailed Metrics -->
					<div class="metrics-details">
						<!-- Processing Status -->
						<div class="detail-card" role="region" aria-label="Processing status details">
							<h3 class="detail-card-title">Processing Status</h3>
							<div class="detail-row">
								<span class="detail-label">Queue Depth</span>
								<span class="detail-value blue" id="detailQueueDepth">0</span>
							</div>
							<div class="detail-row">
								<span class="detail-label">Dead Letter Queue</span>
								<span class="detail-value" id="detailDlqCount">0</span>
							</div>
							<div class="detail-row">
								<span class="detail-label">Processing Rate</span>
								<span class="detail-value purple" id="detailProcessingRate">0 evt/min</span>
							</div>
						</div>

						<!-- Delivery Analysis -->
						<div class="detail-card" role="region" aria-label="Delivery analysis details">
							<h3 class="detail-card-title">Delivery Analysis</h3>
							<div class="detail-row">
								<span class="detail-label">Delivery Rate</span>
								<span class="detail-value green" id="detailDeliveryRate">0%</span>
							</div>
							<div class="progress-bar-container">
								<div
									class="progress-bar"
									id="deliveryProgressBar"
									role="progressbar"
									aria-valuenow="0"
									aria-valuemin="0"
									aria-valuemax="100"
									aria-label="Delivery rate progress"
									style="width: 0%"
								></div>
							</div>
							<div class="detail-timestamp" id="lastProcessedTimestamp">No events processed yet</div>
						</div>
					</div>
				</div>

				<!-- Enhanced Metrics Charts -->
				<div id="enhancedChartsContent" style="display: none">
					<!-- Time Range Selector and Controls -->
					<div class="metrics-controls">
						<div class="time-range-selector">
							<button class="time-range-btn active" data-range="last-hour" onclick="setTimeRange('last-hour')">Last Hour</button>
							<button class="time-range-btn" data-range="last-6-hours" onclick="setTimeRange('last-6-hours')">Last 6H</button>
							<button class="time-range-btn" data-range="last-24-hours" onclick="setTimeRange('last-24-hours')">Last 24H</button>
						</div>
						<div class="metrics-actions">
							<button class="btn-pause" id="chartsPauseBtn" onclick="toggleChartsPause()">Pause Auto-refresh</button>
							<span id="chartsLastUpdate" style="font-size: 12px; color: var(--color-text-secondary)">Loading...</span>
						</div>
					</div>

					<!-- Charts Grid -->
					<div class="charts-grid">
						<!-- Latency Percentiles Chart (Full Width) -->
						<div class="chart-card chart-full-width">
							<div class="chart-header">
								<div>
									<div class="chart-title">Latency Percentiles Over Time</div>
									<div class="chart-subtitle">P50 (green), P95 (yellow), P99 (red) with 100ms target</div>
								</div>
							</div>
							<div class="chart-container">
								<canvas id="latencyChart"></canvas>
							</div>
						</div>

						<!-- Error Rate Chart -->
						<div class="chart-card">
							<div class="chart-header">
								<div>
									<div class="chart-title">Error Rate Trend</div>
									<div class="chart-subtitle">Percentage of failed requests</div>
								</div>
							</div>
							<div class="chart-container small">
								<canvas id="errorRateChart"></canvas>
							</div>
						</div>

						<!-- Throughput Chart -->
						<div class="chart-card">
							<div class="chart-header">
								<div>
									<div class="chart-title">Request Throughput</div>
									<div class="chart-subtitle">Requests per second</div>
								</div>
							</div>
							<div class="chart-container small">
								<canvas id="throughputChart"></canvas>
							</div>
						</div>

						<!-- Error Type Breakdown Chart -->
						<div class="chart-card">
							<div class="chart-header">
								<div>
									<div class="chart-title">Error Type Distribution</div>
									<div class="chart-subtitle">Breakdown by category</div>
								</div>
							</div>
							<div class="chart-container small">
								<canvas id="errorBreakdownChart"></canvas>
							</div>
						</div>

						<!-- Queue Depth Gauge -->
						<div class="chart-card">
							<div class="chart-header">
								<div>
									<div class="chart-title">Queue Depth</div>
									<div class="chart-subtitle">Current pending events</div>
								</div>
							</div>
							<div class="chart-container small">
								<canvas id="queueDepthChart"></canvas>
							</div>
						</div>
					</div>
				</div>
			</section>

			<!-- Live Logs Section -->
			<section class="inbox-section" id="logsSection">
				<div class="metrics-header">
					<h2 class="inbox-title">Live Tail Logs</h2>
					<div class="refresh-indicator" id="logsRefreshIndicator">
						<button class="btn-page" id="pauseLogsBtn" onclick="toggleLogsPause()">Pause</button>
						<span id="logsLastUpdatedText">Auto-refresh every 3s</span>
						<span class="spinner" id="logsSpinner" style="display: none"></span>
					</div>
				</div>

				<!-- Log Filters -->
				<div class="filters-grid">
					<div class="filter-group">
						<label class="filter-label" for="logLevelFilter">Log Level</label>
						<select id="logLevelFilter" class="filter-select">
							<option value="">All Levels</option>
							<option value="debug">Debug</option>
							<option value="info">Info</option>
							<option value="warn">Warn</option>
							<option value="error">Error</option>
						</select>
					</div>

					<div class="filter-group">
						<label class="filter-label" for="logWorkerFilter">Worker</label>
						<select id="logWorkerFilter" class="filter-select">
							<option value="">All Workers</option>
							<option value="api-worker">API Worker</option>
							<option value="queue-consumer">Queue Consumer</option>
							<option value="tail-worker">Tail Worker</option>
						</select>
					</div>

					<div class="filter-group">
						<label class="filter-label" for="logEndpointFilter">Endpoint</label>
						<select id="logEndpointFilter" class="filter-select">
							<option value="">All Endpoints</option>
							<option value="/events">/events</option>
							<option value="/inbox">/inbox</option>
							<option value="/inbox/:id/ack">/inbox/:id/ack</option>
							<option value="/inbox/:id/retry">/inbox/:id/retry</option>
							<option value="/metrics">/metrics</option>
						</select>
					</div>

					<div class="filter-group">
						<label class="filter-label" for="logSearchInput">Search / Correlation ID</label>
						<input type="text" id="logSearchInput" class="filter-input" placeholder="Search message or correlation ID..." />
					</div>
				</div>

				<!-- Logs Info Bar -->
				<div class="inbox-info" id="logsInfo">Loading logs...</div>

				<!-- Loading State -->
				<div class="inbox-loading" id="logsLoading">
					<div class="spinner" style="width: 32px; height: 32px; margin: 0 auto 16px"></div>
					<p>Loading logs...</p>
				</div>

				<!-- Empty State -->
				<div class="inbox-empty" id="logsEmpty" style="display: none">
					<div class="inbox-empty-icon">📜</div>
					<p>No logs match your filters</p>
				</div>

				<!-- Error State -->
				<div class="metrics-error" id="logsError" style="display: none">
					<div class="error-title">
						<span>⚠️</span>
						<span>Failed to Load Logs</span>
					</div>
					<p class="error-message" id="logsErrorMessage">Unable to fetch logs</p>
					<button class="btn-retry" onclick="fetchLogs()">Retry</button>
				</div>

				<!-- Logs Container -->
				<div id="logsContainer" style="display: none">
					<!-- Desktop Log Table -->
					<div class="events-table-container" id="logsTableContainer">
						<table class="events-table" style="font-size: 13px">
							<thead>
								<tr>
									<th style="width: 90px">Time</th>
									<th style="width: 70px">Level</th>
									<th style="width: 100px">Worker</th>
									<th style="width: 100px">Correlation</th>
									<th style="width: 80px">Method</th>
									<th style="width: 60px">Status</th>
									<th style="width: 60px">Duration</th>
									<th>Message</th>
									<th style="width: 70px">Actions</th>
								</tr>
							</thead>
							<tbody id="logsTableBody">
								<!-- Rows inserted dynamically -->
							</tbody>
						</table>
					</div>

					<!-- Mobile Log Cards -->
					<div class="events-cards" id="logsCards">
						<!-- Cards inserted dynamically -->
					</div>
				</div>

				<!-- Pagination -->
				<div class="pagination" id="logsPagination" style="display: none">
					<div class="pagination-info" id="logsPaginationInfo">Showing 0-0 of 0</div>
					<div class="pagination-buttons">
						<button class="btn-page" id="btnLogsClear" onclick="clearLogs()">Clear Logs</button>
						<select id="logsLimitSelect" class="filter-select" style="padding: 6px 12px">
							<option value="25">25 logs</option>
							<option value="50" selected>50 logs</option>
							<option value="100">100 logs</option>
							<option value="500">500 logs</option>
						</select>
					</div>
				</div>
			</section>

			<!-- Event Inbox Section -->
			<section class="inbox-section" id="inboxSection">
				<h2 class="inbox-title">Event Inbox</h2>

				<!-- Filters -->
				<div class="filters-grid">
					<div class="filter-group">
						<label class="filter-label" for="statusFilter">Status</label>
						<select id="statusFilter" class="filter-select">
							<option value="">All Statuses</option>
							<option value="pending">Pending</option>
							<option value="delivered">Delivered</option>
							<option value="failed">Failed</option>
						</select>
					</div>

					<div class="filter-group">
						<label class="filter-label" for="fromDate">From Date</label>
						<input type="datetime-local" id="fromDate" class="filter-input" />
					</div>

					<div class="filter-group">
						<label class="filter-label" for="toDate">To Date</label>
						<input type="datetime-local" id="toDate" class="filter-input" />
					</div>

					<div class="filter-group">
						<label class="filter-label" for="limitSelect">Per Page</label>
						<select id="limitSelect" class="filter-select">
							<option value="10">10</option>
							<option value="25">25</option>
							<option value="50" selected>50</option>
							<option value="100">100</option>
						</select>
					</div>
				</div>

				<!-- Info Bar -->
				<div class="inbox-info" id="inboxInfo">Loading events...</div>

				<!-- Loading State -->
				<div class="inbox-loading" id="inboxLoading">
					<div class="spinner" style="width: 32px; height: 32px; margin: 0 auto 16px"></div>
					<p>Loading events...</p>
				</div>

				<!-- Empty State -->
				<div class="inbox-empty" id="inboxEmpty" style="display: none">
					<div class="inbox-empty-icon">📭</div>
					<p>No events match your filters</p>
				</div>

				<!-- Error State -->
				<div class="metrics-error" id="inboxError" style="display: none">
					<div class="error-title">
						<span>⚠️</span>
						<span>Failed to Load Events</span>
					</div>
					<p class="error-message" id="inboxErrorMessage">Unable to fetch events</p>
					<button class="btn-retry" onclick="fetchInboxEvents()">Retry</button>
				</div>

				<!-- Desktop Table -->
				<div class="events-table-container" id="eventsTableContainer" style="display: none">
					<table class="events-table">
						<thead>
							<tr>
								<th>Event ID</th>
								<th>Status</th>
								<th>Payload Preview</th>
								<th>Created</th>
								<th>Retries</th>
								<th>Actions</th>
							</tr>
						</thead>
						<tbody id="eventsTableBody">
							<!-- Rows inserted dynamically -->
						</tbody>
					</table>
				</div>

				<!-- Mobile Cards -->
				<div class="events-cards" id="eventsCards">
					<!-- Cards inserted dynamically -->
				</div>

				<!-- Pagination -->
				<div class="pagination" id="pagination" style="display: none">
					<div class="pagination-info" id="paginationInfo">Showing 0-0 of 0</div>
					<div class="pagination-buttons">
						<button class="btn-page" id="btnPrev" onclick="goToPrevPage()" disabled>Previous</button>
						<span class="pagination-info" id="pageInfo">Page 1 of 1</span>
						<button class="btn-page" id="btnNext" onclick="goToNextPage()" disabled>Next</button>
					</div>
				</div>
			</section>
		</div>

		<!-- Event Detail Modal -->
		<div class="modal-overlay" id="eventModal">
			<div class="modal-content">
				<div class="modal-header">
					<h3 class="modal-title">Event Details</h3>
					<button class="btn-close" onclick="closeEventModal()" aria-label="Close event modal">&times;</button>
				</div>
				<div class="modal-body" id="modalBody">
					<!-- Content inserted dynamically -->
				</div>
			</div>
		</div>

		<!-- Log Detail Modal -->
		<div class="modal-overlay" id="logModal">
			<div class="modal-content">
				<div class="modal-header">
					<h3 class="modal-title">Log Details</h3>
					<button class="btn-close" onclick="closeLogModal()" aria-label="Close log modal">&times;</button>
				</div>
				<div class="modal-body" id="logModalBody">
					<!-- Content inserted dynamically -->
				</div>
			</div>
		</div>

		<!-- Debug Help Modal -->
		<div class="modal-overlay" id="debugHelpModal">
			<div class="modal-content">
				<div class="modal-header">
					<h3 class="modal-title">Debug Control Panel Help</h3>
					<button class="btn-close" onclick="closeDebugHelpModal()" aria-label="Close debug help modal">&times;</button>
				</div>
				<div class="modal-body">
					<h4 style="margin-top: 0">Debug Flags Overview</h4>
					<p style="margin-bottom: 20px">
						The Debug Control Panel allows you to test error pathways and system behavior by triggering specific debug flags through the
						API.
					</p>

					<div style="margin-bottom: 20px">
						<h5 style="margin: 10px 0 8px 0">⚠️ Validation Error</h5>
						<p style="margin: 0; color: var(--color-text-secondary); font-size: 14px">
							Forces a validation error response (400 Bad Request). Use this to test client-side error handling for malformed requests.
						</p>
						<p style="margin: 8px 0 0 0; font-size: 13px; color: #999"><strong>Usage:</strong> POST /events?debug=validation_error</p>
					</div>

					<div style="margin-bottom: 20px">
						<h5 style="margin: 10px 0 8px 0">⚡ Processing Error</h5>
						<p style="margin: 0; color: var(--color-text-secondary); font-size: 14px">
							Simulates processing failure after the event is queued. The event will be accepted but will fail during processing, triggering
							retry logic.
						</p>
						<p style="margin: 8px 0 0 0; font-size: 13px; color: #999"><strong>Usage:</strong> POST /events?debug=processing_error</p>
					</div>

					<div style="margin-bottom: 20px">
						<h5 style="margin: 10px 0 8px 0">🕐 Queue Delay</h5>
						<p style="margin: 0; color: var(--color-text-secondary); font-size: 14px">
							Injects artificial latency (default 2000ms) to simulate slow processing or network delays. Useful for performance testing.
						</p>
						<p style="margin: 8px 0 0 0; font-size: 13px; color: #999"><strong>Usage:</strong> POST /events?debug=queue_delay&delay=2000</p>
					</div>

					<div style="margin-bottom: 20px">
						<h5 style="margin: 10px 0 8px 0">❌ DLQ Routing</h5>
						<p style="margin: 0; color: var(--color-text-secondary); font-size: 14px">
							Forces the event to be routed to the Dead Letter Queue after exhausting all retry attempts. Tests DLQ handling logic.
						</p>
						<p style="margin: 8px 0 0 0; font-size: 13px; color: #999"><strong>Usage:</strong> POST /events?debug=dlq_routing</p>
					</div>

					<h4 style="margin: 24px 0 12px 0">Features</h4>
					<ul style="margin: 0; padding-left: 20px; color: var(--color-text-secondary); font-size: 14px">
						<li style="margin-bottom: 8px">
							<strong>Mock Payloads:</strong> Choose from pre-built event templates or create custom JSON payloads
						</li>
						<li style="margin-bottom: 8px"><strong>Quick Templates:</strong> One-click submission of common Zapier event types</li>
						<li style="margin-bottom: 8px">
							<strong>Batch Testing:</strong> Execute all 4 debug flags sequentially with automatic progress tracking
						</li>
						<li style="margin-bottom: 8px">
							<strong>Debug History:</strong> View your last 10 debug submissions with expandable response details
						</li>
						<li style="margin-bottom: 8px">
							<strong>Pre-configured Scenarios:</strong> Run complex test scenarios with multiple debug flags
						</li>
						<li style="margin-bottom: 8px">
							<strong>Keyboard Shortcuts:</strong> Quick access via Alt+D (toggle) and Alt+1-4 (trigger flags)
						</li>
					</ul>

					<h4 style="margin: 24px 0 12px 0">Common Troubleshooting</h4>
					<ul style="margin: 0; padding-left: 20px; color: var(--color-text-secondary); font-size: 14px">
						<li style="margin-bottom: 8px">
							<strong>401 Unauthorized:</strong> Ensure your Bearer token is valid in the Authorization Token field
						</li>
						<li style="margin-bottom: 8px"><strong>No response:</strong> Check browser console for network errors or CORS issues</li>
						<li style="margin-bottom: 8px">
							<strong>Debug flags not working:</strong> Verify your API worker supports debug query parameters
						</li>
					</ul>

					<p
						style="
							margin-top: 24px;
							padding: 12px;
							background: var(--color-bg-tertiary);
							border-radius: var(--radius-base); /* 6px */
							font-size: 13px;
							color: var(--color-text-secondary);
						"
					>
						<strong>Note:</strong> Debug flags are intended for development and demonstration purposes. Do not use in production
						environments.
					</p>
				</div>
			</div>
		</div>

		<!-- Batch Generator Modal - Story 5.5 -->
		<div class="modal-overlay" id="batchGeneratorModal" style="display: none">
			<div class="modal-content" style="max-width: 500px">
				<div class="modal-header">
					<h3 class="modal-title">Batch Event Generator</h3>
					<button class="btn-close" onclick="closeBatchGeneratorModal()" aria-label="Close batch generator modal">&times;</button>
				</div>
				<div class="modal-body">
					<p style="font-size: 13px; color: var(--color-text-secondary); margin-bottom: 16px">
						Generate multiple events from a single template with randomized data
					</p>

					<div class="form-group">
						<label for="batch-template-select">Event Template</label>
						<select id="batch-template-select" class="payload-select"></select>
					</div>

					<div class="form-group">
						<label for="batch-count-input">Number of Events (1-100)</label>
						<input
							type="number"
							id="batch-count-input"
							min="1"
							max="100"
							value="10"
							style="width: 100%; padding: 8px; border: 1px solid var(--color-border-secondary); border-radius: 4px"
						/>
					</div>

					<div style="display: flex; gap: 12px; margin-top: 24px">
						<button class="btn-submit" onclick="submitBatchGeneration()" style="flex: 1">Generate Events</button>
						<button class="btn-secondary" onclick="closeBatchGeneratorModal()" style="flex: 1">Cancel</button>
					</div>

					<div id="batch-progress-container" style="display: none; margin-top: 16px">
						<div style="background: var(--color-bg-tertiary); height: 8px; border-radius: 4px; overflow: hidden">
							<div id="batch-progress-bar" style="background: var(--color-primary); height: 100%; width: 0%; transition: width 0.3s"></div>
						</div>
						<p id="batch-progress-text" style="font-size: 12px; color: var(--color-text-secondary); margin-top: 8px; text-align: center">
							0 / 0 events created
						</p>
					</div>
				</div>
			</div>
		</div>

		<!-- Template Browser Modal - Story 5.5 -->
		<div class="modal-overlay" id="templateBrowserModal" style="display: none">
			<div class="modal-content" style="max-width: 800px; max-height: 80vh; overflow-y: auto">
				<div class="modal-header">
					<h3 class="modal-title">Event Template Browser</h3>
					<button class="btn-close" onclick="closeTemplateBrowserModal()" aria-label="Close template browser modal">&times;</button>
				</div>
				<div class="modal-body">
					<p style="font-size: 13px; color: var(--color-text-secondary); margin-bottom: 16px">
						Browse all available Zapier event templates organized by category
					</p>

					<!-- Search and Filter -->
					<div style="margin-bottom: 20px">
						<input
							type="text"
							id="template-search"
							placeholder="Search templates..."
							style="width: 100%; padding: 10px; border: 1px solid var(--color-border-secondary); border-radius: 6px; font-size: 14px"
							oninput="filterTemplates(this.value)"
						/>
					</div>

					<!-- Category Filter -->
					<div style="margin-bottom: 20px; display: flex; gap: 8px; flex-wrap: wrap" id="category-filters"></div>

					<!-- Templates Grid -->
					<div
						id="templates-browser-grid"
						style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 12px"
					></div>
				</div>
			</div>
		</div>

		<!-- Toast Container -->
		<div class="toast-container" id="toast-container"></div>

		<script>
			// Client-side form handling
			const form = document.getElementById('eventForm');
			const submitBtn = document.getElementById('submitBtn');
			const response = document.getElementById('response');
			const responseTitle = document.getElementById('responseTitle');
			const responseContent = document.getElementById('responseContent');

			form.addEventListener('submit', async (e) => {
				e.preventDefault();

				// Get form values
				const bearerToken = document.getElementById('bearerToken').value;
				const payload = document.getElementById('payload').value;
				const metadata = document.getElementById('metadata').value;
				// PHASE 2: debugFlag removed - use Debug Control Panel

				// Validate inputs
				if (!bearerToken.trim()) {
					showError('Authorization token is required');
					return;
				}

				let payloadObj, metadataObj;

				try {
					payloadObj = JSON.parse(payload);
				} catch (e) {
					showError('Payload must be valid JSON: ' + e.message);
					return;
				}

				if (metadata.trim()) {
					try {
						metadataObj = JSON.parse(metadata);
					} catch (e) {
						showError('Metadata must be valid JSON: ' + e.message);
						return;
					}
				}

				// Prepare request
				submitBtn.disabled = true;
				submitBtn.textContent = 'Sending...';
				response.classList.remove('visible', 'success', 'error');

				try {
					// PHASE 2: Debug flag removed - always use base URL
					let url = '/events';

					// Send request
					const res = await fetch(url, {
						method: 'POST',
						headers: {
							'Content-Type': 'application/json',
							Authorization: 'Bearer ' + bearerToken,
						},
						body: JSON.stringify({
							payload: payloadObj,
							...(metadataObj && { metadata: metadataObj }),
						}),
					});

					const data = await res.json();

					if (res.ok) {
						showSuccess(data);
					} else {
						showError(data.error?.message || 'Unknown error', data.error?.code);
					}
				} catch (error) {
					showError('Failed to send request: ' + error.message);
				} finally {
					submitBtn.disabled = false;
					submitBtn.textContent = 'Submit Event';
				}
			});

			function showSuccess(data) {
				response.classList.add('visible', 'success');
				response.classList.remove('error');
				responseTitle.textContent = 'Success';
				responseContent.textContent = JSON.stringify(data, null, 2);
			}

			function showError(message, code) {
				response.classList.add('visible', 'error');
				response.classList.remove('success');
				responseTitle.textContent = 'Error: ' + (code || 'Unknown');
				responseContent.textContent = message;
			}

			// Metrics Dashboard Logic
			let metricsInterval = null;

			/**
			 * Fetch metrics from the API endpoint
			 */
			async function fetchMetrics() {
				const metricsLoading = document.getElementById('metricsLoading');
				const metricsError = document.getElementById('metricsError');
				const metricsContent = document.getElementById('metricsContent');
				const metricsSpinner = document.getElementById('metricsSpinner');

				// Show loading state on first load, spinner on refresh
				if (metricsContent.style.display === 'none') {
					metricsLoading.style.display = 'block';
					metricsError.style.display = 'none';
				} else {
					metricsSpinner.style.display = 'inline-block';
				}

				try {
					const res = await fetch('/metrics', {
						method: 'GET',
						headers: {
							'Content-Type': 'application/json',
						},
					});

					if (!res.ok) {
						throw new Error(`HTTP ${res.status}: ${res.statusText}`);
					}

					const data = await res.json();
					updateMetricsDisplay(data.data);

					// Hide loading/error, show content
					metricsLoading.style.display = 'none';
					metricsError.style.display = 'none';
					metricsContent.style.display = 'block';
					metricsSpinner.style.display = 'none';

					// Update last updated timestamp
					updateLastUpdatedText();
				} catch (error) {
					console.error('Failed to fetch metrics:', error);

					// Show error state
					metricsLoading.style.display = 'none';
					metricsContent.style.display = 'none';
					metricsError.style.display = 'block';
					metricsSpinner.style.display = 'none';

					document.getElementById('errorMessage').textContent = error.message || 'Failed to load metrics. Please try again.';
				}
			}

			/**
			 * Update the metrics display with new data
			 */
			function updateMetricsDisplay(metrics) {
				// Update main metric cards
				document.getElementById('metricTotalEvents').textContent = formatNumber(metrics.total_events || 0);
				document.getElementById('metricPending').textContent = formatNumber(metrics.pending || 0);
				document.getElementById('metricDelivered').textContent = formatNumber(metrics.delivered || 0);
				document.getElementById('metricFailed').textContent = formatNumber(metrics.failed || 0);

				// Update detail metrics
				document.getElementById('detailQueueDepth').textContent = formatNumber(metrics.queue_depth || 0);

				const dlqCount = metrics.dlq_count || 0;
				const dlqElement = document.getElementById('detailDlqCount');
				dlqElement.textContent = formatNumber(dlqCount);
				dlqElement.className = 'detail-value ' + (dlqCount > 0 ? 'red' : 'green');

				document.getElementById('detailProcessingRate').textContent = formatNumber(metrics.processing_rate || 0) + ' evt/min';

				// Calculate and update delivery rate
				const totalEvents = metrics.total_events || 0;
				const deliveredEvents = metrics.delivered || 0;
				const deliveryRate = totalEvents > 0 ? Math.round((deliveredEvents / totalEvents) * 100) : 0;

				document.getElementById('detailDeliveryRate').textContent = deliveryRate + '%';

				const progressBar = document.getElementById('deliveryProgressBar');
				progressBar.style.width = deliveryRate + '%';
				progressBar.setAttribute('aria-valuenow', deliveryRate);

				// Update last processed timestamp
				const lastProcessedElement = document.getElementById('lastProcessedTimestamp');
				if (metrics.last_processed_at) {
					const timestamp = new Date(metrics.last_processed_at);
					lastProcessedElement.textContent = 'Last processed: ' + timestamp.toLocaleString();
				} else {
					lastProcessedElement.textContent = 'No events processed yet';
				}
			}

			/**
			 * Format numbers with comma separators for readability
			 */
			function formatNumber(num) {
				return num.toLocaleString();
			}

			/**
			 * Update the "Last updated" text in the metrics header
			 */
			function updateLastUpdatedText() {
				const now = new Date();
				document.getElementById('lastUpdatedText').textContent = 'Auto-refresh every 5s • Last updated: ' + now.toLocaleTimeString();
			}

			/**
			 * Start auto-refresh interval
			 */
			function startMetricsAutoRefresh() {
				// Clear any existing interval
				if (metricsInterval) {
					clearInterval(metricsInterval);
				}

				// Fetch immediately on start
				fetchMetrics();

				// Set up 5-second interval
				metricsInterval = setInterval(fetchMetrics, 5000);
			}

			/**
			 * Stop auto-refresh (cleanup on page unload)
			 */
			function stopMetricsAutoRefresh() {
				if (metricsInterval) {
					clearInterval(metricsInterval);
					metricsInterval = null;
				}
			}

			// Initialize metrics dashboard on page load
			document.addEventListener('DOMContentLoaded', function () {
				startMetricsAutoRefresh();
			});

			// Cleanup on page unload
			window.addEventListener('beforeunload', function () {
				stopMetricsAutoRefresh();
			});

			// Optional: Pause auto-refresh when page is hidden, resume when visible
			document.addEventListener('visibilitychange', function () {
				if (document.hidden) {
					stopMetricsAutoRefresh();
				} else {
					startMetricsAutoRefresh();
				}
			});

			// Event Inbox Logic
			let inboxState = {
				events: [],
				total: 0,
				limit: 50,
				offset: 0,
				status: '',
				fromDate: '',
				toDate: '',
				loading: false,
				actionInProgress: {},
			};

			/**
			 * Format relative time (e.g., "2 hours ago")
			 */
			function formatRelativeTime(dateStr) {
				const now = new Date();
				const then = new Date(dateStr);
				const diffMs = now - then;
				const diffMins = Math.floor(diffMs / 60000);
				const diffHours = Math.floor(diffMs / 3600000);
				const diffDays = Math.floor(diffMs / 86400000);

				if (diffMins < 1) return 'Just now';
				if (diffMins < 60) return `${diffMins}m ago`;
				if (diffHours < 24) return `${diffHours}h ago`;
				if (diffDays < 7) return `${diffDays}d ago`;
				return then.toLocaleDateString();
			}

			/**
			 * Get status badge class
			 */
			function getStatusBadgeClass(status) {
				return `status-badge ${status}`;
			}

			/**
			 * Truncate payload for preview
			 */
			function truncatePayload(payload) {
				const str = JSON.stringify(payload);
				return str.length > 100 ? str.substring(0, 100) + '...' : str;
			}

			/**
			 * ToastManager - Comprehensive toast notification system
			 */
			class ToastManager {
				constructor() {
					this.container = document.getElementById('toast-container');
					this.toasts = new Map();
				}

				show(message, type = 'info', options = {}) {
					const {
						duration = type === 'error' ? 6000 : type === 'warning' || type === 'info' ? 3000 : 4000,
						icon = this.getIcon(type),
						details = null,
						action = null,
						id = Math.random().toString(36).substr(2, 9),
						showSpinner = false,
					} = options;

					// Create toast element
					const toast = document.createElement('div');
					toast.className = `toast toast-${type}`;
					toast.id = `toast-${id}`;
					toast.setAttribute('role', 'alert');
					toast.setAttribute('aria-live', 'polite');

					// Icon
					const iconEl = document.createElement('span');
					iconEl.className = 'toast-icon';
					if (showSpinner) {
						iconEl.innerHTML = '<span class="spinner small"></span>';
					} else {
						iconEl.textContent = icon;
					}
					toast.appendChild(iconEl);

					// Content
					const content = document.createElement('div');
					content.className = 'toast-content';

					const messageEl = document.createElement('div');
					messageEl.className = 'toast-message';
					messageEl.textContent = message;
					content.appendChild(messageEl);

					if (details) {
						const detailsEl = document.createElement('div');
						detailsEl.className = 'toast-details';
						detailsEl.textContent = details;
						content.appendChild(detailsEl);
					}

					// Add action button if provided
					if (action) {
						const actionsDiv = document.createElement('div');
						actionsDiv.className = 'toast-actions';

						const actionBtn = document.createElement('button');
						actionBtn.className = 'toast-action';
						actionBtn.textContent = action.label;
						actionBtn.addEventListener('click', () => {
							action.callback();
							this.remove(id);
						});
						actionsDiv.appendChild(actionBtn);
						content.appendChild(actionsDiv);
					}

					toast.appendChild(content);

					// Add close button
					const closeBtn = document.createElement('button');
					closeBtn.className = 'toast-close';
					closeBtn.textContent = '×';
					closeBtn.setAttribute('aria-label', 'Close notification');
					closeBtn.addEventListener('click', () => this.remove(id));
					toast.appendChild(closeBtn);

					// Add to container
					this.container.appendChild(toast);
					this.toasts.set(id, toast);

					// Auto-dismiss
					if (duration > 0) {
						setTimeout(() => this.remove(id), duration);
					}

					return id;
				}

				success(message, options = {}) {
					return this.show(message, 'success', options);
				}

				error(message, errorCode = null, options = {}) {
					const details = errorCode ? `Error: ${errorCode}` : null;
					return this.show(message, 'error', { ...options, details, duration: 6000 });
				}

				warning(message, options = {}) {
					return this.show(message, 'warning', { ...options, duration: 3000 });
				}

				info(message, options = {}) {
					return this.show(message, 'info', { ...options, duration: 3000 });
				}

				loading(message, options = {}) {
					return this.show(message, 'loading', {
						...options,
						showSpinner: true,
						duration: 0, // No auto-dismiss
					});
				}

				update(id, message, type = null) {
					const toast = this.toasts.get(id);
					if (!toast) return;

					const messageEl = toast.querySelector('.toast-message');
					if (messageEl) messageEl.textContent = message;

					if (type) {
						toast.className = `toast toast-${type}`;
						const iconEl = toast.querySelector('.toast-icon');
						if (iconEl) iconEl.textContent = this.getIcon(type);
					}
				}

				remove(id) {
					const toast = this.toasts.get(id);
					if (!toast) return;

					toast.classList.add('removing');
					setTimeout(() => {
						toast.remove();
						this.toasts.delete(id);
					}, 300);
				}

				getIcon(type) {
					const icons = {
						success: '✓',
						error: '✗',
						warning: '⚠',
						info: 'ℹ',
						loading: 'ℹ',
					};
					return icons[type] || 'ℹ';
				}
			}

			// Initialize ToastManager globally
			const toast = new ToastManager();

			/**
			 * Legacy showToast function for backward compatibility
			 */
			function showToast(type, message) {
				if (type === 'success') {
					toast.success(message);
				} else if (type === 'error') {
					toast.error(message);
				} else if (type === 'warning') {
					toast.warning(message);
				} else {
					toast.info(message);
				}
			}

			/**
			 * LoadingStateManager - Handle loading states for buttons, skeletons, and progress
			 */
			class LoadingStateManager {
				constructor() {
					this.buttonStates = new Map();
				}

				setButtonLoading(button, isLoading = true) {
					if (!button) return;

					if (isLoading) {
						// Store original state
						this.buttonStates.set(button, {
							text: button.innerHTML,
							disabled: button.disabled,
						});

						button.disabled = true;
						button.classList.add('loading');
						button.innerHTML = `<span class="button-text">${button.textContent}</span>`;
					} else {
						// Restore original state
						const originalState = this.buttonStates.get(button);
						if (originalState) {
							button.innerHTML = originalState.text;
							button.disabled = originalState.disabled;
							button.classList.remove('loading');
							this.buttonStates.delete(button);
						}
					}
				}

				showSkeleton(container, count = 5, columns = 3) {
					if (!container) return;

					const rows = [];
					for (let i = 0; i < count; i++) {
						const widths = columns === 3 ? ['20%', '50%', '20%'] : columns === 2 ? ['40%', '50%'] : ['100%'];

						const boxes = widths.map((w) => `<div class="skeleton-box" style="width: ${w}; height: 20px;"></div>`).join('');

						rows.push(`<div class="skeleton-row">${boxes}</div>`);
					}

					container.innerHTML = rows.join('');
				}

				showProgress(container, current, total) {
					if (!container) return;

					const percentage = Math.min(100, (current / total) * 100);
					let progressClass = 'low';
					if (percentage > 75) progressClass = 'high';
					else if (percentage > 25) progressClass = 'medium';

					container.innerHTML = `
          <div class="progress-container">
            <div class="progress-bar">
              <div class="progress-fill ${progressClass}" style="width: ${percentage}%"></div>
            </div>
            <span class="progress-text">${current} of ${total}</span>
          </div>
        `;
				}

				createStatusBadge(status, withSpinner = false) {
					const statusLower = status.toLowerCase();
					const spinnerHtml = withSpinner ? '<span class="spinner"></span>' : '';
					return `<span class="status-badge ${statusLower}">${spinnerHtml}${status}</span>`;
				}

				showSuccessAnimation() {
					const checkmark = document.createElement('div');
					checkmark.className = 'success-checkmark';
					document.body.appendChild(checkmark);

					setTimeout(() => {
						checkmark.remove();
					}, 500);
				}

				addPulseEffect(element) {
					if (!element) return;

					element.classList.add('pulse-update');
					setTimeout(() => {
						element.classList.remove('pulse-update');
					}, 2000);
				}
			}

			// Initialize LoadingStateManager globally
			const loadingState = new LoadingStateManager();

			/**
			 * Form Validation Helper
			 */
			class FormValidator {
				constructor(formId) {
					this.form = document.getElementById(formId);
					this.errors = new Map();
				}

				validateField(fieldId, rules) {
					const field = document.getElementById(fieldId);
					if (!field) return true;

					const value = field.value.trim();
					const formGroup = field.closest('.form-group');

					// Clear previous error
					this.clearFieldError(fieldId);

					// Check required
					if (rules.required && !value) {
						this.setFieldError(fieldId, 'This field is required');
						return false;
					}

					// Check JSON validity
					if (rules.json && value) {
						try {
							JSON.parse(value);
						} catch (e) {
							this.setFieldError(fieldId, 'Invalid JSON format');
							return false;
						}
					}

					// Mark as valid
					if (formGroup && value) {
						formGroup.classList.add('success');
						formGroup.classList.remove('error');
					}

					return true;
				}

				setFieldError(fieldId, message) {
					const field = document.getElementById(fieldId);
					if (!field) return;

					const formGroup = field.closest('.form-group');
					if (formGroup) {
						formGroup.classList.add('error');
						formGroup.classList.remove('success');

						let errorMsg = formGroup.querySelector('.form-error-message');
						if (!errorMsg) {
							errorMsg = document.createElement('div');
							errorMsg.className = 'form-error-message';
							formGroup.appendChild(errorMsg);
						}
						errorMsg.textContent = message;
					}

					this.errors.set(fieldId, message);
				}

				clearFieldError(fieldId) {
					const field = document.getElementById(fieldId);
					if (!field) return;

					const formGroup = field.closest('.form-group');
					if (formGroup) {
						formGroup.classList.remove('error', 'success');
						const errorMsg = formGroup.querySelector('.form-error-message');
						if (errorMsg) errorMsg.remove();
					}

					this.errors.delete(fieldId);
				}

				showErrorSummary() {
					if (this.errors.size === 0) return;

					let summary = this.form.querySelector('.form-error-summary');
					if (!summary) {
						summary = document.createElement('div');
						summary.className = 'form-error-summary';
						this.form.insertBefore(summary, this.form.firstChild);
					}

					summary.innerHTML = `
          <strong>Please fix ${this.errors.size} error(s):</strong>
          <ul style="margin: 8px 0 0 20px;">
            ${Array.from(this.errors.values())
							.map((err) => `<li>${err}</li>`)
							.join('')}
          </ul>
        `;
					summary.classList.add('visible');
				}

				clearErrorSummary() {
					const summary = this.form.querySelector('.form-error-summary');
					if (summary) {
						summary.classList.remove('visible');
					}
				}

				isValid() {
					return this.errors.size === 0;
				}
			}

			/**
			 * Fetch inbox events from API
			 */
			async function fetchInboxEvents() {
				const inboxLoading = document.getElementById('inboxLoading');
				const inboxEmpty = document.getElementById('inboxEmpty');
				const inboxError = document.getElementById('inboxError');
				const eventsTableContainer = document.getElementById('eventsTableContainer');
				const eventsCards = document.getElementById('eventsCards');
				const pagination = document.getElementById('pagination');
				const inboxInfo = document.getElementById('inboxInfo');

				// Show loading state
				inboxState.loading = true;
				inboxLoading.style.display = 'block';
				inboxEmpty.style.display = 'none';
				inboxError.style.display = 'none';
				eventsTableContainer.style.display = 'none';
				eventsCards.innerHTML = '';
				pagination.style.display = 'none';

				try {
					// Build query params
					const params = new URLSearchParams();
					if (inboxState.status) params.append('status', inboxState.status);
					if (inboxState.fromDate) params.append('from', new Date(inboxState.fromDate).toISOString());
					if (inboxState.toDate) params.append('to', new Date(inboxState.toDate).toISOString());
					params.append('limit', inboxState.limit.toString());
					params.append('offset', inboxState.offset.toString());

					// Get bearer token
					const bearerToken = document.getElementById('bearerToken').value || 'sk_test_abc123xyz789';

					// Fetch events
					const res = await fetch(`/inbox?${params.toString()}`, {
						method: 'GET',
						headers: {
							Authorization: `Bearer ${bearerToken}`,
							'Content-Type': 'application/json',
						},
					});

					if (!res.ok) {
						throw new Error(`HTTP ${res.status}: ${res.statusText}`);
					}

					const data = await res.json();
					inboxState.events = data.data || [];
					inboxState.total = data.total || 0;

					// Hide loading
					inboxLoading.style.display = 'none';

					// Show events or empty state
					if (inboxState.events.length === 0) {
						inboxEmpty.style.display = 'block';
						inboxInfo.style.display = 'none';
					} else {
						renderEvents();
						updatePagination();
						inboxInfo.style.display = 'block';
						eventsTableContainer.style.display = 'block';
						pagination.style.display = 'flex';
					}
				} catch (error) {
					console.error('Failed to fetch inbox events:', error);
					inboxLoading.style.display = 'none';
					inboxError.style.display = 'block';
					document.getElementById('inboxErrorMessage').textContent = error.message;
				} finally {
					inboxState.loading = false;
				}
			}

			/**
			 * Render events in table and cards
			 */
			function renderEvents() {
				const tableBody = document.getElementById('eventsTableBody');
				const cardsContainer = document.getElementById('eventsCards');

				// Clear existing content
				tableBody.innerHTML = '';
				cardsContainer.innerHTML = '';

				// Render each event
				inboxState.events.forEach((event) => {
					// Render table row (desktop)
					const row = document.createElement('tr');
					row.innerHTML = `
          <td><span class="event-id">${event.event_id.substring(0, 12)}...</span></td>
          <td><span class="${getStatusBadgeClass(event.status)}">${event.status}</span></td>
          <td><div class="payload-preview">${truncatePayload(event.payload)}</div></td>
          <td>${formatRelativeTime(event.created_at)}</td>
          <td style="text-align: center;">${event.retry_count || 0}</td>
          <td>
            <div class="action-buttons">
              <button class="btn-action btn-view" onclick="viewEventDetails('${event.event_id}')">View</button>
              ${event.status === 'failed' ? `<button class="btn-action btn-retry" onclick="retryEvent('${event.event_id}')" ${inboxState.actionInProgress[event.event_id] ? 'disabled' : ''}>Retry</button>` : ''}
              <button class="btn-action btn-ack" onclick="acknowledgeEvent('${event.event_id}')" ${inboxState.actionInProgress[event.event_id] ? 'disabled' : ''}>Ack</button>
            </div>
          </td>
        `;
					tableBody.appendChild(row);

					// Render card (mobile)
					const card = document.createElement('div');
					card.className = 'event-card';
					card.innerHTML = `
          <div class="event-card-header">
            <span class="event-id">${event.event_id.substring(0, 12)}...</span>
            <span class="${getStatusBadgeClass(event.status)}">${event.status}</span>
          </div>
          <div class="event-card-body">
            <div class="payload-preview">${truncatePayload(event.payload)}</div>
          </div>
          <div class="event-card-footer">
            <span>${formatRelativeTime(event.created_at)}</span>
            <span>Retries: ${event.retry_count || 0}</span>
          </div>
          <div class="event-card-actions">
            <button class="btn-action btn-view" onclick="viewEventDetails('${event.event_id}')">View</button>
            ${event.status === 'failed' ? `<button class="btn-action btn-retry" onclick="retryEvent('${event.event_id}')" ${inboxState.actionInProgress[event.event_id] ? 'disabled' : ''}>Retry</button>` : ''}
            <button class="btn-action btn-ack" onclick="acknowledgeEvent('${event.event_id}')" ${inboxState.actionInProgress[event.event_id] ? 'disabled' : ''}>Ack</button>
          </div>
        `;
					cardsContainer.appendChild(card);
				});

				// Update info bar
				const showingFrom = inboxState.offset + 1;
				const showingTo = Math.min(inboxState.offset + inboxState.events.length, inboxState.total);
				document.getElementById('inboxInfo').textContent =
					`Showing ${showingFrom}-${showingTo} of ${inboxState.total} events${inboxState.status ? ` (filtered by ${inboxState.status})` : ''}`;
			}

			/**
			 * Update pagination controls
			 */
			function updatePagination() {
				const currentPage = Math.floor(inboxState.offset / inboxState.limit) + 1;
				const totalPages = Math.ceil(inboxState.total / inboxState.limit);
				const showingFrom = inboxState.offset + 1;
				const showingTo = Math.min(inboxState.offset + inboxState.limit, inboxState.total);

				document.getElementById('paginationInfo').textContent = `Showing ${showingFrom}-${showingTo} of ${inboxState.total}`;
				document.getElementById('pageInfo').textContent = `Page ${currentPage} of ${totalPages}`;

				// Enable/disable buttons
				document.getElementById('btnPrev').disabled = inboxState.offset === 0;
				document.getElementById('btnNext').disabled = inboxState.offset + inboxState.limit >= inboxState.total;
			}

			/**
			 * Go to previous page
			 */
			function goToPrevPage() {
				if (inboxState.offset > 0) {
					inboxState.offset = Math.max(0, inboxState.offset - inboxState.limit);
					fetchInboxEvents();
				}
			}

			/**
			 * Go to next page
			 */
			function goToNextPage() {
				if (inboxState.offset + inboxState.limit < inboxState.total) {
					inboxState.offset += inboxState.limit;
					fetchInboxEvents();
				}
			}

			/**
			 * View event details in modal
			 */
			function viewEventDetails(eventId) {
				const event = inboxState.events.find((e) => e.event_id === eventId);
				if (!event) return;

				const modalBody = document.getElementById('modalBody');
				modalBody.innerHTML = `
        <div class="detail-field">
          <div class="detail-field-label">Event ID</div>
          <div class="detail-field-value">${event.event_id}</div>
        </div>
        <div class="detail-field">
          <div class="detail-field-label">Status</div>
          <div><span class="${getStatusBadgeClass(event.status)}">${event.status}</span></div>
        </div>
        <div class="detail-field">
          <div class="detail-field-label">Payload</div>
          <div class="detail-field-value">${JSON.stringify(event.payload, null, 2)}</div>
        </div>
        ${
					event.metadata
						? `
          <div class="detail-field">
            <div class="detail-field-label">Metadata</div>
            <div class="detail-field-value">${JSON.stringify(event.metadata, null, 2)}</div>
          </div>
        `
						: ''
				}
        <div class="detail-grid">
          <div class="detail-field">
            <div class="detail-field-label">Created At</div>
            <div class="detail-field-value">${new Date(event.created_at).toLocaleString()}</div>
          </div>
          <div class="detail-field">
            <div class="detail-field-label">Updated At</div>
            <div class="detail-field-value">${new Date(event.updated_at).toLocaleString()}</div>
          </div>
        </div>
        <div class="detail-field">
          <div class="detail-field-label">Retry Count</div>
          <div class="detail-field-value">${event.retry_count || 0}</div>
        </div>
        <div class="modal-actions">
          ${event.status === 'failed' ? `<button class="btn-action btn-retry" onclick="retryEvent('${event.event_id}'); closeEventModal();" ${inboxState.actionInProgress[event.event_id] ? 'disabled' : ''}>Retry Event</button>` : ''}
          <button class="btn-action btn-ack" onclick="acknowledgeEvent('${event.event_id}'); closeEventModal();" ${inboxState.actionInProgress[event.event_id] ? 'disabled' : ''}>Acknowledge</button>
        </div>
      `;

				document.getElementById('eventModal').classList.add('visible');
			}

			/**
			 * Close event detail modal
			 */
			function closeEventModal() {
				document.getElementById('eventModal').classList.remove('visible');
			}

			/**
			 * Acknowledge event (delete)
			 */
			async function acknowledgeEvent(eventId) {
				if (inboxState.actionInProgress[eventId]) return;

				inboxState.actionInProgress[eventId] = true;

				try {
					const bearerToken = document.getElementById('bearerToken').value || 'sk_test_abc123xyz789';

					const res = await fetch(`/inbox/${eventId}/ack`, {
						method: 'POST',
						headers: {
							Authorization: `Bearer ${bearerToken}`,
							'Content-Type': 'application/json',
						},
					});

					if (!res.ok) {
						throw new Error(`HTTP ${res.status}: ${res.statusText}`);
					}

					// Remove event from list
					inboxState.events = inboxState.events.filter((e) => e.event_id !== eventId);
					inboxState.total -= 1;

					// Re-render
					renderEvents();
					updatePagination();

					showToast('success', `Event ${eventId.substring(0, 8)}... acknowledged`);
				} catch (error) {
					console.error('Failed to acknowledge event:', error);
					showToast('error', `Failed to acknowledge: ${error.message}`);
				} finally {
					delete inboxState.actionInProgress[eventId];
				}
			}

			/**
			 * Retry failed event
			 */
			async function retryEvent(eventId) {
				if (inboxState.actionInProgress[eventId]) return;

				inboxState.actionInProgress[eventId] = true;

				try {
					const bearerToken = document.getElementById('bearerToken').value || 'sk_test_abc123xyz789';

					const res = await fetch(`/inbox/${eventId}/retry`, {
						method: 'POST',
						headers: {
							Authorization: `Bearer ${bearerToken}`,
							'Content-Type': 'application/json',
						},
					});

					if (!res.ok) {
						throw new Error(`HTTP ${res.status}: ${res.statusText}`);
					}

					const data = await res.json();

					// Update event in list (status might change to pending)
					const eventIndex = inboxState.events.findIndex((e) => e.event_id === eventId);
					if (eventIndex !== -1) {
						inboxState.events[eventIndex].retry_count = data.data?.new_attempt || inboxState.events[eventIndex].retry_count + 1;
						inboxState.events[eventIndex].status = 'pending'; // Assume retry moves to pending
					}

					// Re-render
					renderEvents();

					showToast('success', `Event ${eventId.substring(0, 8)}... queued for retry`);
				} catch (error) {
					console.error('Failed to retry event:', error);
					showToast('error', `Failed to retry: ${error.message}`);
				} finally {
					delete inboxState.actionInProgress[eventId];
				}
			}

			/**
			 * Setup filter change handlers
			 */
			function setupInboxFilters() {
				document.getElementById('statusFilter').addEventListener('change', (e) => {
					inboxState.status = e.target.value;
					inboxState.offset = 0;
					fetchInboxEvents();
				});

				document.getElementById('fromDate').addEventListener('change', (e) => {
					inboxState.fromDate = e.target.value;
					inboxState.offset = 0;
					fetchInboxEvents();
				});

				document.getElementById('toDate').addEventListener('change', (e) => {
					inboxState.toDate = e.target.value;
					inboxState.offset = 0;
					fetchInboxEvents();
				});

				document.getElementById('limitSelect').addEventListener('change', (e) => {
					inboxState.limit = parseInt(e.target.value);
					inboxState.offset = 0;
					fetchInboxEvents();
				});
			}

			/**
			 * Close modal when clicking outside
			 */
			document.getElementById('eventModal').addEventListener('click', (e) => {
				if (e.target.id === 'eventModal') {
					closeEventModal();
				}
			});

			// Initialize inbox on page load
			document.addEventListener('DOMContentLoaded', function () {
				setupInboxFilters();
				fetchInboxEvents();
			});

			// Live Logs Logic
			let logsState = {
				logs: [],
				limit: 50,
				logLevel: '',
				worker: '',
				endpoint: '',
				search: '',
				loading: false,
				paused: false,
				interval: null,
			};

			/**
			 * Format time as HH:MM:SS.mmm
			 */
			function formatLogTime(isoString) {
				const date = new Date(isoString);
				const hours = String(date.getHours()).padStart(2, '0');
				const minutes = String(date.getMinutes()).padStart(2, '0');
				const seconds = String(date.getSeconds()).padStart(2, '0');
				const ms = String(date.getMilliseconds()).padStart(3, '0');
				return `${hours}:${minutes}:${seconds}.${ms}`;
			}

			/**
			 * Get log level badge HTML
			 */
			function getLogLevelBadge(level) {
				return `<span class="log-level-badge ${level}">${level}</span>`;
			}

			/**
			 * Get status badge class and text
			 */
			function getLogStatusBadge(statusCode) {
				if (!statusCode) return '';

				let className = 'log-status-badge';
				if (statusCode >= 200 && statusCode < 300) {
					className += ' success';
				} else if (statusCode >= 400 && statusCode < 500) {
					className += ' client-error';
				} else if (statusCode >= 500) {
					className += ' server-error';
				}

				return `<span class="${className}">${statusCode}</span>`;
			}

			/**
			 * Get duration display with slow indicator
			 */
			function getDurationDisplay(durationMs) {
				if (!durationMs) return '-';

				const className = durationMs > 1000 ? 'log-duration slow' : 'log-duration';
				return `<span class="${className}">${durationMs}ms</span>`;
			}

			/**
			 * Highlight search terms in message
			 */
			function highlightSearchTerms(message, search) {
				if (!search || !message) return message;

				const regex = new RegExp(`(${search.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
				return message.replace(regex, '<mark>$1</mark>');
			}

			/**
			 * Build error message from log
			 */
			function buildErrorMessage(log) {
				if (!log.error_message) return log.message;

				return `${log.message} - ${log.error_message}`;
			}

			/**
			 * Fetch logs from API
			 */
			async function fetchLogs() {
				const logsLoading = document.getElementById('logsLoading');
				const logsEmpty = document.getElementById('logsEmpty');
				const logsError = document.getElementById('logsError');
				const logsContainer = document.getElementById('logsContainer');
				const logsPagination = document.getElementById('logsPagination');
				const logsInfo = document.getElementById('logsInfo');
				const logsSpinner = document.getElementById('logsSpinner');

				// Skip if paused
				if (logsState.paused) return;

				// Show loading state only on first load
				logsState.loading = true;
				if (logsState.logs.length === 0) {
					logsLoading.style.display = 'block';
					logsEmpty.style.display = 'none';
					logsError.style.display = 'none';
					logsContainer.style.display = 'none';
					logsPagination.style.display = 'none';
				} else {
					logsSpinner.style.display = 'inline-block';
				}

				try {
					// Build query params
					const params = new URLSearchParams();
					if (logsState.logLevel) params.append('level', logsState.logLevel);
					if (logsState.worker) params.append('worker', logsState.worker);
					if (logsState.endpoint) params.append('endpoint', logsState.endpoint);
					if (logsState.search) params.append('search', logsState.search);
					params.append('limit', logsState.limit.toString());

					// Fetch logs
					const res = await fetch(`/api/logs?${params.toString()}`);

					if (!res.ok) {
						throw new Error(`HTTP ${res.status}: ${res.statusText}`);
					}

					const data = await res.json();
					logsState.logs = data.logs || [];

					// Hide loading
					logsLoading.style.display = 'none';
					logsSpinner.style.display = 'none';

					// Show logs or empty state
					if (logsState.logs.length === 0) {
						logsEmpty.style.display = 'block';
						logsInfo.style.display = 'none';
						logsContainer.style.display = 'none';
						logsPagination.style.display = 'none';
					} else {
						renderLogs();
						logsInfo.style.display = 'block';
						logsInfo.textContent = `Showing ${logsState.logs.length} logs (auto-refresh every 3s)`;
						logsContainer.style.display = 'block';
						logsPagination.style.display = 'flex';
					}

					// Update last updated text
					updateLogsLastUpdatedText();
				} catch (error) {
					console.error('Failed to fetch logs:', error);
					logsLoading.style.display = 'none';
					logsSpinner.style.display = 'none';
					logsContainer.style.display = 'none';
					logsError.style.display = 'block';
					document.getElementById('logsErrorMessage').textContent = error.message;
				} finally {
					logsState.loading = false;
				}
			}

			/**
			 * Render logs in table and cards
			 */
			function renderLogs() {
				const tableBody = document.getElementById('logsTableBody');
				const cardsContainer = document.getElementById('logsCards');

				// Clear existing content
				tableBody.innerHTML = '';
				cardsContainer.innerHTML = '';

				// Render each log
				logsState.logs.forEach((log, index) => {
					const rowClass = log.log_level === 'error' ? 'log-row-error' : log.log_level === 'warn' ? 'log-row-warn' : '';

					const message = buildErrorMessage(log);
					const highlightedMessage = highlightSearchTerms(message, logsState.search);

					// Render table row (desktop)
					const row = document.createElement('tr');
					row.className = rowClass;
					row.innerHTML = `
          <td><span class="log-time" title="${log.timestamp}">${formatLogTime(log.timestamp)}</span></td>
          <td>${getLogLevelBadge(log.log_level)}</td>
          <td style="font-size: 12px;">${log.worker_name || '-'}</td>
          <td>
            <span class="log-correlation" onclick="filterByCorrelationId('${log.correlation_id}')" title="${log.correlation_id}">
              ${log.correlation_id ? log.correlation_id.substring(0, 8) : '-'}
            </span>
          </td>
          <td style="font-size: 12px; font-family: 'Monaco', 'Menlo', monospace;">${log.method || '-'}</td>
          <td>${getLogStatusBadge(log.status_code)}</td>
          <td>${getDurationDisplay(log.duration_ms)}</td>
          <td><div class="log-message">${highlightedMessage}</div></td>
          <td>
            <button class="btn-action btn-view" onclick="viewLogDetails(${index})" style="padding: 4px 10px; font-size: 11px;">View</button>
          </td>
        `;
					tableBody.appendChild(row);

					// Render card (mobile)
					const card = document.createElement('div');
					card.className = `event-card ${rowClass}`;
					card.innerHTML = `
          <div class="event-card-header">
            <span class="log-time">${formatLogTime(log.timestamp)}</span>
            ${getLogLevelBadge(log.log_level)}
          </div>
          <div class="event-card-body">
            <div style="margin-bottom: 8px;">
              <strong>${log.worker_name || '-'}</strong>
              ${log.method ? `${log.method} ${getLogStatusBadge(log.status_code)}` : ''}
              ${log.duration_ms ? getDurationDisplay(log.duration_ms) : ''}
            </div>
            <div class="log-message">${highlightedMessage}</div>
          </div>
          <div class="event-card-footer">
            <span class="log-correlation" onclick="filterByCorrelationId('${log.correlation_id}')">
              Correlation: ${log.correlation_id ? log.correlation_id.substring(0, 8) : '-'}
            </span>
          </div>
          <div class="event-card-actions">
            <button class="btn-action btn-view" onclick="viewLogDetails(${index})">View Details</button>
          </div>
        `;
					cardsContainer.appendChild(card);
				});
			}

			/**
			 * View log details in modal
			 */
			function viewLogDetails(index) {
				const log = logsState.logs[index];
				if (!log) return;

				const modalBody = document.getElementById('logModalBody');

				// Build error section if present
				let errorSection = '';
				if (log.error_message || log.error_code) {
					errorSection = `
          <div class="detail-field">
            <div class="detail-field-label">Error Information</div>
            <div class="detail-field-value" style="color: var(--color-error-dark);">
              ${log.error_code ? `Code: ${log.error_code}\n` : ''}${log.error_message || ''}
              ${log.error_category ? `\nCategory: ${log.error_category}` : ''}
            </div>
          </div>
        `;

					if (log.error_stack) {
						errorSection += `
            <div class="detail-field">
              <div class="detail-field-label">Stack Trace</div>
              <div class="detail-field-value" style="white-space: pre-wrap; font-size: 11px;">${log.error_stack}</div>
            </div>
          `;
					}
				}

				// Build request/response section if present
				let requestSection = '';
				if (log.method && log.path) {
					requestSection = `
          <div class="detail-field">
            <div class="detail-field-label">Request</div>
            <div class="detail-field-value">${log.method} ${log.path}${log.query_params ? '?' + log.query_params : ''}</div>
          </div>
        `;
				}

				// Build timing section
				let timingSection = '';
				if (log.duration_ms || log.cpu_ms || log.db_query_ms) {
					timingSection = `
          <div class="detail-field">
            <div class="detail-field-label">Timing Breakdown</div>
            <div class="detail-field-value">
              Total: ${log.duration_ms || 0}ms
              ${log.cpu_ms ? `\nCPU: ${log.cpu_ms}ms` : ''}
              ${log.db_query_ms ? `\nDatabase: ${log.db_query_ms}ms` : ''}
              ${log.queue_wait_ms ? `\nQueue Wait: ${log.queue_wait_ms}ms` : ''}
            </div>
          </div>
        `;
				}

				modalBody.innerHTML = `
        <div class="detail-field">
          <div class="detail-field-label">Log ID</div>
          <div class="detail-field-value">${log.log_id}</div>
        </div>

        <div class="detail-grid">
          <div class="detail-field">
            <div class="detail-field-label">Timestamp</div>
            <div class="detail-field-value">${new Date(log.timestamp).toLocaleString()}</div>
          </div>
          <div class="detail-field">
            <div class="detail-field-label">Log Level</div>
            <div>${getLogLevelBadge(log.log_level)}</div>
          </div>
        </div>

        <div class="detail-field">
          <div class="detail-field-label">Correlation ID</div>
          <div class="detail-field-value">${log.correlation_id}</div>
        </div>

        <div class="detail-field">
          <div class="detail-field-label">Message</div>
          <div class="detail-field-value">${buildErrorMessage(log)}</div>
        </div>

        ${requestSection}

        ${
					log.status_code
						? `
          <div class="detail-grid">
            <div class="detail-field">
              <div class="detail-field-label">Status Code</div>
              <div>${getLogStatusBadge(log.status_code)}</div>
            </div>
            <div class="detail-field">
              <div class="detail-field-label">Endpoint</div>
              <div class="detail-field-value">${log.endpoint || '-'}</div>
            </div>
          </div>
        `
						: ''
				}

        ${timingSection}
        ${errorSection}

        <div class="detail-grid">
          <div class="detail-field">
            <div class="detail-field-label">Worker</div>
            <div class="detail-field-value">${log.worker_name || '-'}</div>
          </div>
          <div class="detail-field">
            <div class="detail-field-label">Request ID</div>
            <div class="detail-field-value">${log.request_id || '-'}</div>
          </div>
        </div>

        <div class="modal-actions">
          <button class="btn-action btn-view" onclick="copyLogAsJSON(${index})">Copy as JSON</button>
          <button class="btn-action btn-ack" onclick="filterByCorrelationId('${log.correlation_id}'); closeLogModal();">Show All for Correlation</button>
        </div>
      `;

				document.getElementById('logModal').classList.add('visible');
			}

			/**
			 * Close log detail modal
			 */
			function closeLogModal() {
				document.getElementById('logModal').classList.remove('visible');
			}

			/**
			 * Copy log as JSON
			 */
			function copyLogAsJSON(index) {
				const log = logsState.logs[index];
				if (!log) return;

				const json = JSON.stringify(log, null, 2);
				navigator.clipboard.writeText(json);
				showToast('success', 'Log copied to clipboard as JSON');
			}

			/**
			 * Filter logs by correlation ID
			 */
			function filterByCorrelationId(correlationId) {
				document.getElementById('logSearchInput').value = correlationId;
				logsState.search = correlationId;
				fetchLogs();
			}

			/**
			 * Clear logs display
			 */
			function clearLogs() {
				logsState.logs = [];
				document.getElementById('logsTableBody').innerHTML = '';
				document.getElementById('logsCards').innerHTML = '';
				document.getElementById('logsContainer').style.display = 'none';
				document.getElementById('logsEmpty').style.display = 'block';
				document.getElementById('logsInfo').style.display = 'none';
			}

			/**
			 * Toggle pause/resume logs auto-refresh
			 */
			function toggleLogsPause() {
				logsState.paused = !logsState.paused;
				const pauseBtn = document.getElementById('pauseLogsBtn');

				if (logsState.paused) {
					pauseBtn.textContent = 'Resume';
					pauseBtn.style.background = '#fef3c7';
					pauseBtn.style.color = '#d97706';
					stopLogsAutoRefresh();
				} else {
					pauseBtn.textContent = 'Pause';
					pauseBtn.style.background = '';
					pauseBtn.style.color = '';
					startLogsAutoRefresh();
				}
			}

			/**
			 * Update last updated text
			 */
			function updateLogsLastUpdatedText() {
				if (logsState.paused) return;

				const now = new Date();
				document.getElementById('logsLastUpdatedText').textContent = 'Auto-refresh every 3s • Updated: ' + now.toLocaleTimeString();
			}

			/**
			 * Setup log filter handlers
			 */
			function setupLogFilters() {
				document.getElementById('logLevelFilter').addEventListener('change', (e) => {
					logsState.logLevel = e.target.value;
					fetchLogs();
				});

				document.getElementById('logWorkerFilter').addEventListener('change', (e) => {
					logsState.worker = e.target.value;
					fetchLogs();
				});

				document.getElementById('logEndpointFilter').addEventListener('change', (e) => {
					logsState.endpoint = e.target.value;
					fetchLogs();
				});

				// Debounce search input
				let searchTimeout;
				document.getElementById('logSearchInput').addEventListener('input', (e) => {
					clearTimeout(searchTimeout);
					searchTimeout = setTimeout(() => {
						logsState.search = e.target.value;
						fetchLogs();
					}, 500);
				});

				document.getElementById('logsLimitSelect').addEventListener('change', (e) => {
					logsState.limit = parseInt(e.target.value);
					fetchLogs();
				});
			}

			/**
			 * Start auto-refresh for logs
			 */
			function startLogsAutoRefresh() {
				if (logsState.interval) {
					clearInterval(logsState.interval);
				}

				fetchLogs();
				logsState.interval = setInterval(fetchLogs, 3000);
			}

			/**
			 * Stop auto-refresh for logs
			 */
			function stopLogsAutoRefresh() {
				if (logsState.interval) {
					clearInterval(logsState.interval);
					logsState.interval = null;
				}
			}

			/**
			 * Close log modal when clicking outside
			 */
			document.getElementById('logModal').addEventListener('click', (e) => {
				if (e.target.id === 'logModal') {
					closeLogModal();
				}
			});

			// Initialize logs on page load
			document.addEventListener('DOMContentLoaded', function () {
				setupLogFilters();
				startLogsAutoRefresh();
			});

			// Cleanup on page unload
			window.addEventListener('beforeunload', function () {
				stopLogsAutoRefresh();
			});

			// Pause/resume logs when page visibility changes
			document.addEventListener('visibilitychange', function () {
				if (document.hidden && !logsState.paused) {
					stopLogsAutoRefresh();
				} else if (!document.hidden && !logsState.paused) {
					startLogsAutoRefresh();
				}
			});

			// ===== DEBUG CONTROL PANEL =====
			class DebugPanel {
				constructor() {
					this.history = [];
					this.batchMode = false;
					this.flagCount = { validation_error: 0, processing_error: 0, queue_delay: 0, dlq_routing: 0 };
					this.init();
				}

				init() {
					this.setupEventListeners();
					this.loadHistory();
					this.updateMetrics();
				}

				setupEventListeners() {
					// Debug flag buttons
					document.querySelectorAll('[data-debug-flag]').forEach((btn) => {
						btn.addEventListener('click', (e) => this.handleDebugFlag(e));
					});

					// Mock payload toggle
					const mockToggle = document.getElementById('mock-payload-toggle');
					if (mockToggle) {
						mockToggle.addEventListener('change', (e) => {
							this.togglePayloadOptions(e.target.checked);
						});
					}

					// Payload template selector
					const templateSelect = document.getElementById('payload-template');
					if (templateSelect) {
						templateSelect.addEventListener('change', (e) => {
							this.updatePayloadPreview(e.target.value);
						});
					}

					// Batch mode toggle
					const batchToggle = document.getElementById('batch-mode-toggle');
					if (batchToggle) {
						batchToggle.addEventListener('change', (e) => {
							this.batchMode = e.target.checked;
							const batchBtn = document.getElementById('batch-submit-btn');
							if (batchBtn) {
								batchBtn.style.display = e.target.checked ? 'block' : 'none';
							}
						});
					}

					// Batch submit button
					const batchBtn = document.getElementById('batch-submit-btn');
					if (batchBtn) {
						batchBtn.addEventListener('click', () => this.runBatchTest());
					}

					// Quick templates
					document.querySelectorAll('[data-template]').forEach((btn) => {
						btn.addEventListener('click', (e) => this.submitQuickTemplate(e));
					});

					// Clear history
					const clearBtn = document.getElementById('clear-history-btn');
					if (clearBtn) {
						clearBtn.addEventListener('click', () => this.clearHistory());
					}

					// Keyboard shortcuts
					document.addEventListener('keydown', (e) => this.handleKeyboardShortcuts(e));

					// Toggle panel
					const toggleBtn = document.getElementById('debug-toggle-btn');
					if (toggleBtn) {
						toggleBtn.addEventListener('click', () => this.togglePanel());
					}

					// Help button
					const helpBtn = document.getElementById('debug-help-btn');
					if (helpBtn) {
						helpBtn.addEventListener('click', () => this.openHelpModal());
					}

					// Scenario dropdown and button
					const scenarioDropdown = document.getElementById('scenario-dropdown');
					const scenarioBtn = document.getElementById('scenario-btn');
					if (scenarioDropdown && scenarioBtn) {
						scenarioDropdown.addEventListener('change', (e) => {
							scenarioBtn.disabled = !e.target.value;
						});
						scenarioBtn.addEventListener('click', () => this.executeScenario());
					}
				}

				async handleDebugFlag(event) {
					const debugFlag = event.target.dataset.debugFlag;
					const payload = this.buildPayload();
					const btn = event.target;

					try {
						// Use loading state manager for button
						loadingState.setButtonLoading(btn, true);

						// Show loading toast
						const loadingToastId = toast.loading(`Submitting with ${debugFlag} flag...`);

						let url = '/events?debug=' + debugFlag;
						if (debugFlag === 'queue_delay') {
							const delay = document.getElementById('delay-input')?.value || 2000;
							url += `&delay=${delay}`;
						}

						const startTime = Date.now();
						const token = document.getElementById('bearerToken')?.value || 'sk_test_abc123xyz789';

						const response = await fetch(url, {
							method: 'POST',
							headers: {
								'Content-Type': 'application/json',
								Authorization: `Bearer ${token}`,
							},
							body: JSON.stringify(payload),
						});

						const endTime = Date.now();
						const latency = endTime - startTime;
						const data = await response.json();

						this.addToHistory(debugFlag, response.status, data, latency);
						this.updateMetrics();
						this.flagCount[debugFlag]++;

						// Remove loading toast
						toast.remove(loadingToastId);

						// Show success/error toast with action button
						if (response.ok) {
							loadingState.showSuccessAnimation();
							toast.success(`${debugFlag}: ${response.status} ${response.statusText}`, {
								details: `Latency: ${latency}ms`,
								action: {
									label: 'View',
									callback: () => {
										// Switch to inbox tab
										const inboxTab = document.querySelector('[data-tab="inbox"]');
										if (inboxTab) inboxTab.click();
									},
								},
							});
						} else {
							toast.error(`${debugFlag}: ${response.status} ${response.statusText}`, data.error?.code || 'REQUEST_FAILED', {
								details: `Latency: ${latency}ms`,
							});
						}

						loadingState.setButtonLoading(btn, false);
					} catch (error) {
						console.error('Debug submission failed:', error);
						toast.error('Submission failed', 'NETWORK_ERROR', {
							details: error.message,
						});
						loadingState.setButtonLoading(btn, false);
					}
				}

				buildPayload() {
					const useMockPayload = document.getElementById('mock-payload-toggle')?.checked ?? true;
					const template = document.getElementById('payload-template')?.value || 'minimal';

					if (!useMockPayload) {
						return { payload: { test: true } };
					}

					const payloads = {
						minimal: { payload: { test: true } },
						'user-created': {
							payload: {
								user_id: 'usr_' + Math.random().toString(36).substr(2, 9),
								email: 'user@example.com',
								created_at: new Date().toISOString(),
							},
							metadata: { event_type: 'user.created', source: 'auth-service' },
						},
						'order-placed': {
							payload: {
								order_id: 'ord_' + Math.random().toString(36).substr(2, 9),
								amount: Math.floor(Math.random() * 10000) / 100,
								customer_id: 'cust_' + Math.random().toString(36).substr(2, 9),
								items: [{ sku: 'ITEM-001', quantity: 1, price: 29.99 }],
							},
							metadata: { event_type: 'order.placed', source: 'orders-service' },
						},
					};

					if (template === 'custom') {
						try {
							const customValue = document.getElementById('custom-payload')?.value;
							return customValue ? JSON.parse(customValue) : payloads['minimal'];
						} catch (e) {
							this.showToast('error', 'Invalid JSON in custom payload');
							return payloads['minimal'];
						}
					}

					return payloads[template] || payloads['minimal'];
				}

				addToHistory(flag, status, response, latency = null) {
					const entry = {
						timestamp: new Date(),
						flag,
						event_id: response?.data?.event_id || response?.event_id || 'N/A',
						status: status,
						response: response,
						latency: latency,
					};

					this.history.unshift(entry);
					if (this.history.length > 10) {
						this.history.pop();
					}

					this.renderHistory();
					localStorage.setItem('debugHistory', JSON.stringify(this.history));
				}

				renderHistory() {
					const historyDiv = document.getElementById('debug-history');
					if (!historyDiv) return;

					if (this.history.length === 0) {
						historyDiv.innerHTML = '<p class="empty-state">No debug submissions yet</p>';
						return;
					}

					historyDiv.innerHTML = this.history
						.map(
							(entry, index) => `
          <div class="history-entry" data-status="${entry.status}">
            <div class="entry-header">
              <span class="timestamp">${entry.timestamp.toLocaleTimeString()}</span>
              <span class="flag-badge">${entry.flag}</span>
              <span class="status-badge-debug">${entry.status}</span>
              ${entry.latency ? `<span class="flag-badge">${entry.latency}ms</span>` : ''}
            </div>
            <div class="entry-details">
              <div style="font-size: 11px;">Event ID: <code>${entry.event_id}</code></div>
              <button class="expand-btn" onclick="window.debugPanel.toggleDetails(${index})">Show Response</button>
              <div class="details hidden" id="details-${index}">
                <pre>${JSON.stringify(entry.response, null, 2)}</pre>
              </div>
            </div>
          </div>
        `,
						)
						.join('');
				}

				toggleDetails(index) {
					const detailsDiv = document.getElementById(`details-${index}`);
					if (detailsDiv) {
						detailsDiv.classList.toggle('hidden');
						const btn = detailsDiv.previousElementSibling;
						if (btn) {
							btn.textContent = detailsDiv.classList.contains('hidden') ? 'Show Response' : 'Hide Response';
						}
					}
				}

				loadHistory() {
					const saved = localStorage.getItem('debugHistory');
					if (saved) {
						try {
							this.history = JSON.parse(saved).map((entry) => ({
								...entry,
								timestamp: new Date(entry.timestamp),
							}));
							this.renderHistory();
						} catch (e) {
							console.error('Failed to load debug history:', e);
						}
					}
				}

				clearHistory() {
					if (confirm('Clear all debug history?')) {
						this.history = [];
						localStorage.removeItem('debugHistory');
						this.renderHistory();
						this.updateMetrics();
					}
				}

				updateMetrics() {
					const totalElem = document.getElementById('total-submissions');
					const lastElem = document.getElementById('last-submission-time');
					const mostUsedElem = document.getElementById('most-used-flag');

					if (totalElem) totalElem.textContent = this.history.length;

					if (lastElem && this.history.length > 0) {
						lastElem.textContent = this.history[0].timestamp.toLocaleTimeString();
					}

					if (mostUsedElem) {
						const mostUsed = Object.entries(this.flagCount).reduce((a, b) => (a[1] > b[1] ? a : b), ['None', 0]);
						mostUsedElem.textContent = mostUsed[1] > 0 ? mostUsed[0] : 'None';
					}
				}

				togglePayloadOptions(enabled) {
					const selector = document.getElementById('payload-template');
					const custom = document.getElementById('custom-payload');
					if (selector) selector.disabled = !enabled;
					if (custom && !enabled) custom.classList.add('hidden');
				}

				updatePayloadPreview(template) {
					const custom = document.getElementById('custom-payload');
					if (custom) {
						if (template === 'custom') {
							custom.classList.remove('hidden');
						} else {
							custom.classList.add('hidden');
						}
					}
				}

				async submitQuickTemplate(event) {
					const template = event.target.dataset.template;
					const payloads = {
						'user-created': {
							payload: { user_id: 'usr_' + Math.random().toString(36).substr(2, 9), email: 'user@example.com' },
							metadata: { event_type: 'user.created' },
						},
						'order-placed': {
							payload: { order_id: 'ord_' + Math.random().toString(36).substr(2, 9), amount: 99.99 },
							metadata: { event_type: 'order.placed' },
						},
						payment: {
							payload: { payment_id: 'pay_' + Math.random().toString(36).substr(2, 9), amount: 199.99 },
							metadata: { event_type: 'payment.completed' },
						},
						webhook: {
							payload: { webhook_id: 'wh_' + Math.random().toString(36).substr(2, 9), data: {} },
							metadata: { event_type: 'webhook.received' },
						},
					};

					const payload = payloads[template];
					if (!payload) return;

					try {
						const token = document.getElementById('bearerToken')?.value || 'sk_test_abc123xyz789';
						const response = await fetch('/events', {
							method: 'POST',
							headers: {
								'Content-Type': 'application/json',
								Authorization: `Bearer ${token}`,
							},
							body: JSON.stringify(payload),
						});

						const data = await response.json();
						this.addToHistory(`template:${template}`, response.status, data);
						this.updateMetrics();
						this.showToast(response.ok ? 'success' : 'error', `Template ${template}: ${response.status}`);
					} catch (error) {
						console.error('Template submission failed:', error);
						this.showToast('error', `Error: ${error.message}`);
					}
				}

				async runBatchTest() {
					const flags = ['validation_error', 'processing_error', 'queue_delay', 'dlq_routing'];
					const progressContainer = document.getElementById('batch-progress');
					const batchBtn = document.getElementById('batch-submit-btn');

					// Use loading state manager for button
					loadingState.setButtonLoading(batchBtn, true);

					// Show progress in a dedicated container or toast
					if (progressContainer) {
						progressContainer.classList.remove('hidden');
					}

					let successCount = 0;
					let errorCount = 0;

					for (let i = 0; i < flags.length; i++) {
						const flag = flags[i];

						// Update progress
						if (progressContainer) {
							loadingState.showProgress(progressContainer, i + 1, flags.length);
						}

						// Show info toast for current flag
						toast.info(`Testing flag ${i + 1}/${flags.length}: ${flag}`, { duration: 2000 });

						const btn = document.querySelector(`[data-debug-flag="${flag}"]`);
						if (btn) {
							try {
								await this.handleDebugFlag({ target: btn });
								successCount++;
							} catch (error) {
								errorCount++;
							}
							await new Promise((resolve) => setTimeout(resolve, 500)); // 500ms delay between submissions
						}
					}

					// Hide progress after a delay
					if (progressContainer) {
						setTimeout(() => progressContainer.classList.add('hidden'), 2000);
					}

					loadingState.setButtonLoading(batchBtn, false);

					// Show completion toast
					if (errorCount === 0) {
						loadingState.showSuccessAnimation();
						toast.success('Batch test completed successfully', { details: `All ${flags.length} debug flags executed` });
					} else {
						toast.warning('Batch test completed with errors', { details: `${successCount} succeeded, ${errorCount} failed` });
					}
				}

				async executeScenario() {
					const scenario = document.getElementById('scenario-dropdown')?.value;
					if (!scenario) return;

					const scenarioBtn = document.getElementById('scenario-btn');
					if (scenarioBtn) scenarioBtn.disabled = true;

					switch (scenario) {
						case 'happy-path':
							await this.submitQuickTemplate({ target: { dataset: { template: 'user-created' } } });
							break;
						case 'all-errors':
							await this.runBatchTest();
							break;
						case 'retry-logic':
							for (let i = 0; i < 3; i++) {
								const btn = document.querySelector('[data-debug-flag="processing_error"]');
								if (btn) await this.handleDebugFlag({ target: btn });
								await new Promise((resolve) => setTimeout(resolve, 1000));
							}
							break;
						case 'dlq-flow':
							const dlqBtn = document.querySelector('[data-debug-flag="dlq_routing"]');
							if (dlqBtn) await this.handleDebugFlag({ target: dlqBtn });
							break;
					}

					if (scenarioBtn) scenarioBtn.disabled = false;
				}

				handleKeyboardShortcuts(event) {
					if (event.altKey) {
						if (event.key === 'd' || event.key === 'D') {
							event.preventDefault();
							this.togglePanel();
						} else if (event.key === '1') {
							event.preventDefault();
							const btn = document.querySelector('[data-debug-flag="validation_error"]');
							if (btn) btn.click();
						} else if (event.key === '2') {
							event.preventDefault();
							const btn = document.querySelector('[data-debug-flag="processing_error"]');
							if (btn) btn.click();
						} else if (event.key === '3') {
							event.preventDefault();
							const btn = document.querySelector('[data-debug-flag="queue_delay"]');
							if (btn) btn.click();
						} else if (event.key === '4') {
							event.preventDefault();
							const btn = document.querySelector('[data-debug-flag="dlq_routing"]');
							if (btn) btn.click();
						}
					}
				}

				togglePanel() {
					const content = document.getElementById('debug-content');
					const btn = document.getElementById('debug-toggle-btn');
					if (content && btn) {
						content.classList.toggle('collapsed');
						btn.textContent = content.classList.contains('collapsed') ? '+' : '−';
					}
				}

				openHelpModal() {
					const modal = document.getElementById('debugHelpModal');
					if (modal) modal.classList.add('visible');
				}

				showToast(type, message) {
					// Use global toast manager
					if (window.toast) {
						if (type === 'success') {
							window.toast.success(message);
						} else if (type === 'error') {
							window.toast.error(message);
						} else if (type === 'warning') {
							window.toast.warning(message);
						} else {
							window.toast.info(message);
						}
					}
				}
			}

			// Helper function to close debug help modal
			function closeDebugHelpModal() {
				const modal = document.getElementById('debugHelpModal');
				if (modal) modal.classList.remove('visible');
			}

			// Close modal when clicking outside
			document.getElementById('debugHelpModal')?.addEventListener('click', (e) => {
				if (e.target.id === 'debugHelpModal') {
					closeDebugHelpModal();
				}
			});

			// Initialize Debug Panel on page load
			document.addEventListener('DOMContentLoaded', () => {
				window.debugPanel = new DebugPanel();
			});

			/**
			 * MockDataGenerator Class - Story 5.5
			 * Comprehensive library of realistic Zapier event templates with batch generation
			 */
			class MockDataGenerator {
				constructor() {
					this.templates = this.initializeTemplates();
				}

				initializeTemplates() {
					return {
						'user.created': {
							name: 'User Created',
							icon: '👤',
							category: 'Users',
							description: 'A new user account was created',
							eventType: 'user.created',
							source: 'auth-service',
							generate: () => ({
								payload: {
									user_id: this.generateUUID('usr'),
									email: this.generateEmail(),
									first_name: this.randomFirstName(),
									last_name: this.randomLastName(),
									status: 'active',
									created_at: new Date().toISOString(),
								},
								metadata: {
									event_type: 'user.created',
									source: 'auth-service',
								},
							}),
						},

						'user.updated': {
							name: 'User Updated',
							icon: '✏️',
							category: 'Users',
							description: 'User profile information was updated',
							eventType: 'user.updated',
							source: 'auth-service',
							generate: () => ({
								payload: {
									user_id: this.generateUUID('usr'),
									email: this.generateEmail(),
									first_name: this.randomFirstName(),
									last_name: this.randomLastName(),
									updated_at: new Date().toISOString(),
									changed_fields: ['email', 'first_name'],
								},
								metadata: {
									event_type: 'user.updated',
									source: 'auth-service',
								},
							}),
						},

						'user.deleted': {
							name: 'User Deleted',
							icon: '🗑️',
							category: 'Users',
							description: 'User account was deleted',
							eventType: 'user.deleted',
							source: 'auth-service',
							generate: () => ({
								payload: {
									user_id: this.generateUUID('usr'),
									email: this.generateEmail(),
									deleted_at: new Date().toISOString(),
									deletion_reason: this.randomDeletionReason(),
								},
								metadata: {
									event_type: 'user.deleted',
									source: 'auth-service',
								},
							}),
						},

						'order.created': {
							name: 'Order Created',
							icon: '🛒',
							category: 'E-commerce',
							description: 'New order was placed',
							eventType: 'order.created',
							source: 'ecommerce-service',
							generate: () => ({
								payload: {
									order_id: this.generateUUID('ord'),
									customer_id: this.generateUUID('cust'),
									amount: this.randomAmount(10, 500),
									currency: 'USD',
									status: 'pending',
									items: [
										{
											sku: 'SKU-' + Math.floor(Math.random() * 9999),
											name: this.randomProductName(),
											quantity: Math.floor(Math.random() * 5) + 1,
											price: this.randomAmount(5, 200),
										},
									],
									created_at: new Date().toISOString(),
								},
								metadata: {
									event_type: 'order.created',
									source: 'ecommerce-service',
								},
							}),
						},

						'order.paid': {
							name: 'Order Paid',
							icon: '✅',
							category: 'E-commerce',
							description: 'Order payment was received',
							eventType: 'order.paid',
							source: 'ecommerce-service',
							generate: () => ({
								payload: {
									order_id: this.generateUUID('ord'),
									customer_id: this.generateUUID('cust'),
									amount: this.randomAmount(10, 500),
									currency: 'USD',
									status: 'paid',
									payment_id: this.generateUUID('pay'),
									paid_at: new Date().toISOString(),
								},
								metadata: {
									event_type: 'order.paid',
									source: 'ecommerce-service',
								},
							}),
						},

						'order.shipped': {
							name: 'Order Shipped',
							icon: '📦',
							category: 'E-commerce',
							description: 'Order was dispatched to customer',
							eventType: 'order.shipped',
							source: 'ecommerce-service',
							generate: () => ({
								payload: {
									order_id: this.generateUUID('ord'),
									tracking_number: 'TRK-' + Math.floor(Math.random() * 999999),
									carrier: this.randomCarrier(),
									shipped_at: new Date().toISOString(),
									estimated_delivery: this.futureDate(3, 7),
								},
								metadata: {
									event_type: 'order.shipped',
									source: 'ecommerce-service',
								},
							}),
						},

						'payment.completed': {
							name: 'Payment Completed',
							icon: '💳',
							category: 'Payments',
							description: 'Payment processing was successful',
							eventType: 'payment.completed',
							source: 'stripe',
							generate: () => ({
								payload: {
									payment_id: this.generateUUID('pay'),
									amount: Math.floor(this.randomAmount(10, 10000) * 100),
									currency: 'USD',
									status: 'completed',
									customer_id: this.generateUUID('cust'),
									payment_method: this.randomPaymentMethod(),
									receipt_url: 'https://example.com/receipts/' + this.generateUUID(),
									created_at: new Date().toISOString(),
								},
								metadata: {
									event_type: 'payment.completed',
									source: 'stripe',
								},
							}),
						},

						'payment.failed': {
							name: 'Payment Failed',
							icon: '❌',
							category: 'Payments',
							description: 'Payment processing failed',
							eventType: 'payment.failed',
							source: 'stripe',
							generate: () => ({
								payload: {
									payment_id: this.generateUUID('pay'),
									amount: Math.floor(this.randomAmount(10, 10000) * 100),
									currency: 'USD',
									status: 'failed',
									customer_id: this.generateUUID('cust'),
									error_code: this.randomPaymentErrorCode(),
									error_message: this.randomPaymentErrorMessage(),
									created_at: new Date().toISOString(),
								},
								metadata: {
									event_type: 'payment.failed',
									source: 'stripe',
								},
							}),
						},

						'payment.refunded': {
							name: 'Payment Refunded',
							icon: '↩️',
							category: 'Payments',
							description: 'Payment was refunded to customer',
							eventType: 'payment.refunded',
							source: 'stripe',
							generate: () => ({
								payload: {
									payment_id: this.generateUUID('pay'),
									refund_id: this.generateUUID('ref'),
									amount: Math.floor(this.randomAmount(10, 10000) * 100),
									currency: 'USD',
									status: 'refunded',
									reason: this.randomRefundReason(),
									refunded_at: new Date().toISOString(),
								},
								metadata: {
									event_type: 'payment.refunded',
									source: 'stripe',
								},
							}),
						},

						'email.sent': {
							name: 'Email Sent',
							icon: '📧',
							category: 'Communications',
							description: 'Email was delivered to recipient',
							eventType: 'email.sent',
							source: 'sendgrid',
							generate: () => ({
								payload: {
									email_id: this.generateUUID('email'),
									recipient: this.generateEmail(),
									sender: 'noreply@example.com',
									subject: this.randomEmailSubject(),
									sent_at: new Date().toISOString(),
									template: 'transactional',
									status: 'delivered',
								},
								metadata: {
									event_type: 'email.sent',
									source: 'sendgrid',
								},
							}),
						},

						'sms.sent': {
							name: 'SMS Sent',
							icon: '💬',
							category: 'Communications',
							description: 'SMS message was sent',
							eventType: 'sms.sent',
							source: 'twilio',
							generate: () => ({
								payload: {
									message_id: this.generateUUID('sms'),
									recipient: this.randomPhoneNumber(),
									message: this.randomSMSMessage(),
									sent_at: new Date().toISOString(),
									status: 'sent',
								},
								metadata: {
									event_type: 'sms.sent',
									source: 'twilio',
								},
							}),
						},

						'form.submitted': {
							name: 'Form Submitted',
							icon: '📝',
							category: 'Forms',
							description: 'Form was submitted by user',
							eventType: 'form.submitted',
							source: 'forms-service',
							generate: () => ({
								payload: {
									form_id: this.generateUUID('form'),
									submission_id: this.generateUUID('sub'),
									submitter_email: this.generateEmail(),
									fields: {
										name: this.randomFirstName() + ' ' + this.randomLastName(),
										email: this.generateEmail(),
										message: 'This is a test form submission',
									},
									submitted_at: new Date().toISOString(),
								},
								metadata: {
									event_type: 'form.submitted',
									source: 'forms-service',
								},
							}),
						},

						'task.created': {
							name: 'Task Created',
							icon: '✓',
							category: 'Tasks',
							description: 'New task was created',
							eventType: 'task.created',
							source: 'tasks-service',
							generate: () => ({
								payload: {
									task_id: this.generateUUID('task'),
									title: this.randomTaskTitle(),
									description: 'Task description here',
									assignee: this.generateEmail(),
									due_date: this.futureDate(1, 14),
									priority: this.randomPriority(),
									created_at: new Date().toISOString(),
								},
								metadata: {
									event_type: 'task.created',
									source: 'tasks-service',
								},
							}),
						},

						'file.uploaded': {
							name: 'File Uploaded',
							icon: '📁',
							category: 'Files',
							description: 'File was uploaded to storage',
							eventType: 'file.uploaded',
							source: 'storage-service',
							generate: () => ({
								payload: {
									file_id: this.generateUUID('file'),
									filename: this.randomFilename(),
									size: Math.floor(Math.random() * 10000000),
									mime_type: this.randomMimeType(),
									url: 'https://storage.example.com/files/' + this.generateUUID(),
									uploaded_at: new Date().toISOString(),
									uploaded_by: this.generateEmail(),
								},
								metadata: {
									event_type: 'file.uploaded',
									source: 'storage-service',
								},
							}),
						},

						'subscription.created': {
							name: 'Subscription Created',
							icon: '🔄',
							category: 'Subscriptions',
							description: 'New subscription was created',
							eventType: 'subscription.created',
							source: 'billing-service',
							generate: () => ({
								payload: {
									subscription_id: this.generateUUID('sub'),
									customer_id: this.generateUUID('cust'),
									plan_id: this.randomPlanId(),
									status: 'active',
									billing_cycle: 'monthly',
									amount: this.randomAmount(10, 200),
									renewal_date: this.futureDate(28, 31),
									created_at: new Date().toISOString(),
								},
								metadata: {
									event_type: 'subscription.created',
									source: 'billing-service',
								},
							}),
						},

						'subscription.cancelled': {
							name: 'Subscription Cancelled',
							icon: '⛔',
							category: 'Subscriptions',
							description: 'Subscription was cancelled',
							eventType: 'subscription.cancelled',
							source: 'billing-service',
							generate: () => ({
								payload: {
									subscription_id: this.generateUUID('sub'),
									customer_id: this.generateUUID('cust'),
									status: 'cancelled',
									cancellation_reason: this.randomCancellationReason(),
									cancelled_at: new Date().toISOString(),
									effective_end_date: this.futureDate(1, 30),
								},
								metadata: {
									event_type: 'subscription.cancelled',
									source: 'billing-service',
								},
							}),
						},

						'webhook.received': {
							name: 'Webhook Received',
							icon: '🔗',
							category: 'Webhooks',
							description: 'Incoming webhook from external service',
							eventType: 'webhook.received',
							source: 'external-webhook',
							generate: () => ({
								payload: {
									webhook_id: this.generateUUID('wh'),
									source_service: this.randomWebhookSource(),
									event_type: this.randomWebhookEvent(),
									data: {
										id: this.generateUUID(),
										timestamp: new Date().toISOString(),
										action: 'created',
									},
									received_at: new Date().toISOString(),
								},
								metadata: {
									event_type: 'webhook.received',
									source: 'external-webhook',
								},
							}),
						},
					};
				}

				// Utility methods for data generation
				generateUUID(prefix = '') {
					const uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, (c) => {
						const r = (Math.random() * 16) | 0;
						const v = c === 'x' ? r : (r & 0x3) | 0x8;
						return v.toString(16);
					});
					return prefix ? `${prefix}_${uuid.slice(0, 8)}` : uuid;
				}

				generateEmail() {
					const firstName = this.randomFirstName().toLowerCase();
					const lastName = this.randomLastName().toLowerCase();
					const domains = ['example.com', 'test.com', 'demo.com', 'mail.com'];
					const domain = domains[Math.floor(Math.random() * domains.length)];
					return `${firstName}.${lastName}@${domain}`;
				}

				randomFirstName() {
					const names = ['John', 'Jane', 'Michael', 'Sarah', 'David', 'Emma', 'James', 'Maria', 'Robert', 'Lisa', 'William', 'Jennifer'];
					return names[Math.floor(Math.random() * names.length)];
				}

				randomLastName() {
					const names = ['Smith', 'Johnson', 'Williams', 'Brown', 'Jones', 'Garcia', 'Miller', 'Davis', 'Rodriguez', 'Martinez'];
					return names[Math.floor(Math.random() * names.length)];
				}

				randomAmount(min, max) {
					return parseFloat((Math.random() * (max - min) + min).toFixed(2));
				}

				randomProductName() {
					const adjectives = ['Premium', 'Deluxe', 'Standard', 'Pro', 'Basic', 'Elite', 'Professional'];
					const products = ['Widget', 'Gadget', 'Device', 'Tool', 'Solution', 'Kit', 'Bundle'];
					return adjectives[Math.floor(Math.random() * adjectives.length)] + ' ' + products[Math.floor(Math.random() * products.length)];
				}

				randomCarrier() {
					const carriers = ['FedEx', 'UPS', 'DHL', 'USPS', 'Amazon Logistics'];
					return carriers[Math.floor(Math.random() * carriers.length)];
				}

				randomPaymentMethod() {
					const methods = ['card', 'bank_account', 'apple_pay', 'google_pay', 'paypal'];
					return methods[Math.floor(Math.random() * methods.length)];
				}

				randomPaymentErrorCode() {
					const codes = ['card_declined', 'insufficient_funds', 'expired_card', 'invalid_cvc', 'processing_error'];
					return codes[Math.floor(Math.random() * codes.length)];
				}

				randomPaymentErrorMessage() {
					const messages = {
						card_declined: 'Your card was declined',
						insufficient_funds: 'Insufficient funds',
						expired_card: 'Card has expired',
						invalid_cvc: 'Invalid CVC code',
						processing_error: 'Payment processing error',
					};
					const code = this.randomPaymentErrorCode();
					return messages[code];
				}

				randomRefundReason() {
					const reasons = ['customer_request', 'duplicate_charge', 'fraudulent', 'product_not_received'];
					return reasons[Math.floor(Math.random() * reasons.length)];
				}

				randomEmailSubject() {
					const subjects = [
						'Order Confirmation',
						'Payment Receipt',
						'Welcome to TriggersAPI',
						'Account Updated',
						'Password Reset',
						'Subscription Renewal',
					];
					return subjects[Math.floor(Math.random() * subjects.length)];
				}

				randomSMSMessage() {
					const messages = [
						'Your verification code is 123456',
						'Your order has shipped',
						'Payment received',
						'Reminder: appointment today',
					];
					return messages[Math.floor(Math.random() * messages.length)];
				}

				randomPhoneNumber() {
					return '+1' + Math.floor(Math.random() * 9000000000 + 1000000000);
				}

				randomTaskTitle() {
					const tasks = [
						'Review pull request',
						'Fix bug in authentication',
						'Update documentation',
						'Deploy to production',
						'Run performance tests',
					];
					return tasks[Math.floor(Math.random() * tasks.length)];
				}

				randomPriority() {
					const priorities = ['low', 'medium', 'high', 'urgent'];
					return priorities[Math.floor(Math.random() * priorities.length)];
				}

				randomFilename() {
					const names = ['document.pdf', 'report.xlsx', 'image.png', 'presentation.pptx', 'data.csv'];
					return names[Math.floor(Math.random() * names.length)];
				}

				randomMimeType() {
					const types = ['application/pdf', 'application/vnd.ms-excel', 'image/png', 'image/jpeg', 'text/csv'];
					return types[Math.floor(Math.random() * types.length)];
				}

				randomPlanId() {
					const plans = ['plan_basic', 'plan_pro', 'plan_enterprise', 'plan_starter'];
					return plans[Math.floor(Math.random() * plans.length)];
				}

				randomCancellationReason() {
					const reasons = ['too_expensive', 'not_enough_features', 'switching_to_competitor', 'no_longer_needed'];
					return reasons[Math.floor(Math.random() * reasons.length)];
				}

				randomDeletionReason() {
					const reasons = ['user_request', 'terms_violation', 'duplicate_account', 'inactivity'];
					return reasons[Math.floor(Math.random() * reasons.length)];
				}

				randomWebhookSource() {
					const sources = ['github', 'slack', 'stripe', 'shopify', 'mailchimp'];
					return sources[Math.floor(Math.random() * sources.length)];
				}

				randomWebhookEvent() {
					const events = ['push', 'pull_request', 'message.created', 'order.created', 'subscriber.added'];
					return events[Math.floor(Math.random() * events.length)];
				}

				futureDate(minDays, maxDays) {
					const days = Math.floor(Math.random() * (maxDays - minDays + 1)) + minDays;
					const future = new Date();
					future.setDate(future.getDate() + days);
					return future.toISOString();
				}

				// Public API
				getTemplates() {
					return Object.values(this.templates).map((t) => ({
						id: t.eventType,
						name: t.name,
						icon: t.icon,
						category: t.category,
						description: t.description,
					}));
				}

				getTemplatesByCategory() {
					const byCategory = {};
					this.getTemplates().forEach((t) => {
						if (!byCategory[t.category]) {
							byCategory[t.category] = [];
						}
						byCategory[t.category].push(t);
					});
					return byCategory;
				}

				generateEvent(templateId, customizations = {}) {
					const template = this.templates[templateId];
					if (!template) throw new Error(`Unknown template: ${templateId}`);

					const event = template.generate();

					// Apply customizations
					if (customizations.payload) {
						event.payload = { ...event.payload, ...customizations.payload };
					}

					return event;
				}

				generateBatch(templateId, count = 1) {
					const events = [];
					for (let i = 0; i < count; i++) {
						events.push(this.generateEvent(templateId));
					}
					return events;
				}

				generateDemoScenario() {
					// Sequence: user created → order created → order paid → email sent
					return [
						this.generateEvent('user.created'),
						this.generateEvent('order.created'),
						this.generateEvent('payment.completed'),
						this.generateEvent('order.paid'),
						this.generateEvent('email.sent'),
					];
				}

				generateStressTestData(count = 100) {
					const events = [];
					const templates = Object.keys(this.templates);
					for (let i = 0; i < count; i++) {
						const randomTemplate = templates[Math.floor(Math.random() * templates.length)];
						events.push(this.generateEvent(randomTemplate));
					}
					return events;
				}
			}

			// Initialize MockDataGenerator globally
			window.mockDataGenerator = new MockDataGenerator();

			/**
			 * Mock Data Generator UI Functions - Story 5.5
			 */

			// Initialize template categories on page load
			function initializeTemplateCategories() {
				const container = document.getElementById('template-categories');
				if (!container) return;

				const byCategory = window.mockDataGenerator.getTemplatesByCategory();
				let html = '';

				Object.entries(byCategory).forEach(([category, templates]) => {
					html += `
          <div class="template-category" style="margin-bottom: 16px;">
            <h5 style="font-size: 13px; font-weight: 600; margin-bottom: 8px; color: var(--color-text-secondary);">${category}</h5>
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 8px;">
              ${templates
								.map(
									(t) => `
                <button class="template-btn" onclick="generateAndSubmitEvent('${t.id}')"
                  title="${t.description}"
                  style="display: flex; align-items: center; gap: 6px; padding: 8px; background: var(--color-bg-primary); border: 1px solid var(--color-border-secondary); border-radius: 6px; cursor: pointer; font-size: 12px; transition: all 0.2s;">
                  <span style="font-size: 16px;">${t.icon}</span>
                  <span style="flex: 1; text-align: left; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${t.name}</span>
                </button>
              `,
								)
								.join('')}
            </div>
          </div>
        `;
				});

				container.innerHTML = html;
			}

			// Generate and submit a single event from template
			async function generateAndSubmitEvent(templateId) {
				try {
					const event = window.mockDataGenerator.generateEvent(templateId);
					const token = document.getElementById('bearerToken')?.value;

					if (!token) {
						if (window.toast) window.toast.error('Please enter authorization token first');
						return;
					}

					const response = await fetch('/events', {
						method: 'POST',
						headers: {
							'Content-Type': 'application/json',
							Authorization: `Bearer ${token}`,
						},
						body: JSON.stringify(event),
					});

					const result = await response.json();

					if (response.ok) {
						if (window.toast) {
							const template = window.mockDataGenerator.templates[templateId];
							window.toast.success(`${template.name} event created`, {
								description: `Event ID: ${result.data?.event_id || 'N/A'}`,
							});
						}
					} else {
						if (window.toast) window.toast.error('Failed to create event', result.error?.message);
					}
				} catch (error) {
					console.error('Error generating event:', error);
					if (window.toast) window.toast.error('Error: ' + error.message);
				}
			}

			// Load demo data (5 events from different categories)
			async function loadDemoData() {
				const token = document.getElementById('bearerToken')?.value;
				if (!token) {
					if (window.toast) window.toast.error('Please enter authorization token first');
					return;
				}

				const demoEvents = window.mockDataGenerator.generateDemoScenario();
				const toastId = window.toast ? window.toast.loading('Generating demo data...') : null;

				try {
					let succeeded = 0;
					for (const event of demoEvents) {
						const response = await fetch('/events', {
							method: 'POST',
							headers: {
								'Content-Type': 'application/json',
								Authorization: `Bearer ${token}`,
							},
							body: JSON.stringify(event),
						});

						if (response.ok) {
							succeeded++;
						}

						// Small delay between requests
						await new Promise((resolve) => setTimeout(resolve, 100));
					}

					if (toastId && window.toast) window.toast.remove(toastId);
					if (window.toast) window.toast.success(`Demo data loaded: ${succeeded} events created`);
				} catch (error) {
					if (toastId && window.toast) window.toast.remove(toastId);
					if (window.toast) window.toast.error('Error loading demo data: ' + error.message);
				}
			}

			// Generate realistic scenario (sequential events)
			async function generateRealisticScenario() {
				const token = document.getElementById('bearerToken')?.value;
				if (!token) {
					if (window.toast) window.toast.error('Please enter authorization token first');
					return;
				}

				const scenario = window.mockDataGenerator.generateDemoScenario();
				const toastId = window.toast ? window.toast.loading('Generating realistic scenario...') : null;

				try {
					let succeeded = 0;
					for (const event of scenario) {
						const response = await fetch('/events', {
							method: 'POST',
							headers: {
								'Content-Type': 'application/json',
								Authorization: `Bearer ${token}`,
							},
							body: JSON.stringify(event),
						});

						if (response.ok) {
							succeeded++;
						}

						// Delay to show sequence
						await new Promise((resolve) => setTimeout(resolve, 500));
					}

					if (toastId && window.toast) window.toast.remove(toastId);
					if (window.toast) window.toast.success(`Scenario complete: ${succeeded} events created`);
				} catch (error) {
					if (toastId && window.toast) window.toast.remove(toastId);
					if (window.toast) window.toast.error('Scenario generation failed: ' + error.message);
				}
			}

			// Show batch generator modal
			function showBatchGeneratorModal() {
				const modal = document.getElementById('batchGeneratorModal');
				const select = document.getElementById('batch-template-select');

				if (modal && select) {
					// Populate template dropdown
					const templates = window.mockDataGenerator.getTemplates();
					select.innerHTML = templates.map((t) => `<option value="${t.id}">${t.icon} ${t.name}</option>`).join('');

					modal.style.display = 'flex';
				}
			}

			// Close batch generator modal
			function closeBatchGeneratorModal() {
				const modal = document.getElementById('batchGeneratorModal');
				if (modal) modal.style.display = 'none';

				// Reset progress
				const progressContainer = document.getElementById('batch-progress-container');
				if (progressContainer) progressContainer.style.display = 'none';
			}

			// Submit batch generation
			async function submitBatchGeneration() {
				const templateId = document.getElementById('batch-template-select')?.value;
				const count = parseInt(document.getElementById('batch-count-input')?.value || '10');
				const token = document.getElementById('bearerToken')?.value;

				if (!token) {
					if (window.toast) window.toast.error('Please enter authorization token first');
					return;
				}

				if (count < 1 || count > 100) {
					if (window.toast) window.toast.warning('Count must be between 1 and 100');
					return;
				}

				// Show progress
				const progressContainer = document.getElementById('batch-progress-container');
				const progressBar = document.getElementById('batch-progress-bar');
				const progressText = document.getElementById('batch-progress-text');

				if (progressContainer) progressContainer.style.display = 'block';

				try {
					const events = window.mockDataGenerator.generateBatch(templateId, count);
					let succeeded = 0;

					for (let i = 0; i < events.length; i++) {
						const event = events[i];
						const response = await fetch('/events', {
							method: 'POST',
							headers: {
								'Content-Type': 'application/json',
								Authorization: `Bearer ${token}`,
							},
							body: JSON.stringify(event),
						});

						if (response.ok) {
							succeeded++;
						}

						// Update progress
						const progress = ((i + 1) / count) * 100;
						if (progressBar) progressBar.style.width = progress + '%';
						if (progressText) progressText.textContent = `${succeeded} / ${count} events created`;

						// Small delay to avoid overwhelming server
						await new Promise((resolve) => setTimeout(resolve, 50));
					}

					if (window.toast) window.toast.success(`Batch complete: ${succeeded}/${count} events created`);

					// Close modal after success
					setTimeout(() => {
						closeBatchGeneratorModal();
					}, 1000);
				} catch (error) {
					console.error('Batch generation error:', error);
					if (window.toast) window.toast.error('Batch generation failed: ' + error.message);
				}
			}

			// Show templates browser modal
			function showTemplatesBrowser() {
				const modal = document.getElementById('templateBrowserModal');
				const grid = document.getElementById('templates-browser-grid');
				const filterContainer = document.getElementById('category-filters');

				if (modal && grid) {
					// Populate category filters
					const byCategory = window.mockDataGenerator.getTemplatesByCategory();
					const categories = Object.keys(byCategory);

					if (filterContainer) {
						filterContainer.innerHTML = `
            <button class="category-filter active" data-category="all" onclick="filterByCategory('all')"
              style="padding: 6px 12px; border: 1px solid var(--color-border-secondary); border-radius: 4px; background: var(--color-primary); color: white; cursor: pointer; font-size: 12px;">
              All
            </button>
            ${categories
							.map(
								(cat) => `
              <button class="category-filter" data-category="${cat}" onclick="filterByCategory('${cat}')"
                style="padding: 6px 12px; border: 1px solid var(--color-border-secondary); border-radius: 4px; background: white; cursor: pointer; font-size: 12px;">
                ${cat}
              </button>
            `,
							)
							.join('')}
          `;
					}

					// Populate templates grid
					renderTemplatesGrid();
					modal.style.display = 'flex';
				}
			}

			// Close templates browser modal
			function closeTemplateBrowserModal() {
				const modal = document.getElementById('templateBrowserModal');
				if (modal) modal.style.display = 'none';
			}

			// Render templates grid
			function renderTemplatesGrid(filter = null, category = 'all') {
				const grid = document.getElementById('templates-browser-grid');
				if (!grid) return;

				let templates = window.mockDataGenerator.getTemplates();

				// Apply category filter
				if (category !== 'all') {
					templates = templates.filter((t) => t.category === category);
				}

				// Apply search filter
				if (filter) {
					const lowerFilter = filter.toLowerCase();
					templates = templates.filter(
						(t) =>
							t.name.toLowerCase().includes(lowerFilter) ||
							t.description.toLowerCase().includes(lowerFilter) ||
							t.category.toLowerCase().includes(lowerFilter),
					);
				}

				grid.innerHTML = templates
					.map(
						(t) => `
        <div class="template-card" style="padding: 16px; border: 1px solid var(--color-border-secondary); border-radius: 8px; background: white; transition: all 0.2s; cursor: pointer;"
          onclick="generateAndSubmitEventFromBrowser('${t.id}')">
          <div style="font-size: 32px; text-align: center; margin-bottom: 8px;">${t.icon}</div>
          <h4 style="font-size: 14px; font-weight: 600; margin: 0 0 4px 0; text-align: center;">${t.name}</h4>
          <p style="font-size: 11px; color: var(--color-text-secondary); margin: 0; text-align: center;">${t.description}</p>
          <div style="margin-top: 8px; text-align: center;">
            <span style="display: inline-block; padding: 2px 8px; background: var(--color-bg-tertiary); border-radius: 3px; font-size: 10px; color: var(--color-text-secondary);">
              ${t.category}
            </span>
          </div>
        </div>
      `,
					)
					.join('');
			}

			// Filter templates by search
			function filterTemplates(searchText) {
				const activeCategory = document.querySelector('.category-filter.active')?.dataset.category || 'all';
				renderTemplatesGrid(searchText, activeCategory);
			}

			// Filter by category
			function filterByCategory(category) {
				// Update active filter button
				document.querySelectorAll('.category-filter').forEach((btn) => {
					btn.classList.remove('active');
					btn.style.background = 'white';
					btn.style.color = 'inherit';
				});

				const activeBtn = document.querySelector(`[data-category="${category}"]`);
				if (activeBtn) {
					activeBtn.classList.add('active');
					activeBtn.style.background = 'var(--color-primary)';
					activeBtn.style.color = 'white';
				}

				const searchText = document.getElementById('template-search')?.value || '';
				renderTemplatesGrid(searchText, category);
			}

			// Generate and submit from browser modal
			async function generateAndSubmitEventFromBrowser(templateId) {
				await generateAndSubmitEvent(templateId);
				closeTemplateBrowserModal();
			}

			// Initialize on page load
			document.addEventListener('DOMContentLoaded', () => {
				initializeTemplateCategories();
			});

			/**
			 * FlowVisualization Class - Event Flow Diagram
			 * Visualizes event journey: Ingestion → Queue → Processing → Storage
			 */
			class FlowVisualization {
				constructor() {
					this.metrics = {};
					this.previousMetrics = {};
					this.baselineMetrics = null;
					this.comparisonMode = false;
					this.updateInterval = null;
					this.particleInterval = null;
					this.metricHistory = {
						ingestion: [],
						queue: [],
						processing: [],
						storage: [],
						dlq: [],
					};
					this.maxHistoryLength = 30; // 5 minutes at 2s intervals
					this.init();
				}

				init() {
					this.setupEventListeners();
					this.startMetricsUpdate();
					this.startParticleAnimation();
				}

				setupEventListeners() {
					// Click stages for detail popover
					const stages = ['ingestion', 'queue', 'processing', 'storage', 'dlq'];
					stages.forEach((stage) => {
						const element = document.getElementById(`stage-${stage}`);
						if (element) {
							element.addEventListener('click', (e) => this.showDetailPopover(stage, e));
						}
					});

					// Close popover button
					const closeBtn = document.getElementById('popoverClose');
					if (closeBtn) {
						closeBtn.addEventListener('click', () => this.hideDetailPopover());
					}

					// Close popover when clicking outside
					document.addEventListener('click', (e) => {
						const popover = document.getElementById('flowDetailPopover');
						if (popover && !popover.classList.contains('hidden') && !popover.contains(e.target) && !e.target.closest('.stage-box')) {
							this.hideDetailPopover();
						}
					});

					// Comparison mode toggle
					const comparisonToggle = document.getElementById('comparisonModeToggle');
					if (comparisonToggle) {
						comparisonToggle.addEventListener('change', (e) => {
							this.comparisonMode = e.target.checked;
							if (this.comparisonMode && !this.baselineMetrics) {
								this.calculateBaseline();
							}
							this.updateDisplay();
						});
					}

					// Export button
					const exportBtn = document.getElementById('exportFlowBtn');
					if (exportBtn) {
						exportBtn.addEventListener('click', () => this.exportDiagram());
					}
				}

				async startMetricsUpdate() {
					// Initial update
					await this.updateMetrics();

					// Update every 2 seconds
					this.updateInterval = setInterval(() => {
						this.updateMetrics();
					}, 2000);
				}

				async updateMetrics() {
					try {
						const response = await fetch('/metrics', {
							method: 'GET',
							headers: { 'Content-Type': 'application/json' },
						});

						if (!response.ok) {
							throw new Error(`HTTP ${response.status}`);
						}

						const result = await response.json();
						const data = result.data || result;

						// Store previous metrics for trend calculation
						this.previousMetrics = { ...this.metrics };

						// Update current metrics
						this.metrics = {
							ingestion: data.processing_rate || 0,
							queue_depth: data.queue_depth || 0,
							processing_rate: data.processing_rate || 0,
							success_rate: ((data.delivered || 0) / (data.total_events || 1)) * 100,
							storage: data.total_events || 0,
							dlq: data.dlq_count || 0,
							error_rate: ((data.failed || 0) / (data.total_events || 1)) * 100,
							delivered: data.delivered || 0,
							failed: data.failed || 0,
							pending: data.pending || 0,
						};

						// Add to history
						this.addToHistory('ingestion', this.metrics.ingestion);
						this.addToHistory('queue', this.metrics.queue_depth);
						this.addToHistory('processing', this.metrics.success_rate);
						this.addToHistory('storage', this.metrics.storage);
						this.addToHistory('dlq', this.metrics.dlq);

						this.updateDisplay();

						// Show the flow section once we have data
						const flowSection = document.getElementById('eventFlowSection');
						if (flowSection && flowSection.style.display === 'none') {
							flowSection.style.display = 'block';
						}
					} catch (error) {
						console.error('Failed to fetch flow metrics:', error);
					}
				}

				addToHistory(metric, value) {
					if (!this.metricHistory[metric]) {
						this.metricHistory[metric] = [];
					}
					this.metricHistory[metric].push(value);
					if (this.metricHistory[metric].length > this.maxHistoryLength) {
						this.metricHistory[metric].shift();
					}
				}

				updateDisplay() {
					// Update metric values with animation
					this.updateMetricValue('flow-metric-ingestion', this.metrics.ingestion.toFixed(1));
					this.updateMetricValue('flow-metric-queue', Math.round(this.metrics.queue_depth));
					this.updateMetricValue('flow-metric-processing', this.metrics.success_rate.toFixed(1) + '%');
					this.updateMetricValue('flow-metric-storage', Math.round(this.metrics.storage));
					this.updateMetricValue('flow-metric-dlq', Math.round(this.metrics.dlq));

					// Update throughput labels
					this.updateElement('throughput-1', `${this.metrics.ingestion.toFixed(1)}/s`);
					this.updateElement('throughput-2', `${this.metrics.processing_rate.toFixed(1)}/s`);
					this.updateElement('throughput-3', `${(this.metrics.storage / 100).toFixed(1)}/s`);
					this.updateElement('dlq-rate', `${(this.metrics.dlq / 10).toFixed(1)}/s`);

					// Update status indicators
					this.updateStageStatus('ingestion', this.metrics.ingestion);
					this.updateStageStatus('queue', this.metrics.queue_depth);
					this.updateStageStatus('processing', this.metrics.success_rate);
					this.updateStageStatus('storage', this.metrics.storage);

					// Update DLQ status and arrow
					const dlqStage = document.getElementById('stage-dlq');
					const dlqArrow = document.getElementById('arrow-dlq');
					if (this.metrics.dlq > 0) {
						dlqStage?.setAttribute('data-status', 'critical');
						dlqArrow?.classList.add('active');
						dlqArrow?.setAttribute('opacity', '1');
					} else {
						dlqStage?.setAttribute('data-status', 'normal');
						dlqArrow?.classList.remove('active');
						dlqArrow?.setAttribute('opacity', '0.3');
					}

					// Update trend indicators
					this.updateTrendIndicators();

					// Update arrow activity based on throughput
					this.updateArrowActivity();

					// Update comparison mode display if enabled
					if (this.comparisonMode) {
						this.updateComparisonDisplay();
					}
				}

				updateMetricValue(elementId, value) {
					const element = document.getElementById(elementId);
					if (!element) return;

					const oldValue = element.textContent;
					if (oldValue !== value.toString()) {
						element.textContent = value;
						element.classList.add('updating');
						setTimeout(() => element.classList.remove('updating'), 300);
					}
				}

				updateElement(elementId, value) {
					const element = document.getElementById(elementId);
					if (element) {
						element.textContent = value;
					}
				}

				updateStageStatus(stage, metricValue) {
					const element = document.getElementById(`stage-${stage}`);
					if (!element) return;

					let status = 'normal';
					let fill = 'url(#normalGradient)';

					if (stage === 'queue') {
						// Queue status based on depth
						if (metricValue > 500) {
							status = 'critical';
							fill = 'url(#criticalGradient)';
						} else if (metricValue > 100) {
							status = 'degraded';
							fill = 'url(#degradedGradient)';
						}
					} else if (stage === 'processing') {
						// Processing status based on success rate
						if (metricValue < 90) {
							status = 'critical';
							fill = 'url(#criticalGradient)';
						} else if (metricValue < 95) {
							status = 'degraded';
							fill = 'url(#degradedGradient)';
						}
					} else if (stage === 'ingestion' || stage === 'storage') {
						// Normal operation for ingestion/storage
						status = 'normal';
					}

					element.setAttribute('data-status', status);
					const rect = element.querySelector('.stage-rect');
					if (rect) {
						rect.setAttribute('fill', fill);
					}
				}

				updateTrendIndicators() {
					const trends = {
						ingestion: this.calculateTrend(this.metrics.ingestion, this.previousMetrics.ingestion),
						queue: this.calculateTrend(this.metrics.queue_depth, this.previousMetrics.queue_depth),
						processing: this.calculateTrend(this.metrics.success_rate, this.previousMetrics.success_rate),
						storage: this.calculateTrend(this.metrics.storage, this.previousMetrics.storage),
					};

					Object.entries(trends).forEach(([stage, trend]) => {
						const indicator = document.getElementById(`trend-${stage}`);
						if (indicator) {
							let path = 'M 85 125 L 95 125'; // flat
							let stroke = '#6b7280';

							if (trend > 0) {
								path = 'M 85 130 L 90 120 L 95 130'; // up arrow
								stroke = '#10b981';
							} else if (trend < 0) {
								path = 'M 85 120 L 90 130 L 95 120'; // down arrow
								stroke = '#ef4444';
							}

							indicator.setAttribute('d', path);
							indicator.setAttribute('stroke', stroke);
						}
					});
				}

				calculateTrend(current, previous) {
					if (!previous || previous === 0) return 0;
					const change = current - previous;
					if (Math.abs(change) < 0.1) return 0;
					return change > 0 ? 1 : -1;
				}

				updateArrowActivity() {
					// Activate arrows based on throughput
					const arrows = [
						{ id: 'arrow-1', threshold: 0.1 },
						{ id: 'arrow-2', threshold: 0.1 },
						{ id: 'arrow-3', threshold: 0.1 },
					];

					arrows.forEach(({ id, threshold }) => {
						const arrow = document.getElementById(id);
						if (arrow) {
							if (this.metrics.ingestion > threshold) {
								arrow.classList.add('active');
							} else {
								arrow.classList.remove('active');
							}
						}
					});
				}

				startParticleAnimation() {
					// Spawn particles periodically
					this.particleInterval = setInterval(() => {
						if (this.metrics.ingestion > 0.1) {
							this.createParticle();
						}
					}, 3000); // Every 3 seconds
				}

				createParticle() {
					const container = document.getElementById('particles-container');
					if (!container) return;

					// Create particle element
					const particle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
					particle.setAttribute('r', '5');
					particle.setAttribute('cx', '230');
					particle.setAttribute('cy', '150');
					particle.classList.add('event-particle');

					// Color based on success rate
					const color = this.metrics.success_rate > 95 ? '#10b981' : this.metrics.success_rate > 90 ? '#f59e0b' : '#ef4444';
					particle.setAttribute('fill', color);

					container.appendChild(particle);

					// Animate particle along the path
					this.animateParticle(particle);
				}

				animateParticle(particle) {
					const path = [
						{ x: 230, y: 150 }, // Start after Ingestion
						{ x: 410, y: 150 }, // Queue
						{ x: 680, y: 150 }, // Processing
						{ x: 950, y: 150 }, // Storage
					];

					let step = 0;
					const totalSteps = 60;
					const duration = 3000;
					const interval = duration / totalSteps;

					const animation = setInterval(() => {
						step++;
						const progress = step / totalSteps;
						const segmentIndex = Math.floor(progress * (path.length - 1));
						const segmentProgress = progress * (path.length - 1) - segmentIndex;

						if (segmentIndex < path.length - 1) {
							const start = path[segmentIndex];
							const end = path[segmentIndex + 1];
							const x = start.x + (end.x - start.x) * segmentProgress;
							const y = start.y + (end.y - start.y) * segmentProgress;

							particle.setAttribute('cx', x);
							particle.setAttribute('cy', y);
						}

						if (step >= totalSteps) {
							clearInterval(animation);
							particle.remove();
						}
					}, interval);
				}

				showDetailPopover(stageName, event) {
					const popover = document.getElementById('flowDetailPopover');
					if (!popover) return;

					// Update popover content
					document.getElementById('popover-title').textContent = stageName.charAt(0).toUpperCase() + stageName.slice(1);

					const stageData = this.getStageData(stageName);
					document.getElementById('popover-value').textContent = stageData.value;
					document.getElementById('popover-rate').textContent = stageData.rate;
					document.getElementById('popover-trend').textContent = stageData.trend;
					document.getElementById('popover-timestamp').textContent = new Date().toLocaleTimeString();

					// Draw sparkline
					this.drawSparkline(stageName);

					// Position popover
					const rect = event.currentTarget.getBoundingClientRect();
					popover.style.left = `${rect.right + 20}px`;
					popover.style.top = `${rect.top}px`;
					popover.classList.remove('hidden');
				}

				getStageData(stage) {
					const data = {
						ingestion: {
							value: this.metrics.ingestion.toFixed(1),
							rate: `${this.metrics.ingestion.toFixed(1)} events/sec`,
							trend: this.getTrendSymbol(this.metrics.ingestion, this.previousMetrics.ingestion),
						},
						queue: {
							value: Math.round(this.metrics.queue_depth),
							rate: `${Math.round(this.metrics.queue_depth)} pending`,
							trend: this.getTrendSymbol(this.metrics.queue_depth, this.previousMetrics.queue_depth),
						},
						processing: {
							value: this.metrics.success_rate.toFixed(1) + '%',
							rate: `${this.metrics.success_rate.toFixed(1)}% success`,
							trend: this.getTrendSymbol(this.metrics.success_rate, this.previousMetrics.success_rate),
						},
						storage: {
							value: Math.round(this.metrics.storage),
							rate: `${Math.round(this.metrics.storage)} persisted`,
							trend: this.getTrendSymbol(this.metrics.storage, this.previousMetrics.storage),
						},
						dlq: {
							value: Math.round(this.metrics.dlq),
							rate: `${Math.round(this.metrics.dlq)} failed`,
							trend: this.getTrendSymbol(this.metrics.dlq, this.previousMetrics.dlq),
						},
					};

					return data[stage] || { value: '0', rate: '0/sec', trend: '→' };
				}

				getTrendSymbol(current, previous) {
					if (!previous) return '→';
					if (current > previous) return '↑';
					if (current < previous) return '↓';
					return '→';
				}

				drawSparkline(stage) {
					const canvas = document.getElementById('popover-sparkline');
					if (!canvas) return;

					const ctx = canvas.getContext('2d');
					const history = this.metricHistory[stage] || [];

					if (history.length < 2) return;

					// Clear canvas
					ctx.clearRect(0, 0, canvas.width, canvas.height);

					// Calculate dimensions
					const width = canvas.width;
					const height = canvas.height;
					const padding = 5;
					const dataMax = Math.max(...history, 1);
					const dataMin = Math.min(...history, 0);
					const range = dataMax - dataMin || 1;

					// Draw line
					ctx.beginPath();
					ctx.strokeStyle = '#3b82f6';
					ctx.lineWidth = 2;

					history.forEach((value, index) => {
						const x = padding + (index / (history.length - 1)) * (width - padding * 2);
						const y = height - padding - ((value - dataMin) / range) * (height - padding * 2);

						if (index === 0) {
							ctx.moveTo(x, y);
						} else {
							ctx.lineTo(x, y);
						}
					});

					ctx.stroke();

					// Draw area under line
					ctx.lineTo(width - padding, height - padding);
					ctx.lineTo(padding, height - padding);
					ctx.closePath();
					ctx.fillStyle = 'rgba(59, 130, 246, 0.1)';
					ctx.fill();
				}

				hideDetailPopover() {
					const popover = document.getElementById('flowDetailPopover');
					if (popover) {
						popover.classList.add('hidden');
					}
				}

				calculateBaseline() {
					// Calculate 24-hour average baseline (simplified)
					this.baselineMetrics = { ...this.metrics };
				}

				updateComparisonDisplay() {
					if (!this.baselineMetrics) return;

					// Add percentage difference indicators
					// This would show comparison vs baseline
					// Implementation simplified for now
				}

				exportDiagram() {
					const svg = document.getElementById('flowDiagram');
					if (!svg) return;

					try {
						// Serialize SVG to string
						const serializer = new XMLSerializer();
						const svgString = serializer.serializeToString(svg);

						// Create blob and download
						const blob = new Blob([svgString], { type: 'image/svg+xml' });
						const url = URL.createObjectURL(blob);
						const link = document.createElement('a');
						link.href = url;
						link.download = `event-flow-${new Date().toISOString()}.svg`;
						document.body.appendChild(link);
						link.click();
						document.body.removeChild(link);
						URL.revokeObjectURL(url);

						// Show success message
						if (window.toast) {
							window.toast.success('Flow diagram exported successfully!');
						}
					} catch (error) {
						console.error('Export failed:', error);
						if (window.toast) {
							window.toast.error('Failed to export diagram');
						}
					}
				}

				destroy() {
					if (this.updateInterval) {
						clearInterval(this.updateInterval);
					}
					if (this.particleInterval) {
						clearInterval(this.particleInterval);
					}
				}
			}

			// Initialize Flow Visualization on page load
			document.addEventListener('DOMContentLoaded', () => {
				window.flowVisualization = new FlowVisualization();
			});

			// Cleanup on page unload
			window.addEventListener('beforeunload', () => {
				if (window.flowVisualization) {
					window.flowVisualization.destroy();
				}
			});

			/* ============================================
       PHASE 3: JAVASCRIPT ENHANCEMENTS
       ============================================ */

			/**
			 * Health Check Function - Replaces fake "System Live" badge
			 * Pings /metrics endpoint every 30 seconds to verify system health
			 */
			async function performHealthCheck() {
				const healthCheckText = document.getElementById('healthCheckText');
				if (!healthCheckText) return;

				try {
					const startTime = Date.now();
					const token = document.getElementById('bearerToken')?.value || '';
					const response = await fetch('/metrics', {
						method: 'GET',
						headers: token ? { Authorization: `Bearer ${token}` } : {},
					});

					const latency = Date.now() - startTime;

					if (response.ok) {
						healthCheckText.innerHTML = `<span style="color: var(--color-success);">● Healthy</span> <span style="font-size: 11px;">(${latency}ms)</span>`;
					} else {
						healthCheckText.innerHTML = `<span style="color: var(--color-warning);">⚠ Degraded</span>`;
					}
				} catch (error) {
					healthCheckText.innerHTML = `<span style="color: var(--color-error);">● Offline</span>`;
				}
			}

			/**
			 * Inbox Auto-Refresh - Updates inbox every 5 seconds
			 */
			function startInboxAutoRefresh() {
				setInterval(() => {
					if (typeof fetchInboxEvents === 'function') {
						fetchInboxEvents();
					}
				}, 5000);
			}

			// Initialize health check on page load
			document.addEventListener('DOMContentLoaded', () => {
				performHealthCheck();
				startInboxAutoRefresh();
			});

			// Run health check every 30 seconds
			setInterval(performHealthCheck, 30000);

			// ============================================
			// Performance Testing Module - Story 6.1
			// ============================================

			/**
			 * Performance Testing State
			 */
			let performanceTestRunner = null;
			let latencyInjector = {
				enabled: false,
				profile: null,
			};
			let performanceMetricsInterval = null;
			let testHistory = [];

			/**
			 * Initialize Performance Testing Module
			 */
			function initPerformanceTestingModule() {
				// Tab switching
				document.querySelectorAll('.perf-tab-btn').forEach((btn) => {
					btn.addEventListener('click', (e) => {
						const tab = e.target.dataset.tab;
						switchPerformanceTab(tab);
					});
				});

				// Load Simulation - Rate presets
				document.querySelectorAll('.rate-presets .preset-btn').forEach((btn) => {
					btn.addEventListener('click', (e) => {
						const rate = parseInt(e.target.dataset.rate);
						document.getElementById('event-rate').value = rate;
					});
				});

				// Load Simulation - Duration presets
				document.querySelectorAll('.duration-presets .preset-btn').forEach((btn) => {
					btn.addEventListener('click', (e) => {
						const duration = parseInt(e.target.dataset.duration);
						document.getElementById('test-duration').value = duration;
					});
				});

				// Load Simulation - Profile buttons
				document.querySelectorAll('.load-profiles .profile-btn').forEach((btn) => {
					btn.addEventListener('click', (e) => {
						const profile = e.target.dataset.profile;
						applyLoadProfile(profile);
					});
				});

				// Load Simulation - Control buttons
				document.getElementById('start-load-btn').addEventListener('click', startLoadTest);
				document.getElementById('pause-load-btn').addEventListener('click', pauseLoadTest);
				document.getElementById('stop-load-btn').addEventListener('click', stopLoadTest);

				// Network Simulation - Sliders
				document.getElementById('latency-slider').addEventListener('input', (e) => {
					document.getElementById('latency-value').textContent = e.target.value + 'ms';
				});
				document.getElementById('jitter-slider').addEventListener('input', (e) => {
					document.getElementById('jitter-value').textContent = e.target.value + 'ms';
				});
				document.getElementById('packet-loss-slider').addEventListener('input', (e) => {
					document.getElementById('packet-loss-value').textContent = e.target.value + '%';
				});

				// Network Simulation - Preset profiles
				document.querySelectorAll('.network-presets .profile-btn').forEach((btn) => {
					btn.addEventListener('click', (e) => {
						const profile = e.target.dataset.network;
						applyNetworkProfile(profile);
					});
				});

				// Network Simulation - Apply/Clear buttons
				document.getElementById('apply-latency-btn').addEventListener('click', applyLatencyInjection);
				document.getElementById('clear-latency-btn').addEventListener('click', clearLatencyInjection);

				// Metrics - Reset button
				document.getElementById('reset-metrics-btn').addEventListener('click', resetMetrics);

				// Results - Download button
				document.getElementById('download-results-btn').addEventListener('click', downloadResults);

				console.log('Performance Testing Module initialized');
			}

			/**
			 * Switch Performance Tab
			 */
			function switchPerformanceTab(tab) {
				// Update tab buttons
				document.querySelectorAll('.perf-tab-btn').forEach((btn) => {
					btn.classList.toggle('active', btn.dataset.tab === tab);
				});

				// Update tab content
				document.querySelectorAll('.perf-tab-content').forEach((content) => {
					if (content.id === `${tab}-tab`) {
						content.classList.remove('hidden');
						content.classList.add('active');
					} else {
						content.classList.add('hidden');
						content.classList.remove('active');
					}
				});
			}

			/**
			 * Apply Load Profile
			 */
			function applyLoadProfile(profileName) {
				const profiles = {
					quick: { rate: 10, duration: 10 },
					sustained: { rate: 100, duration: 60 },
					stress: { rate: 500, duration: 30 },
					endurance: { rate: 50, duration: 600 },
				};

				const profile = profiles[profileName];
				if (profile) {
					document.getElementById('event-rate').value = profile.rate;
					document.getElementById('test-duration').value = profile.duration;
					showToast(`Applied ${profileName} profile: ${profile.rate} evt/s for ${profile.duration}s`, 'success');
				}
			}

			/**
			 * Start Load Test
			 */
			async function startLoadTest() {
				const rate = parseInt(document.getElementById('event-rate').value);
				const duration = parseInt(document.getElementById('test-duration').value);
				const templateId = document.getElementById('event-template').value;
				const randomize = document.getElementById('randomize-payloads').checked;
				const authToken = document.getElementById('authToken').value;

				if (!authToken) {
					showToast('Please enter an auth token in the main form', 'error');
					return;
				}

				if (!rate || rate < 1 || !duration || duration < 1) {
					showToast('Please enter valid rate and duration', 'error');
					return;
				}

				const expectedTotal = rate * duration;
				showToast(`Starting load test: ${rate} events/sec for ${duration}s (${expectedTotal} total events)`, 'info');

				// Update UI
				document.getElementById('start-load-btn').disabled = true;
				document.getElementById('pause-load-btn').disabled = false;
				document.getElementById('stop-load-btn').disabled = false;
				document.getElementById('load-progress').classList.remove('hidden');
				document.getElementById('load-status').textContent = 'Running';

				// Create config (inline to avoid TypeScript import)
				const config = {
					eventRate: rate,
					duration: duration,
					templateId: templateId,
					randomizePayloads: randomize,
					authToken: authToken,
				};

				// Create test runner (simulated - actual implementation would import the class)
				performanceTestRunner = createPerformanceTestRunner(config);

				// Register callbacks
				performanceTestRunner.onProgress(updateLoadProgress);
				performanceTestRunner.onMetrics(updateMetrics);

				// Start test
				try {
					await performanceTestRunner.start();
					showToast('Load test completed', 'success');
					onLoadTestComplete();
				} catch (error) {
					showToast(`Load test error: ${error.message}`, 'error');
					resetLoadTestUI();
				}
			}

			/**
			 * Pause Load Test
			 */
			function pauseLoadTest() {
				if (performanceTestRunner && performanceTestRunner.isRunning()) {
					if (performanceTestRunner.isPaused()) {
						performanceTestRunner.resume();
						document.getElementById('pause-load-btn').textContent = 'Pause';
						document.getElementById('load-status').textContent = 'Running';
						showToast('Load test resumed', 'info');
					} else {
						performanceTestRunner.pause();
						document.getElementById('pause-load-btn').textContent = 'Resume';
						document.getElementById('load-status').textContent = 'Paused';
						showToast('Load test paused', 'info');
					}
				}
			}

			/**
			 * Stop Load Test
			 */
			function stopLoadTest() {
				if (performanceTestRunner) {
					performanceTestRunner.stop();
					showToast('Load test stopped', 'warning');
					onLoadTestComplete();
				}
			}

			/**
			 * Update Load Progress
			 */
			function updateLoadProgress(progress) {
				const expectedTotal =
					parseInt(document.getElementById('event-rate').value) * parseInt(document.getElementById('test-duration').value);
				const percentage = (progress.eventsSent / expectedTotal) * 100;

				document.getElementById('progress-events').textContent = `${progress.eventsSent} / ${expectedTotal} events`;

				const elapsedSec = Math.floor(progress.elapsedTime / 1000);
				const totalSec = parseInt(document.getElementById('test-duration').value);
				document.getElementById('progress-time').textContent = `${formatTime(elapsedSec)} / ${formatTime(totalSec)}`;

				document.getElementById('progress-rate').textContent = `${progress.currentRate.toFixed(1)} evt/s`;

				document.getElementById('progress-fill').style.width = `${percentage}%`;
			}

			/**
			 * Update Metrics Display
			 */
			function updateMetrics(metrics) {
				const stats = calculateStats(metrics);

				// Update throughput
				document.getElementById('throughput-metric').textContent = `${stats.throughput.toFixed(1)} evt/s`;
				updateMetricStatus('throughput-status', stats.throughput, 100, 'higher');

				// Update latency p95
				document.getElementById('latency-p95-metric').textContent = `${stats.latencyP95.toFixed(1)} ms`;
				updateMetricStatus('latency-p95-status', stats.latencyP95, 100, 'lower');

				// Update error rate
				document.getElementById('error-rate-metric').textContent = `${stats.errorRate.toFixed(2)}%`;
				updateMetricStatus('error-rate-status', stats.errorRate, 1, 'lower');

				// Update success rate
				document.getElementById('success-rate-metric').textContent = `${stats.successRate.toFixed(1)}%`;

				// Update percentiles
				document.getElementById('latency-p50').textContent = `${stats.latencyP50.toFixed(1)}ms`;
				document.getElementById('latency-p75').textContent = `${stats.latencyP75.toFixed(1)}ms`;
				document.getElementById('latency-p90').textContent = `${stats.latencyP90.toFixed(1)}ms`;
				document.getElementById('latency-p95').textContent = `${stats.latencyP95.toFixed(1)}ms`;
				document.getElementById('latency-p99').textContent = `${stats.latencyP99.toFixed(1)}ms`;
				document.getElementById('latency-p999').textContent = `${stats.latencyP999.toFixed(1)}ms`;
			}

			/**
			 * Update Metric Status Color
			 */
			function updateMetricStatus(elementId, value, threshold, comparison) {
				const element = document.getElementById(elementId);
				let status = 'Good';
				let color = 'var(--color-success)';

				if (comparison === 'higher') {
					if (value < threshold * 0.5) {
						status = 'Low';
						color = 'var(--color-warning)';
					} else if (value < threshold) {
						status = 'Below Target';
						color = 'var(--color-warning)';
					}
				} else {
					if (value > threshold * 2) {
						status = 'Critical';
						color = 'var(--color-error)';
					} else if (value > threshold) {
						status = 'Warning';
						color = 'var(--color-warning)';
					}
				}

				element.textContent = status;
				element.style.color = color;
			}

			/**
			 * On Load Test Complete
			 */
			function onLoadTestComplete() {
				const metrics = performanceTestRunner.getMetrics();
				const stats = calculateStats(metrics);
				const assessment = assessPerformance(stats);

				// Update results tab
				updateResultsSummary(metrics, stats, assessment);

				// Save to history
				testHistory.push({
					timestamp: Date.now(),
					metrics: metrics,
					stats: stats,
					assessment: assessment,
				});

				// Enable download button
				document.getElementById('download-results-btn').disabled = false;

				// Reset UI
				resetLoadTestUI();

				// Switch to results tab
				switchPerformanceTab('results');
			}

			/**
			 * Reset Load Test UI
			 */
			function resetLoadTestUI() {
				document.getElementById('start-load-btn').disabled = false;
				document.getElementById('pause-load-btn').disabled = true;
				document.getElementById('pause-load-btn').textContent = 'Pause';
				document.getElementById('stop-load-btn').disabled = true;
				document.getElementById('load-status').textContent = 'Complete';
			}

			/**
			 * Update Results Summary
			 */
			function updateResultsSummary(metrics, stats, assessment) {
				document.getElementById('result-total').textContent = metrics.totalEvents;
				document.getElementById('result-success').textContent = metrics.successCount;
				document.getElementById('result-failed').textContent = metrics.failureCount;
				document.getElementById('result-duration').textContent = `${((metrics.endTime - metrics.startTime) / 1000).toFixed(1)}s`;

				document.getElementById('result-throughput').textContent = `${stats.throughput.toFixed(1)} evt/s`;
				document.getElementById('result-latency-avg').textContent = `${stats.latencyAvg.toFixed(1)} ms`;
				document.getElementById('result-latency-p95').textContent = `${stats.latencyP95.toFixed(1)} ms`;
				document.getElementById('result-latency-p99').textContent = `${stats.latencyP99.toFixed(1)} ms`;
				document.getElementById('result-error-rate').textContent = `${stats.errorRate.toFixed(2)}%`;

				// Update assessment
				const assessmentHtml = `
        <div style="margin-bottom: 12px;">
          <strong>${assessment.pass ? '✅ PASS' : '❌ FAIL'}</strong>
        </div>
        <div style="font-size: 11px;">
          <div>Throughput: ${stats.throughput.toFixed(1)} evt/s ${assessment.criteria.throughput.pass ? '✅' : '❌'} (target: 100)</div>
          <div>Latency p95: ${stats.latencyP95.toFixed(1)}ms ${assessment.criteria.latencyP95.pass ? '✅' : '❌'} (target: <100ms)</div>
          <div>Error Rate: ${stats.errorRate.toFixed(2)}% ${assessment.criteria.errorRate.pass ? '✅' : '❌'} (target: <1%)</div>
        </div>
        <div style="margin-top: 8px; font-size: 11px;">
          ${assessment.recommendations.map((r) => `<div>• ${r}</div>`).join('')}
        </div>
      `;
				document.getElementById('result-assessment').innerHTML = assessmentHtml;
			}

			/**
			 * Apply Network Profile
			 */
			function applyNetworkProfile(profileName) {
				const profiles = {
					none: { baseLatency: 0, jitter: 0, packetLoss: 0, throttle: 'full' },
					poor: { baseLatency: 300, jitter: 150, packetLoss: 5, throttle: '3g' },
					mobile3g: { baseLatency: 200, jitter: 100, packetLoss: 2, throttle: '3g' },
					mobile4g: { baseLatency: 100, jitter: 50, packetLoss: 1, throttle: '4g' },
				};

				const profile = profiles[profileName];
				if (profile) {
					document.getElementById('latency-slider').value = profile.baseLatency;
					document.getElementById('latency-value').textContent = profile.baseLatency + 'ms';
					document.getElementById('jitter-slider').value = profile.jitter;
					document.getElementById('jitter-value').textContent = profile.jitter + 'ms';
					document.getElementById('packet-loss-slider').value = profile.packetLoss;
					document.getElementById('packet-loss-value').textContent = profile.packetLoss + '%';
					document.getElementById('throttle-select').value = profile.throttle;
				}
			}

			/**
			 * Apply Latency Injection
			 */
			function applyLatencyInjection() {
				const baseLatency = parseInt(document.getElementById('latency-slider').value);
				const jitter = parseInt(document.getElementById('jitter-slider').value);
				const packetLoss = parseInt(document.getElementById('packet-loss-slider').value);
				const throttle = document.getElementById('throttle-select').value;

				latencyInjector.enabled = true;
				latencyInjector.profile = {
					name: 'Custom',
					baseLatency: baseLatency,
					jitter: jitter,
					packetLoss: packetLoss,
					throttle: throttle,
				};

				const description = getLatencyProfileDescription(latencyInjector.profile);
				document.getElementById('latency-status-text').textContent = `Active: ${description}`;

				showToast(`Latency injection enabled: ${description}`, 'success');
			}

			/**
			 * Clear Latency Injection
			 */
			function clearLatencyInjection() {
				latencyInjector.enabled = false;
				latencyInjector.profile = null;
				document.getElementById('latency-status-text').textContent = 'No latency injection';
				showToast('Latency injection cleared', 'info');
			}

			/**
			 * Get Latency Profile Description
			 */
			function getLatencyProfileDescription(profile) {
				const parts = [];
				if (profile.baseLatency > 0) parts.push(`${profile.baseLatency}ms latency`);
				if (profile.jitter > 0) parts.push(`±${profile.jitter}ms jitter`);
				if (profile.packetLoss > 0) parts.push(`${profile.packetLoss}% loss`);
				if (profile.throttle !== 'full') parts.push(`${profile.throttle.toUpperCase()}`);
				return parts.length > 0 ? parts.join(', ') : 'No latency';
			}

			/**
			 * Reset Metrics
			 */
			function resetMetrics() {
				document.getElementById('throughput-metric').textContent = '0 evt/s';
				document.getElementById('latency-p95-metric').textContent = '0 ms';
				document.getElementById('error-rate-metric').textContent = '0%';
				document.getElementById('success-rate-metric').textContent = '0%';

				document.getElementById('latency-p50').textContent = '0ms';
				document.getElementById('latency-p75').textContent = '0ms';
				document.getElementById('latency-p90').textContent = '0ms';
				document.getElementById('latency-p95').textContent = '0ms';
				document.getElementById('latency-p99').textContent = '0ms';
				document.getElementById('latency-p999').textContent = '0ms';

				showToast('Metrics reset', 'info');
			}

			/**
			 * Download Results
			 */
			function downloadResults() {
				if (!performanceTestRunner) {
					showToast('No test results available', 'error');
					return;
				}

				const metrics = performanceTestRunner.getMetrics();
				const stats = calculateStats(metrics);
				const assessment = assessPerformance(stats);

				const results = {
					timestamp: metrics.timestamp,
					config: {
						eventRate: parseInt(document.getElementById('event-rate').value),
						duration: parseInt(document.getElementById('test-duration').value),
						templateId: document.getElementById('event-template').value,
					},
					metrics: metrics,
					stats: stats,
					assessment: assessment,
				};

				const blob = new Blob([JSON.stringify(results, null, 2)], { type: 'application/json' });
				const url = URL.createObjectURL(blob);
				const a = document.createElement('a');
				a.href = url;
				a.download = `perf-test-${new Date().toISOString()}.json`;
				a.click();
				URL.revokeObjectURL(url);

				showToast('Results downloaded', 'success');
			}

			/**
			 * Show Performance Help
			 */
			function showPerformanceHelp() {
				const helpText = `
        Performance Testing Help

        Load Simulation:
        - Configure event rate and duration
        - Use quick profiles for common scenarios
        - Monitor real-time progress

        Network Simulation:
        - Add latency to test slow connections
        - Simulate packet loss and jitter
        - Test different network conditions

        Metrics:
        - View real-time performance metrics
        - Monitor latency percentiles
        - Track error rates

        Results:
        - View test summary and assessment
        - Download results as JSON
        - Compare multiple test runs
      `;
				alert(helpText);
			}

			/**
			 * Format Time Helper
			 */
			function formatTime(seconds) {
				const mins = Math.floor(seconds / 60);
				const secs = seconds % 60;
				return `${mins}:${secs.toString().padStart(2, '0')}`;
			}

			/**
			 * Calculate Stats Helper (inline implementation)
			 */
			function calculateStats(metrics) {
				const latencies = [...metrics.latencies].sort((a, b) => a - b);
				const durationMs = metrics.endTime > 0 ? metrics.endTime - metrics.startTime : Date.now() - metrics.startTime;

				const durationSec = durationMs / 1000;
				const throughput = durationSec > 0 ? metrics.successCount / durationSec : 0;
				const errorRate = metrics.totalEvents > 0 ? (metrics.failureCount / metrics.totalEvents) * 100 : 0;
				const successRate = metrics.totalEvents > 0 ? (metrics.successCount / metrics.totalEvents) * 100 : 0;

				const percentile = (arr, p) => {
					if (arr.length === 0) return 0;
					const index = Math.ceil(arr.length * p) - 1;
					return arr[Math.max(0, Math.min(index, arr.length - 1))];
				};

				return {
					throughput,
					latencyMin: latencies.length > 0 ? latencies[0] : 0,
					latencyMax: latencies.length > 0 ? latencies[latencies.length - 1] : 0,
					latencyAvg: latencies.length > 0 ? latencies.reduce((a, b) => a + b, 0) / latencies.length : 0,
					latencyP50: percentile(latencies, 0.5),
					latencyP75: percentile(latencies, 0.75),
					latencyP90: percentile(latencies, 0.9),
					latencyP95: percentile(latencies, 0.95),
					latencyP99: percentile(latencies, 0.99),
					latencyP999: percentile(latencies, 0.999),
					errorRate,
					successRate,
					durationMs,
				};
			}

			/**
			 * Assess Performance Helper
			 */
			function assessPerformance(stats) {
				const throughputPass = stats.throughput >= 100;
				const latencyPass = stats.latencyP95 < 100;
				const errorRatePass = stats.errorRate < 1;

				const recommendations = [];
				if (!throughputPass) {
					recommendations.push(`Throughput below target (${stats.throughput.toFixed(2)} evt/s vs 100 evt/s)`);
				}
				if (!latencyPass) {
					recommendations.push(`Latency p95 above target (${stats.latencyP95.toFixed(2)}ms vs 100ms)`);
				}
				if (!errorRatePass) {
					recommendations.push(`Error rate above target (${stats.errorRate.toFixed(2)}% vs 1%)`);
				}
				if (throughputPass && latencyPass && errorRatePass) {
					recommendations.push('All performance criteria met!');
				}

				return {
					pass: throughputPass && latencyPass && errorRatePass,
					criteria: {
						throughput: { target: 100, actual: stats.throughput, pass: throughputPass },
						latencyP95: { target: 100, actual: stats.latencyP95, pass: latencyPass },
						errorRate: { target: 1, actual: stats.errorRate, pass: errorRatePass },
					},
					recommendations,
				};
			}

			/**
			 * Create Performance Test Runner (inline implementation)
			 */
			function createPerformanceTestRunner(config) {
				let running = false;
				let paused = false;
				let eventsSent = 0;
				let intervalHandle = null;
				let progressCallback = null;
				let metricsCallback = null;

				const metrics = {
					startTime: 0,
					endTime: 0,
					totalEvents: 0,
					successCount: 0,
					failureCount: 0,
					latencies: [],
					errors: [],
					timestamp: Date.now(),
					bytesTransferred: 0,
				};

				return {
					onProgress(cb) {
						progressCallback = cb;
					},
					onMetrics(cb) {
						metricsCallback = cb;
					},

					async start() {
						running = true;
						paused = false;
						eventsSent = 0;
						metrics.startTime = Date.now();
						metrics.timestamp = Date.now();

						const expectedTotal = config.eventRate * config.duration;
						const intervalMs = 1000 / config.eventRate;
						const deadline = metrics.startTime + config.duration * 1000;

						const emitProgress = () => {
							if (progressCallback) {
								const elapsed = Date.now() - metrics.startTime;
								const remaining = Math.max(0, expectedTotal - eventsSent);
								const currentRate = elapsed > 0 ? eventsSent / (elapsed / 1000) : 0;
								progressCallback({
									eventsSent,
									elapsedTime: elapsed,
									eventsRemaining: remaining,
									currentRate,
									status: running ? (paused ? 'paused' : 'running') : 'complete',
								});
							}
						};

						const emitMetrics = () => {
							if (metricsCallback) {
								metricsCallback({ ...metrics });
							}
						};

						const sendEvent = async () => {
							const startTime = performance.now();

							try {
								const event = window.mockDataGenerator?.generateEvent(config.templateId) || {
									type: config.templateId,
									source: 'performance-test',
									data: { timestamp: new Date().toISOString() },
								};

								const requestBody = JSON.stringify(event);
								const requestSize = new Blob([requestBody]).size;

								// Apply latency injection if enabled
								let fetchPromise = fetch('/events', {
									method: 'POST',
									headers: {
										'Content-Type': 'application/json',
										Authorization: `Bearer ${config.authToken}`,
									},
									body: requestBody,
								});

								// Simulate latency if enabled
								if (latencyInjector.enabled && latencyInjector.profile) {
									const profile = latencyInjector.profile;
									const jitterAmount = Math.random() * profile.jitter;
									const delay = profile.baseLatency + jitterAmount;

									// Check packet loss
									if (Math.random() < profile.packetLoss / 100) {
										throw new Error('Simulated packet loss');
									}

									await new Promise((resolve) => setTimeout(resolve, delay));
								}

								const response = await fetchPromise;
								const latency = performance.now() - startTime;
								metrics.latencies.push(latency);
								metrics.bytesTransferred += requestSize;

								if (response.ok) {
									metrics.successCount++;
									const responseText = await response.text();
									metrics.bytesTransferred += new Blob([responseText]).size;
								} else {
									metrics.failureCount++;
									const error = metrics.errors.find((e) => e.code === response.status.toString());
									if (error) {
										error.count++;
									} else {
										metrics.errors.push({ code: response.status.toString(), count: 1 });
									}
								}
							} catch (error) {
								const latency = performance.now() - startTime;
								metrics.latencies.push(latency);
								metrics.failureCount++;

								const errorCode = error instanceof Error ? error.name : 'unknown';
								const errorEntry = metrics.errors.find((e) => e.code === errorCode);
								if (errorEntry) {
									errorEntry.count++;
								} else {
									metrics.errors.push({ code: errorCode, count: 1 });
								}
							}
						};

						emitProgress();

						intervalHandle = setInterval(async () => {
							if (!running) {
								clearInterval(intervalHandle);
								return;
							}

							if (Date.now() >= deadline) {
								running = false;
								metrics.endTime = Date.now();
								clearInterval(intervalHandle);
								emitProgress();
								emitMetrics();
								return;
							}

							if (!paused) {
								await sendEvent();
								eventsSent++;
								metrics.totalEvents++;
								emitProgress();
								emitMetrics();
							}
						}, intervalMs);
					},

					pause() {
						paused = true;
					},
					resume() {
						paused = false;
					},
					stop() {
						running = false;
						metrics.endTime = Date.now();
						if (intervalHandle) clearInterval(intervalHandle);
					},
					isRunning() {
						return running;
					},
					isPaused() {
						return paused;
					},
					getMetrics() {
						return { ...metrics };
					},
				};
			}

			// Initialize on page load
			document.addEventListener('DOMContentLoaded', () => {
				initPerformanceTestingModule();

				// Back to Top Button Functionality (Medium Priority Issue #11)
				const backToTopBtn = document.createElement('button');
				backToTopBtn.className = 'back-to-top';
				backToTopBtn.setAttribute('aria-label', 'Back to top');
				backToTopBtn.innerHTML = '↑';
				document.body.appendChild(backToTopBtn);

				// Show/hide back-to-top button based on scroll position
				window.addEventListener('scroll', () => {
					if (window.scrollY > 300) {
						backToTopBtn.classList.add('visible');
					} else {
						backToTopBtn.classList.remove('visible');
					}
				});

				// Scroll to top on click with smooth behavior
				backToTopBtn.addEventListener('click', () => {
					window.scrollTo({
						top: 0,
						behavior: 'smooth'
					});
				});
			});
		</script>
		<script src="/ui/enhanced-charts.js"></script>
	</body>
</html>
