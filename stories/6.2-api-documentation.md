---
title: "Story 6.2 - API Documentation: Endpoint Specs, Examples, Error Codes, Authentication Guide"
status: "Ready for Development"
epic: "Epic 6: Performance Testing + Final Polish"
priority: "P1"
story_size: "Large"
estimated_hours: 6
created_at: "2025-11-11"
modified_at: "2025-11-11"
---

## Summary

Create comprehensive API documentation that covers all TriggersAPI endpoints, authentication mechanisms, request/response formats, error codes, rate limiting, and practical code examples. Documentation should be production-ready, accessible both as static markdown and interactive API explorer/tester. Enable developers to integrate with the API within minutes by providing clear specs, real-world examples, and error guidance.

## Business Value

Clear, comprehensive API documentation removes barriers to adoption. Developers can integrate TriggersAPI into their systems quickly without confusion or false starts. Interactive documentation (OpenAPI/Swagger) demonstrates the API's capability through live testing. Reduces support burden by providing definitive reference for all endpoints, error scenarios, and best practices. Documentation quality directly impacts perception of production-readiness - essential for demo submission.

## Technical Context

**From PRD (FR-7.2: Documentation):**
- System MUST include API documentation covering:
  - All endpoints with request/response examples
  - Authentication setup
  - Debug flag usage
  - Error code reference
- Documentation MUST be accessible and clear

**From PRD (NFR-2: API Design):**
- RESTful conventions with predictable endpoints
- API documentation with examples for all endpoints

**From PRD (NFR-6: Security):**
- All API endpoints (except root dashboard) MUST require valid Bearer token or API key
- Authentication guide MUST be included in documentation

**Existing API Endpoints (from Architecture & Stories 1-5):**
- `POST /events` - Event ingestion endpoint
- `GET /inbox` - Retrieve inbox with filtering
- `POST /inbox/:id/acknowledge` - Acknowledge processed event
- `POST /inbox/:id/retry` - Retry failed event

**Key Dependencies:**
- Story 1.2: POST /events endpoint implementation
- Story 3.1: GET /inbox endpoint implementation
- Story 3.2: POST /inbox/{id}/acknowledge implementation
- Story 3.3: POST /inbox/{id}/retry implementation
- Story 2.5: Error handling and error codes
- Story 5.5: Mock data generators (for example payloads)

## Acceptance Criteria

### 1. Complete API Endpoint Documentation

**Criterion 1a: Endpoint Reference Structure**
- Document all 4 endpoints in standardized format:
  - Endpoint path and HTTP method
  - Brief description of functionality
  - Authentication requirement (Bearer token)
  - Request method and content type
  - Response status codes
- Consistent formatting across all endpoint docs
- Searchable/filterable endpoint list

**Criterion 1b: POST /events Endpoint Documentation**
- Description: "Submit an event to the TriggersAPI for processing"
- HTTP Method: `POST`
- Path: `/events`
- Content-Type: `application/json`
- Authentication: Bearer token (required)
- Request body structure with field descriptions:
  - `payload` (object, required): The event payload
    - `source` (string, optional): Event source system
    - `type` (string, optional): Event type
    - `timestamp` (ISO-8601 string, optional): Event creation time
  - `metadata` (object, optional): Custom metadata
    - `tags` (array, optional): Event tags
    - `priority` (string, optional): Event priority
- Example request (fully complete)
- Response format for success (200):
  - `event_id` (string): Unique event identifier
  - `status` (string): "queued"
  - `timestamp` (ISO-8601): When event was received
- Response format for failure:
  - Error cases: 400 (validation), 401 (auth), 429 (rate limit), 500 (server)
  - Error response format: `{"error": "code", "message": "description", "details": {...}}`

**Criterion 1c: GET /inbox Endpoint Documentation**
- Description: "Retrieve events from your inbox with optional filtering"
- HTTP Method: `GET`
- Path: `/inbox`
- Query parameters documented:
  - `status` (string): Filter by status (pending, delivered, failed, retried)
  - `limit` (integer): Max results (default 20, max 100)
  - `offset` (integer): Pagination offset (default 0)
  - `sort` (string): Sort field (timestamp, status, created)
  - `order` (string): Sort order (asc, desc)
  - `date_from` (ISO-8601): Minimum timestamp filter
  - `date_to` (ISO-8601): Maximum timestamp filter
- Example request with filters
- Response format:
  - `events` (array): List of events
    - Event object with all fields
  - `total_count` (integer): Total matching events
  - `limit` (integer): Results limit used
  - `offset` (integer): Offset used
  - `has_more` (boolean): Whether more results available

**Criterion 1d: POST /inbox/:id/acknowledge Endpoint Documentation**
- Description: "Mark an event as acknowledged/processed"
- HTTP Method: `POST`
- Path: `/inbox/{event_id}/acknowledge`
- Path parameter: `event_id` (string, UUID format)
- Request body (optional):
  - `notes` (string, optional): Acknowledgment notes
- Example request
- Response format on success (200):
  - `event_id` (string): Event that was acknowledged
  - `status` (string): New status "acknowledged"
  - `timestamp` (ISO-8601): When acknowledged

**Criterion 1e: POST /inbox/:id/retry Endpoint Documentation**
- Description: "Retry processing a failed event"
- HTTP Method: `POST`
- Path: `/inbox/{event_id}/retry`
- Path parameter: `event_id` (string, UUID format)
- Request body (optional):
  - `max_retries` (integer, optional): Override max retry attempts
- Example request
- Response format on success (200):
  - `event_id` (string): Event being retried
  - `status` (string): New status "retrying"
  - `retry_count` (integer): Retry attempt number
  - `next_retry` (ISO-8601): When next retry scheduled

### 2. Request/Response Examples for All Endpoints

**Criterion 2a: POST /events Examples**
- Example 1: Minimal valid request
  ```json
  POST /events
  Authorization: Bearer sk-test-xxxxx
  Content-Type: application/json

  {
    "payload": {
      "event_type": "user.created",
      "user_id": "12345",
      "email": "user@example.com"
    }
  }

  Response (200):
  {
    "event_id": "evt_1234567890abcdef",
    "status": "queued",
    "timestamp": "2025-11-11T14:30:00Z"
  }
  ```

- Example 2: Complete request with metadata
  ```json
  POST /events
  Authorization: Bearer sk-test-xxxxx
  Content-Type: application/json

  {
    "payload": {
      "event_type": "order.placed",
      "order_id": "ord_xyz789",
      "customer_id": "cust_abc123",
      "total": 99.99,
      "items": [
        {"sku": "PRODUCT-1", "qty": 2}
      ]
    },
    "metadata": {
      "tags": ["production", "high-priority"],
      "priority": "high"
    }
  }

  Response (200):
  {
    "event_id": "evt_9876543210fedcba",
    "status": "queued",
    "timestamp": "2025-11-11T14:31:00Z"
  }
  ```

- Example 3: Error response (validation failure)
  ```json
  POST /events
  Authorization: Bearer sk-test-xxxxx
  Content-Type: application/json

  {
    "invalid_field": "test"
  }

  Response (400):
  {
    "error": "VALIDATION_ERROR",
    "message": "Invalid event payload",
    "details": {
      "missing_field": "payload",
      "field_requirements": {
        "payload": "object (required)"
      }
    }
  }
  ```

- Example 4: Debug flag example (validation_error)
  ```json
  POST /events?debug=validation_error
  Authorization: Bearer sk-test-xxxxx

  Response (400):
  {
    "error": "VALIDATION_ERROR",
    "message": "Forced validation error (debug mode)",
    "is_debug": true
  }
  ```

**Criterion 2b: GET /inbox Examples**
- Example 1: List all events (default)
  ```
  GET /inbox
  Authorization: Bearer sk-test-xxxxx

  Response (200):
  {
    "events": [
      {
        "event_id": "evt_001",
        "status": "delivered",
        "payload": {...},
        "created_at": "2025-11-11T14:00:00Z",
        "processed_at": "2025-11-11T14:00:05Z"
      }
    ],
    "total_count": 156,
    "limit": 20,
    "offset": 0,
    "has_more": true
  }
  ```

- Example 2: Filter by status and date range
  ```
  GET /inbox?status=failed&date_from=2025-11-10&date_to=2025-11-11&limit=50
  Authorization: Bearer sk-test-xxxxx

  Response (200):
  {
    "events": [...],
    "total_count": 12,
    "limit": 50,
    "offset": 0,
    "has_more": false
  }
  ```

**Criterion 2c: Acknowledge/Retry Examples**
- POST /inbox/{id}/acknowledge success example
- POST /inbox/{id}/retry with retry_count example
- Error examples (404 for non-existent event, 409 for state conflicts)

### 3. Authentication Guide

**Criterion 3a: Authentication Overview**
- Section title: "Authentication"
- Explanation: "All TriggersAPI endpoints (except the dashboard root `/`) require authentication using Bearer tokens."
- Bearer token format: `Authorization: Bearer sk-test-xxxxx` or `Authorization: Bearer sk-live-xxxxx`

**Criterion 3b: Bearer Token Format**
- Prefix options:
  - `sk-test-` for test/development tokens
  - `sk-live-` for production tokens
- Token length: 32+ alphanumeric characters after prefix
- Example valid tokens (test safe examples)

**Criterion 3c: Getting Authentication Credentials**
- How to obtain test token (from dashboard or mock)
- How token is validated (Bearer token check in KV store)
- Token rotation/revocation (if applicable)
- Best practices for token security

**Criterion 3d: Authentication Examples**
- Correct request with valid Bearer token
- Request without Authorization header (401 response)
- Request with invalid token (401 response)
- Request with expired token (if implemented, 401 response)

**Criterion 3e: Error Responses for Auth Failures**
- 401 Unauthorized for missing/invalid token
  ```json
  {
    "error": "AUTHENTICATION_FAILED",
    "message": "Invalid or missing Bearer token",
    "code": 401
  }
  ```
- 403 Forbidden for token without required scopes (if applicable)

### 4. Error Code Reference

**Criterion 4a: Error Code Table**
- Comprehensive list of all error codes returned by API
- Format for each error:
  - Code name (e.g., VALIDATION_ERROR)
  - HTTP status code
  - Description of when it occurs
  - Common causes
  - Recommended resolution

**Criterion 4b: Specific Error Codes to Document**
- `VALIDATION_ERROR` (400): Invalid request payload
- `AUTHENTICATION_FAILED` (401): Missing/invalid Bearer token
- `RATE_LIMIT_EXCEEDED` (429): Too many requests
- `EVENT_NOT_FOUND` (404): Event ID doesn't exist
- `INVALID_STATE_TRANSITION` (409): Event in wrong state for operation
- `PROCESSING_ERROR` (500): Internal processing failure
- `QUEUE_ERROR` (503): Queue system unavailable
- `DATABASE_ERROR` (500): Database operation failed
- `DEBUG_ERROR` (400): Debug flag triggered (test mode)

**Criterion 4c: Error Response Format**
- Standard error response structure documented:
  ```json
  {
    "error": "ERROR_CODE",
    "message": "Human-readable error description",
    "code": 400,
    "request_id": "req_xxxxx" (optional),
    "details": { /* error-specific details */ }
  }
  ```
- Each error code shows typical error response example

**Criterion 4d: Debug Flag Errors**
- Special error codes for debug flags:
  - `VALIDATION_ERROR (debug)` when `?debug=validation_error`
  - `PROCESSING_ERROR (debug)` when `?debug=processing_error`
  - `DLQ_ROUTING (debug)` when `?debug=dlq_routing`
- Document that debug errors are intentional and expected

### 5. Rate Limiting Documentation

**Criterion 5a: Rate Limit Overview**
- Rate limit policy (e.g., X events per minute per token)
- Rate limit applies to: POST /events, GET /inbox, POST /acknowledge, POST /retry
- How rate limits are enforced (per-token or per-IP)

**Criterion 5b: Rate Limit Headers**
- Response headers indicating rate limit status:
  - `X-RateLimit-Limit`: Total requests allowed in window
  - `X-RateLimit-Remaining`: Requests remaining in current window
  - `X-RateLimit-Reset`: Unix timestamp when limit resets
- Example response with rate limit headers

**Criterion 5c: Rate Limit Errors**
- 429 Too Many Requests response
- Response body includes retry-after information
- Guidance on how to handle rate limit backoff

### 6. Event Payload Schema Documentation

**Criterion 6a: Event Payload Structure**
- Top-level structure explanation
- `payload` object (required) - the actual event data
- `metadata` object (optional) - supporting information
- Field naming conventions (snake_case recommended)

**Criterion 6b: Required vs Optional Fields**
- Clear indication of which fields are required
- Explanation of each optional field
- Default values if not specified
- Type constraints for each field

**Criterion 6c: Payload Field Reference**
- `source` (string): Source system identifier
- `type` (string): Event type classification
- `timestamp` (ISO-8601): When event occurred
- `user_id` (string): Associated user identifier
- `data` (object): Event-specific data

**Criterion 6d: Metadata Field Reference**
- `tags` (array of strings): Categorization tags
- `priority` (string): Event priority level
- `correlation_id` (string): Trace identifier
- `idempotency_key` (string): Deduplication key

**Criterion 6e: Event Type Examples**
- Document common event types with example payloads:
  - `user.created`: User registration event
  - `order.placed`: Order submission event
  - `payment.received`: Payment completion event
  - `webhook.received`: Generic webhook data

### 7. Code Examples in Multiple Languages

**Criterion 7a: cURL Examples**
- Complete, copy-paste ready cURL commands
- All 4 endpoints covered
- Both success and error cases
- Environment variable usage (Bearer token)
- Formatted for readability

**Criterion 7b: JavaScript/Node.js Examples**
- Using native `fetch()` API (Node 18+)
- Using popular libraries if applicable (axios, etc.)
- Full working code snippets
- Error handling patterns
- Async/await usage

**Criterion 7c: Python Examples**
- Using `requests` library
- Complete working script with error handling
- Exception handling for HTTP errors
- JSON payload examples
- Recommended Python version (3.7+)

**Criterion 7d: Code Example Structure**
- Each example shows:
  - Imports/dependencies
  - Function to call endpoint
  - Request setup (headers, auth, body)
  - Response handling
  - Error handling
  - Example output

**Criterion 7e: Multi-Language Example: POST /events**
- Show same endpoint in all 3 languages
- Highlight language-specific idioms
- All examples functionally equivalent

### 8. OpenAPI/Swagger Specification

**Criterion 8a: OpenAPI 3.0 Spec File**
- Generate or hand-author `openapi.yaml` or `openapi.json`
- Located at `/api/spec` or `/openapi.json` endpoint
- Complete schema definition for all endpoints
- Request/response schemas properly defined
- Authentication scheme documented (bearerAuth)

**Criterion 8b: OpenAPI Schema Structure**
- OpenAPI version: 3.0.x
- Info object with title, description, version
- Servers section (live endpoint, sandbox, etc.)
- Components section with:
  - Security schemes (Bearer token)
  - Request/response schemas
  - Error response schemas
- Paths section with all 4 endpoints

**Criterion 8c: Endpoint Definitions in OpenAPI**
- Each endpoint includes:
  - operationId (unique identifier)
  - summary and description
  - tags for categorization
  - parameters section (query, path, header)
  - requestBody section
  - responses section with all status codes
  - security requirements

**Criterion 8d: Schema Definitions**
- EventPayload schema
- Event object schema
- InboxResponse schema
- ErrorResponse schema
- All schemas with property descriptions and types

### 9. Interactive API Explorer/Tester

**Criterion 9a: Swagger UI Integration**
- Serve Swagger UI at `/api/docs` or `/swagger`
- Swagger UI displays OpenAPI spec
- Interactive "Try it out" functionality for all endpoints
- Users can execute requests directly from browser
- Requires Bearer token input for authenticated endpoints

**Criterion 9b: Explorer Features**
- List all endpoints with methods highlighted
- Expand each endpoint to see details
- Input fields for:
  - Path parameters (e.g., event_id)
  - Query parameters (e.g., status, limit)
  - Request body (JSON editor)
  - Authorization (Bearer token input field)
- Execute button to send request
- Real response display (status, headers, body)
- Response examples from actual API calls

**Criterion 9c: Authentication in Explorer**
- Authorization button to set Bearer token
- Saved token persists across API calls (in session)
- Clear authorization option
- Info about where to get test token

**Criterion 9d: Request/Response Display**
- Show full HTTP request (method, path, headers, body)
- Display response status and headers
- Pretty-print JSON responses
- Color-coded status codes (green 2xx, yellow 4xx, red 5xx)
- Copy response button

**Criterion 9e: Documentation Sidebar**
- Integrated documentation alongside explorer
- Click endpoint to show docs in sidebar
- Error codes reference
- Authentication guide quick access
- Code examples for selected endpoint

### 10. Metadata Field Documentation

**Criterion 10a: Metadata Object Documentation**
- Section: "Event Metadata"
- Explanation of what metadata is (optional contextual data)
- Use cases for metadata
- How metadata differs from payload

**Criterion 10b: Standard Metadata Fields**
- `tags` (array of strings, optional)
  - Purpose: Categorize and filter events
  - Example: `["production", "urgent"]`
  - Max 10 tags per event

- `priority` (string enum, optional)
  - Values: "low", "medium", "high", "critical"
  - Default: "medium"
  - Purpose: Event importance level

- `correlation_id` (string, optional)
  - Format: UUID or trace ID
  - Purpose: Link related events across systems
  - Example: `"corr_abc123xyz"`

- `idempotency_key` (string, optional)
  - Format: Unique string (UUID recommended)
  - Purpose: Prevent duplicate event processing
  - Server validates within configurable time window

**Criterion 10c: Custom Metadata Fields**
- Explanation that additional fields can be added
- Guidelines for field naming (snake_case preferred)
- Field value type constraints (string, number, boolean, array, object)
- Maximum metadata size (e.g., 1KB)

**Criterion 10d: Metadata Examples**
- Full event with metadata examples
- Show each metadata field in use
- Example: Correlated events (multiple events with same correlation_id)
- Example: Idempotent retry (same event with same idempotency_key)

### 11. Response Pagination Documentation

**Criterion 11a: Pagination Overview**
- Document pagination for GET /inbox endpoint
- How to navigate through large result sets
- Recommended page sizes for performance

**Criterion 11b: Pagination Parameters**
- `limit` (integer): Results per page (default 20, max 100)
- `offset` (integer): Number of results to skip (default 0)
- Alternative: Cursor-based pagination (if implemented)

**Criterion 11c: Pagination Response**
- `total_count`: Total matching results
- `limit`: Limit used in request
- `offset`: Offset used in request
- `has_more`: Boolean indicating more results available
- Example: Calculate next page parameters

**Criterion 11d: Pagination Examples**
- Example 1: First page of results
- Example 2: Fetching next page (offset + limit)
- Example 3: Getting all results with loop/iteration

### 12. Documentation Accessibility & Format

**Criterion 12a: Multiple Documentation Formats**
- Markdown format (`docs/API.md` or similar)
- OpenAPI/Swagger specification
- Interactive web UI (Swagger UI)
- Downloadable PDF (optional, enhanced value)

**Criterion 12b: Search & Navigation**
- Table of contents with links to sections
- Search functionality (in web UI)
- Cross-references between sections
- Related links within docs

**Criterion 12c: Documentation Quality**
- Clear language, no jargon without explanation
- Proper formatting (code blocks, tables, lists)
- Consistent terminology throughout
- All code examples syntax-highlighted
- Grammar and spelling checked

**Criterion 12d: Quick Start Section**
- For developers integrating for first time
- Prerequisites (Bearer token, environment setup)
- Minimal example (send event, retrieve from inbox)
- Expected output
- Troubleshooting quick reference

### 13. API Documentation in UI

**Criterion 13a: Dashboard Integration**
- Add "Documentation" or "API Docs" link in dashboard UI
- Links to `/api/docs` (Swagger UI)
- Alternative: In-app documentation panel
- Easy access from dashboard navigation

**Criterion 13b: Context-Sensitive Help**
- Help icon (?) in dashboard that explains current view
- Links to relevant API documentation sections
- Pop-up or sidebar showing related endpoint

### 14. Versioning & Updates

**Criterion 14a: API Version**
- Version number in OpenAPI spec: `1.0.0`
- Version number in documentation
- Changelog section for future updates

**Criterion 14b: Documentation Maintenance**
- Process for updating docs when API changes
- Backward compatibility notes
- Deprecation warnings for future changes

### 15. Rate Limiting & Performance Guidance

**Criterion 15a: Rate Limit Policy Documentation**
- Specific limits (e.g., 100 events/minute per token)
- How limits apply (per token, per IP, per user)
- Burst allowances if applicable

**Criterion 15b: Performance Best Practices**
- Batch events when possible
- Use pagination limits wisely
- Implement exponential backoff for retries
- Handle rate limit (429) responses gracefully
- Monitor your usage via available metrics

## Dependencies

**Story Dependencies:**
- Story 1.2: POST /events endpoint implementation
- Story 3.1: GET /inbox endpoint implementation
- Story 3.2: POST /inbox/{id}/acknowledge implementation
- Story 3.3: POST /inbox/{id}/retry implementation
- Story 2.5: Error handling and codes
- Story 5.5: Mock data generation (for examples)

**External Dependencies:**
- OpenAPI 3.0 specification
- Swagger UI library (for interactive explorer)
- TypeScript types from existing implementation

## Technical Specifications

### Documentation Structure

```
/docs/
├── API.md                          # Main API documentation (markdown)
├── api-reference/
│   ├── endpoints.md               # Endpoint specifications
│   ├── authentication.md           # Auth guide
│   ├── error-codes.md             # Error reference
│   └── rate-limiting.md           # Rate limit policy
├── guides/
│   ├── quickstart.md              # Quick start for first-time users
│   ├── authentication-setup.md    # Detailed auth setup
│   └── debugging.md               # Debugging API issues
├── examples/
│   ├── curl-examples.sh           # All cURL examples
│   ├── javascript-examples.js     # JavaScript/Node.js examples
│   └── python-examples.py         # Python examples
└── openapi.yaml                   # OpenAPI 3.0 specification

/src/
└── ui/
    └── api-docs.html              # Swagger UI page (served at /api/docs)
```

### Swagger UI Setup

- Install: `npm install swagger-ui-dist` or use CDN
- Serve from `/api/docs` endpoint
- Load OpenAPI spec from `/openapi.json` endpoint
- Configure Bearer token input in UI

### Documentation Generation

- OpenAPI spec can be hand-authored or generated from code
- Consider: `tsoa` or `@tsoa/cli` for auto-generation if applicable
- Alternative: Hand-author spec for maximum control

## Implementation Workflow

1. **Phase 1: Specification & Planning**
   - Write OpenAPI 3.0 spec (`openapi.yaml`)
   - Define error codes and response schemas
   - Gather all endpoint details from implemented stories

2. **Phase 2: Core Documentation**
   - Write endpoint reference documentation
   - Document all 4 endpoints with full specs
   - Create authentication guide section
   - Compile error code reference table
   - Write rate limiting documentation

3. **Phase 3: Examples & Integration**
   - Create cURL examples for all endpoints
   - Write JavaScript/Node.js examples
   - Write Python examples
   - Ensure all examples are tested/working

4. **Phase 4: Interactive Explorer**
   - Set up Swagger UI
   - Verify all endpoints are correctly defined in OpenAPI
   - Test "Try it out" functionality in UI
   - Ensure Bearer token input works

5. **Phase 5: Polish & Accessibility**
   - Add quick start guide
   - Create table of contents
   - Add search functionality if possible
   - Review for clarity and correctness
   - Ensure mobile-friendly formatting

6. **Phase 6: Integration & Deployment**
   - Deploy Swagger UI to production
   - Test documentation links from dashboard
   - Verify all examples work against live API
   - Final QA review

## Verification Checklist

- [ ] All 4 endpoints documented with complete specs
- [ ] Request/response examples for every endpoint
- [ ] 3 languages represented in code examples (cURL, JavaScript, Python)
- [ ] Authentication guide covers Bearer token setup and validation
- [ ] All error codes documented with HTTP status, description, and examples
- [ ] Rate limiting policy documented with specific numbers
- [ ] Event payload schema includes field descriptions and types
- [ ] Metadata fields documented with use cases
- [ ] OpenAPI spec valid and complete (validate at openapis.org)
- [ ] Swagger UI functional and accessible at `/api/docs`
- [ ] "Try it out" works in Swagger UI with Bearer token
- [ ] Quick start guide enables first integration in < 5 minutes
- [ ] All documentation free of typos and grammatical errors
- [ ] Code examples tested and working
- [ ] Documentation includes troubleshooting section
- [ ] Documentation deployed and accessible from dashboard
