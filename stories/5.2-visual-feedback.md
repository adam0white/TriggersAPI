---
title: "Story 5.2 - Visual Feedback: Success/Error Toasts, Loading States, Status Indicators"
status: "Ready for Development"
epic: "Epic 5: Debug Control Panel + UI Polish"
priority: "P0"
story_size: "Medium"
estimated_hours: 5
created_at: "2025-11-11"
modified_at: "2025-11-11"
---

## Summary

Implement comprehensive visual feedback system with toast notifications for success/error states, animated loading indicators, and real-time status updates. Users should immediately see confirmation of their actions with clear visual indicators that guide understanding of system behavior.

## Business Value

Users instantly know the result of their actions without checking logs or refreshing. Visual feedback builds confidence in the system's reliability and makes the demo feel polished and professional. Reduces user confusion by providing immediate, clear communication of success, failures, and in-progress operations.

## Technical Context

**From PRD (FR-5.3: Debug Control Panel):**
- Controls MUST provide immediate visual feedback

**From PRD (NFR-6: Developer Experience):**
- Clear, actionable error messages
- Clear HTTP status codes

**From Architecture:**
- Dashboard uses vanilla HTML/CSS/JavaScript
- Success/error responses follow standard format with structured error codes
- Correlation IDs available in all responses for tracing

## Acceptance Criteria

1. **Toast Notification System**
   - Toast container positioned at top-right corner (mobile: top-center, full-width)
   - Auto-dismiss after 4 seconds (or manual close)
   - Stack multiple toasts vertically with proper spacing
   - Smooth fade-in/slide-in animation on appearance
   - Smooth fade-out animation on dismissal
   - Z-index ensures visibility above all other elements

2. **Success Toast**
   - Green background (#10b981) with white text
   - Checkmark icon (✓) preceding message
   - Message format: "Event submitted successfully" or "Event {event_id} created"
   - Option to show event ID in toast
   - Click to dismiss before auto-timeout
   - Secondary action button: "View Event" (links to inbox)

3. **Error Toast**
   - Red background (#ef4444) with white text
   - X icon (✗) preceding message
   - Display HTTP status code and error message
   - Error code in smaller text below message
   - Example: "400 Bad Request - Validation failed (INVALID_PAYLOAD)"
   - Click to dismiss
   - Secondary action: "Details" button opens error details modal

4. **Warning Toast**
   - Orange/yellow background (#f59e0b) with dark text
   - Warning icon (⚠) preceding message
   - Used for retry attempts, queue delays, etc.
   - Example: "Processing retry attempt 2 of 3"
   - Auto-dismiss after 3 seconds
   - Optional action button for user response

5. **Info Toast**
   - Blue background (#3b82f6) with white text
   - Info icon (ℹ) preceding message
   - Used for informational messages about system state
   - Example: "Event queued for processing"
   - Auto-dismiss after 3 seconds
   - Link-based action if needed

6. **Loading Indicator (Spinner)**
   - Animated circular spinner with rotating border
   - Available in 3 sizes: small (20px), medium (40px), large (60px)
   - Color customizable (default: #3b82f6)
   - Used when action is in progress
   - Show inside submit buttons during request
   - Disable button while loading

7. **Loading Toast**
   - Toast variant with spinner and message
   - "Submitting event..." message with spinner
   - No auto-dismiss while loading
   - Transforms to success/error toast on completion
   - Prevents duplicate submissions while loading

8. **Status Indicators (Small Badges)**
   - Inline status badges for individual events/items
   - Available states: pending (gray), processing (blue spinner), success (green), error (red), retry (orange)
   - Small text label with state name
   - Animate state transitions
   - Used in event inbox and history lists

9. **Loading State for Buttons**
   - Button text changes to "Loading..." or shows spinner
   - Button disabled while loading (grayed out)
   - Cursor changes to "not-allowed"
   - Width maintained (no layout shift)
   - Text fades out and spinner fades in

10. **Progress Indicators**
    - For batch operations and sequential actions
    - Linear progress bar with percentage fill
    - Step indicator (e.g., "2 of 4")
    - Color changes with progress: gray (0-25%), blue (25-75%), green (75-100%)
    - Smooth animation between updates
    - Optional animated pulse at end of bar

11. **Event Status Real-Time Updates**
    - Display status for submitted event in toast
    - Show initial status: "Event queued" (blue)
    - Poll for status updates every 2 seconds
    - Update status as it changes: queued → processing → delivered (green)
    - Show error status with red indicator
    - Close toast on final status (delivered or failed)

12. **Skeleton Loading**
    - Use skeleton screens when loading data
    - Show placeholder boxes matching final layout
    - Animate with subtle pulse effect
    - Example: Event inbox loading 5 skeleton rows
    - Fade out and replace with real content when loaded

13. **Form Validation Feedback**
    - Real-time validation indicator during typing
    - Show red border on invalid fields
    - Green checkmark on valid fields
    - Error message appears below field in red
    - Field gets focus on submit attempt with validation error
    - Summary error count at top of form

14. **Disabled State Feedback**
    - Visually disabled buttons (opacity 0.5, grayed)
    - Tooltip on hover: "Please complete required fields" or "Action not available"
    - Cursor change to "not-allowed"
    - Used when prerequisites not met

15. **Success Animation**
    - When event successfully submitted, show brief celebration animation
    - Green checkmark appears momentarily
    - Subtle bounce or scale animation
    - Accompanied by success toast
    - Quick animation (300-500ms)

## Dependencies

- **Story 5.1:** Debug control panel (uses toasts for feedback)
- **Story 1.6:** UI skeleton with base HTML structure
- **Story 2.6:** Metrics display (uses loading states)
- **Story 3.5:** Event inbox (uses status indicators)

## Technical Specifications

### Toast System Component

```html
<!-- src/ui/index.html -->
<div id="toast-container" class="toast-container"></div>

<style>
.toast-container {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 9999;
  max-width: 400px;
}

.toast {
  padding: 16px;
  border-radius: 8px;
  margin-bottom: 12px;
  display: flex;
  align-items: center;
  gap: 12px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  animation: slideIn 0.3s ease-out;
  min-width: 300px;
}

@keyframes slideIn {
  from {
    transform: translateX(400px);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

@keyframes slideOut {
  from {
    transform: translateX(0);
    opacity: 1;
  }
  to {
    transform: translateX(400px);
    opacity: 0;
  }
}

.toast.removing {
  animation: slideOut 0.3s ease-in forwards;
}

.toast-success {
  background: #10b981;
  color: white;
}

.toast-error {
  background: #ef4444;
  color: white;
}

.toast-warning {
  background: #f59e0b;
  color: #1f2937;
}

.toast-info {
  background: #3b82f6;
  color: white;
}

.toast-icon {
  font-size: 18px;
  flex-shrink: 0;
}

.toast-content {
  flex: 1;
}

.toast-message {
  font-size: 14px;
  font-weight: 500;
  margin: 0;
}

.toast-details {
  font-size: 12px;
  opacity: 0.9;
  margin-top: 4px;
}

.toast-close {
  background: none;
  border: none;
  color: inherit;
  cursor: pointer;
  font-size: 18px;
  opacity: 0.7;
  transition: opacity 0.2s;
  padding: 0;
  flex-shrink: 0;
}

.toast-close:hover {
  opacity: 1;
}

.toast-action {
  background: rgba(255, 255, 255, 0.2);
  border: none;
  color: inherit;
  padding: 4px 12px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 12px;
  font-weight: 500;
  transition: background 0.2s;
  margin-left: 12px;
  flex-shrink: 0;
}

.toast-action:hover {
  background: rgba(255, 255, 255, 0.3);
}

@media (max-width: 768px) {
  .toast-container {
    left: 12px;
    right: 12px;
    top: 12px;
    max-width: none;
  }

  .toast {
    min-width: auto;
  }
}

.spinner {
  display: inline-block;
  width: 40px;
  height: 40px;
  border: 4px solid #e5e7eb;
  border-top-color: #3b82f6;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.spinner.small {
  width: 20px;
  height: 20px;
  border-width: 2px;
}

.spinner.large {
  width: 60px;
  height: 60px;
  border-width: 6px;
}

.button-loading {
  display: inline-flex;
  align-items: center;
  gap: 8px;
}

.button-loading .spinner {
  width: 16px;
  height: 16px;
  border-width: 2px;
  margin: 0;
}
</style>
```

### Toast Manager JavaScript

```javascript
// src/ui/toast-manager.js
class ToastManager {
  constructor() {
    this.container = document.getElementById('toast-container');
    this.toasts = new Map();
  }

  show(message, type = 'info', options = {}) {
    const {
      duration = type === 'error' ? 6000 : 4000,
      icon = this.getIcon(type),
      details = null,
      action = null,
      id = Math.random().toString(36).substr(2, 9)
    } = options;

    // Create toast element
    const toast = document.createElement('div');
    toast.className = `toast toast-${type}`;
    toast.id = `toast-${id}`;

    const content = document.createElement('div');
    content.className = 'toast-content';

    const iconEl = document.createElement('span');
    iconEl.className = 'toast-icon';
    iconEl.textContent = icon;

    const messageEl = document.createElement('p');
    messageEl.className = 'toast-message';
    messageEl.textContent = message;
    content.appendChild(messageEl);

    if (details) {
      const detailsEl = document.createElement('p');
      detailsEl.className = 'toast-details';
      detailsEl.textContent = details;
      content.appendChild(detailsEl);
    }

    toast.appendChild(iconEl);
    toast.appendChild(content);

    // Add action button if provided
    if (action) {
      const actionBtn = document.createElement('button');
      actionBtn.className = 'toast-action';
      actionBtn.textContent = action.label;
      actionBtn.addEventListener('click', action.callback);
      toast.appendChild(actionBtn);
    }

    // Add close button
    const closeBtn = document.createElement('button');
    closeBtn.className = 'toast-close';
    closeBtn.textContent = '×';
    closeBtn.addEventListener('click', () => this.remove(id));
    toast.appendChild(closeBtn);

    // Add to container
    this.container.appendChild(toast);
    this.toasts.set(id, toast);

    // Auto-dismiss
    if (duration > 0) {
      setTimeout(() => this.remove(id), duration);
    }

    return id;
  }

  success(message, options = {}) {
    return this.show(message, 'success', options);
  }

  error(message, errorCode = null, options = {}) {
    const details = errorCode ? `Error: ${errorCode}` : null;
    return this.show(message, 'error', { ...options, details, duration: 6000 });
  }

  warning(message, options = {}) {
    return this.show(message, 'warning', options);
  }

  info(message, options = {}) {
    return this.show(message, 'info', options);
  }

  loading(message, options = {}) {
    return this.show(message, 'info', {
      ...options,
      icon: this.getSpinner(),
      duration: 0  // No auto-dismiss
    });
  }

  remove(id) {
    const toast = this.toasts.get(id);
    if (!toast) return;

    toast.classList.add('removing');
    setTimeout(() => {
      toast.remove();
      this.toasts.delete(id);
    }, 300);
  }

  getIcon(type) {
    const icons = {
      'success': '✓',
      'error': '✗',
      'warning': '⚠',
      'info': 'ℹ'
    };
    return icons[type] || 'ℹ';
  }

  getSpinner() {
    return '<span class="spinner small"></span>';
  }
}

// Initialize globally
document.addEventListener('DOMContentLoaded', () => {
  window.toast = new ToastManager();
});
```

### Loading State Helper

```javascript
// src/ui/loading-state.js
class LoadingStateManager {
  setButtonLoading(button, isLoading = true) {
    if (isLoading) {
      this.originalText = button.textContent;
      button.disabled = true;
      button.innerHTML = '<span class="spinner small"></span> Loading...';
      button.classList.add('loading');
    } else {
      button.disabled = false;
      button.textContent = this.originalText;
      button.classList.remove('loading');
    }
  }

  showSkeleton(container, count = 5) {
    container.innerHTML = Array(count).fill(`
      <div class="skeleton-row">
        <div class="skeleton-box" style="width: 20%; height: 20px;"></div>
        <div class="skeleton-box" style="width: 50%; height: 20px;"></div>
        <div class="skeleton-box" style="width: 20%; height: 20px;"></div>
      </div>
    `).join('');

    // Add pulsing animation
    const style = document.createElement('style');
    style.textContent = `
      .skeleton-row {
        display: flex;
        gap: 16px;
        padding: 12px 0;
        animation: pulse 2s ease-in-out infinite;
      }

      .skeleton-box {
        background: #e5e7eb;
        border-radius: 4px;
      }

      @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
      }
    `;
    document.head.appendChild(style);
  }

  showProgress(container, current, total) {
    const percentage = (current / total) * 100;
    let progressColor = '#9ca3af';
    if (percentage > 75) progressColor = '#10b981';
    else if (percentage > 25) progressColor = '#3b82f6';

    container.innerHTML = `
      <div class="progress-bar">
        <div class="progress-fill" style="width: ${percentage}%; background: ${progressColor};"></div>
        <span class="progress-text">${current} of ${total}</span>
      </div>
    `;
  }
}

window.loadingState = new LoadingStateManager();
```

### Usage Examples

```javascript
// Success toast with action
toast.success('Event created successfully', {
  action: {
    label: 'View',
    callback: () => viewEvent(eventId)
  }
});

// Error toast with code
toast.error('Validation failed', 'INVALID_PAYLOAD', {
  details: 'Missing required field: payload'
});

// Loading state on button
const submitBtn = document.querySelector('.submit-btn');
loadingState.setButtonLoading(submitBtn, true);
// ... do async work
loadingState.setButtonLoading(submitBtn, false);

// Show skeleton while loading
loadingState.showSkeleton(document.getElementById('inbox'), 10);

// Progress tracking
loadingState.showProgress(container, 2, 4);
```

## Implementation Workflow

1. **Create Toast System**
   - Add toast container HTML
   - Implement ToastManager class
   - Add CSS animations and styling

2. **Create Loading State Manager**
   - Implement button loading state
   - Add skeleton loading display
   - Implement progress bar

3. **Add Visual Indicators**
   - Create status badge styles
   - Implement color coding
   - Add animations

4. **Integrate with Existing Features**
   - Use toasts in debug panel submissions
   - Add loading states to event submissions
   - Display status updates in event inbox
   - Show progress in batch operations

5. **Test All Scenarios**
   - Submit events and verify success toast
   - Trigger errors and verify error toast
   - Test auto-dismiss timing
   - Test manual dismiss
   - Test multiple concurrent toasts
   - Verify mobile layout

## Verification Checklist

- [ ] Toast container appears top-right on desktop
- [ ] Toast container appears top-center on mobile
- [ ] Success toast shows green background
- [ ] Error toast shows red background
- [ ] Warning toast shows orange background
- [ ] Info toast shows blue background
- [ ] Toast auto-dismisses after correct duration
- [ ] Toast dismisses on close button click
- [ ] Multiple toasts stack correctly
- [ ] Toast actions execute on click
- [ ] Loading spinner animates correctly
- [ ] Button loading state disables button
- [ ] Button shows spinner during loading
- [ ] Skeleton loading shows pulse animation
- [ ] Progress bar fills correctly
- [ ] Status indicators color-code properly
- [ ] Animations are smooth (60fps)
- [ ] Mobile layout is responsive
- [ ] Error details display in toast

## Notes

- Use CSS animations (not JavaScript) for performance
- Auto-dismiss duration: 4s (success), 6s (error), 3s (info/warning)
- Icons use Unicode characters for simplicity (no icon library)
- Toasts are accessible with screen readers
- Loading spinner uses CSS border animation
- Skeleton animation uses CSS keyframes for performance

## Related Stories

- **5.1:** Debug control panel (uses toast feedback)
- **5.3:** Event flow visualization (may use loading states)

---

## Dev Agent Record

*To be filled by development agent*

---

## QA Results

*To be filled by QA agent*
